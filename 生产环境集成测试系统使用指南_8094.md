# 腾讯文档管理系统 - 生产环境集成测试系统使用指南

## 系统概述

本系统（端口8094）是基于腾讯文档管理项目完整生产环境的集成测试平台，版本v3.0.0。系统完全按照项目正式流程运行，集成了所有生产环境组件。

## 核心特性

### ✅ 完整集成项目生产环境
- 使用项目正式下载目录：`/root/projects/tencent-doc-manager/downloads`
- 使用项目正式配置文件：`/root/projects/tencent-doc-manager/config.json`
- 使用项目正式对比算法：`AdaptiveTableComparator` + `SimpleComparison`
- 使用项目正式结果存储：`/root/projects/tencent-doc-manager/comparison_results`

### ✅ Cookie持久化存储机制
- **localStorage存储**：浏览器本地持久化存储用户输入
- **项目配置同步**：与`config.json`和`auto_download_config.json`完全同步
- **热重载支持**：配置文件变更自动检测和应用
- **多重备份**：主配置+备用配置+浏览器存储三重保障

### ✅ 项目正式流程运行
- **下载流程**：使用`TencentDocAutoExporter`类进行文档下载
- **对比流程**：智能选择`AdaptiveTableComparator`或`SimpleComparison`
- **存储流程**：严格按照项目命名规则和目录结构
- **错误处理**：完整的降级机制和异常恢复

### ✅ 详细路径说明面板
- **实时路径显示**：显示所有文件路径和目录状态
- **命名规则说明**：详细的文件命名格式规范
- **存在性验证**：实时检查目录和文件是否存在
- **下载链接提供**：直接访问日志和结果文件

## 快速开始

### 1. 启动系统

```bash
cd /root/projects/tencent-doc-manager
chmod +x start_production_test_8094.sh
./start_production_test_8094.sh
```

### 2. 验证系统

```bash
python3 test_production_integration_8094.py
```

### 3. 访问系统

浏览器打开：http://localhost:8094

## 详细使用说明

### Cookie配置

1. **获取Cookie**：
   - 登录腾讯文档：https://docs.qq.com
   - 打开浏览器开发者工具（F12）
   - 网络标签页，刷新页面，找到任一请求
   - 复制完整的Cookie字符串

2. **配置Cookie**：
   - 在"Cookie配置"区域粘贴Cookie
   - 点击"保存到项目配置"
   - 系统将Cookie同步到项目配置文件和浏览器存储

3. **验证Cookie**：
   - 点击"从项目配置加载"验证同步是否成功
   - 查看实时日志确认配置状态

### 文档对比

1. **基本对比**：
   - 基线文档URL：输入第一个文档的腾讯文档链接
   - 目标文档URL：输入第二个文档的腾讯文档链接
   - 对比模式：选择对比算法（推荐"自动选择"）
   - 点击"开始对比"

2. **对比模式说明**：
   - **智能对比**：使用`AdaptiveTableComparator`，支持列名智能匹配
   - **简单对比**：使用`SimpleComparison`，基于行级对比
   - **自动选择**：根据模块可用性自动选择最佳算法

3. **结果查看**：
   - 实时日志显示对比进度
   - "最新对比结果"面板显示汇总信息
   - 点击"查看结果"打开详细结果页面

### 系统监控

1. **状态监控**：
   - 模块状态：显示各个核心模块的加载状态
   - 系统状态：显示当前任务和操作计数
   - 实时刷新：定期更新状态信息

2. **日志监控**：
   - 实时日志：显示最新50条操作日志
   - 日志级别：信息、成功、警告、错误
   - 日志下载：支持下载完整日志文件

### 路径信息

系统提供完整的路径信息面板，包括：

#### 核心目录结构
- **项目根目录**：`/root/projects/tencent-doc-manager`
- **正式下载目录**：`/root/projects/tencent-doc-manager/downloads`
- **对比结果目录**：`/root/projects/tencent-doc-manager/comparison_results`
- **主配置文件**：`/root/projects/tencent-doc-manager/config.json`
- **备用配置文件**：`/root/projects/tencent-doc-manager/auto_download_config.json`

#### 文件命名规则
- **下载文件格式**：`tencent_doc_{ID}_{FORMAT}_{TIMESTAMP}.{ext}`
- **对比结果格式**：`comparison_result_{TIMESTAMP}.json`
- **日志文件格式**：`production_test_system_{TIMESTAMP}.log`

### 文件管理

1. **文件浏览**：
   - 点击"打开文件管理器"访问文件管理页面
   - 浏览所有重要目录的文件列表
   - 查看文件大小和修改时间

2. **结果管理**：
   - 对比结果自动保存到`comparison_results`目录
   - 支持历史结果查看和对比
   - JSON格式存储，便于程序处理

## API接口文档

### 基础接口

- `GET /health` - 系统健康检查
- `GET /api/status` - 获取系统状态
- `GET /results` - 对比结果页面
- `GET /files` - 文件管理页面

### 配置接口

- `POST /api/save-cookie` - 保存Cookie到项目配置
- `GET /api/load-cookie` - 从项目配置加载Cookie

### 对比接口

- `POST /api/compare` - 执行文档对比
- `GET /api/latest-result` - 获取最新对比结果

### 工具接口

- `GET /api/download-logs` - 下载日志文件

## 技术架构

### 核心组件

1. **配置管理器**（`ProductionConfigManager`）：
   - 统一配置文件管理
   - 支持热重载和缓存
   - 多配置文件同步

2. **文档下载器**（`ProductionDocumentDownloader`）：
   - 基于`TencentDocAutoExporter`
   - 异步下载处理
   - 自动资源清理

3. **CSV对比器**（`ProductionCSVComparator`）：
   - 集成`AdaptiveTableComparator`
   - 支持简单对比降级
   - 智能算法选择

4. **状态管理器**（`SystemStatus`）：
   - 全局状态跟踪
   - 实时状态更新
   - 错误统计

### 模块依赖

系统支持动态模块加载，核心依赖包括：

```python
# 生产环境模块
from production.core_modules.adaptive_table_comparator import AdaptiveTableComparator
from production.core_modules.tencent_export_automation import TencentDocAutoExporter
from post_download_processor import PostDownloadProcessor

# 简化模块（降级支持）
from simple_comparison_handler import simple_csv_compare, save_comparison_result
```

### 错误处理机制

1. **模块降级**：核心模块不可用时自动使用简化版本
2. **异常恢复**：网络异常和文件异常的自动重试
3. **状态回滚**：操作失败时自动恢复系统状态
4. **用户通知**：友好的错误提示和操作指导

## 故障排除

### 常见问题

1. **Cookie失效**：
   - 重新获取Cookie
   - 确保Cookie格式完整
   - 检查腾讯文档登录状态

2. **下载失败**：
   - 确认文档URL正确
   - 检查网络连接
   - 验证Cookie有效性

3. **对比异常**：
   - 确认文件格式为CSV
   - 检查文件内容编码
   - 查看详细错误日志

4. **模块不可用**：
   - 检查系统状态面板
   - 查看启动日志
   - 确认项目目录完整性

### 日志分析

系统提供多层次的日志信息：

1. **实时日志**：Web界面显示的操作日志
2. **系统日志**：保存到`logs`目录的详细日志
3. **访问日志**：Flask框架的HTTP访问日志

### 性能优化

1. **并发控制**：系统防止多任务并发执行
2. **内存管理**：大文件分块处理和及时清理
3. **缓存策略**：配置文件缓存和状态缓存
4. **资源释放**：浏览器实例和临时文件自动清理

## 更新日志

### v3.0.0 - Production Integrated
- ✅ 完整集成项目生产环境组件
- ✅ 实现Cookie持久化存储机制
- ✅ 添加详细路径说明面板
- ✅ 支持项目正式流程运行
- ✅ 增强错误处理和降级机制
- ✅ 完善文件管理和结果展示

### v2.x - Enhanced Version
- 基本对比功能实现
- 模块化架构设计
- Web界面开发

### v1.x - Basic Version
- 初始版本开发
- 核心功能验证

## 技术支持

如需技术支持，请：

1. 查看实时日志和系统状态
2. 运行系统验证脚本
3. 检查项目目录结构完整性
4. 提供详细的错误信息和日志

---

**系统版本**：v3.0.0 - Production Integrated  
**端口号**：8094  
**项目路径**：`/root/projects/tencent-doc-manager`  
**文档日期**：2025-09-03