# çƒ­åŠ›å›¾UIå‚æ•°æ¥æºä¸æ•°æ®æµè¯´æ˜ v2.0

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0  
**æ›´æ–°æ—¥æœŸ**: 2025-09-13  
**ç›®çš„**: æ˜ç¡®çƒ­åŠ›å›¾UIæ‰€æœ‰è¾“å…¥å‚æ•°çš„æ¥æºã€æ•°æ®æµç¨‹å’Œç›¸äº’å…³ç³»  
**é‡è¦åŸåˆ™**: UIåªèƒ½ä»ç»¼åˆæ‰“åˆ†JSONæ–‡ä»¶è·å–æ•°æ®ï¼ˆå‚è€ƒ[0000æ ‡å‡†](./0000-é¢œè‰²å’Œçº§åˆ«æ‰“åˆ†æ ‡å‡†.md)ï¼‰

## 1. æ•°æ®æµæ¶æ„æ€»è§ˆ

```mermaid
graph TD
    A[CSVæ–‡ä»¶å¯¹æ¯”] --> B[è¯¦ç»†æ‰“åˆ†scoring_engine]
    B --> C[ç»¼åˆè¯„åˆ†aggregator]
    C --> D[/tmp/comprehensive_scoring_data.json]
    D --> E[FlaskæœåŠ¡å™¨å¼ºåˆ¶åŠ è½½]
    E --> F[APIç«¯ç‚¹æä¾›æ•°æ®]
    F --> G[Reactå‰ç«¯è·å–]
    G --> H[UIç»„ä»¶æ¸²æŸ“]
    
    style D fill:#ff9999,stroke:#ff0000,stroke-width:3px
    
    %% æ³¨æ„ï¼šUIä¸èƒ½ç›´æ¥è®¿é—®å…¶ä»–æ•°æ®æº
    I[CSVæ–‡ä»¶] -.->|âŒ ç¦æ­¢ç›´æ¥è®¿é—®| G
    B -.->|âŒ ç¦æ­¢ç›´æ¥è®¿é—®| G
    
    L[ç”¨æˆ·äº¤äº’å‚æ•°] --> M[ReactçŠ¶æ€ç®¡ç†]
    M --> H
```

**å…³é”®åŸåˆ™**ï¼š
- ğŸ”´ **å”¯ä¸€æ•°æ®æº**ï¼šUIåªèƒ½ä» `/tmp/comprehensive_scoring_data.json` è·å–æ•°æ®
- ğŸš« **ç¦æ­¢è®¿é—®**ï¼šUIä¸èƒ½ç›´æ¥è®¿é—®CSVæ–‡ä»¶ã€è¯¦ç»†æ‰“åˆ†æ–‡ä»¶æˆ–å…¶ä»–ä¸­é—´æ–‡ä»¶
- âœ… **å¼ºåˆ¶æ¨¡å¼**ï¼šæœåŠ¡å™¨å¯åŠ¨æ—¶å¼ºåˆ¶åŠ è½½ç»¼åˆæ‰“åˆ†æ–‡ä»¶ï¼Œä¸æä¾›CSVæ¨¡å¼å›é€€

## 2. UIæ ¸å¿ƒå‚æ•°æ¥æºè¯¦è§£

### 2.1 TableModificationChartç»„ä»¶å‚æ•°

| å‚æ•°å | æ¥æº | æ•°æ®è·å–è·¯å¾„ | æ•°æ®æºåˆè§„æ€§ |
|--------|------|-------------|--------------|
| **pattern** | ç»¼åˆæ‰“åˆ†JSON | comprehensive_scoring_data.json â†’ table_scores | âœ… åˆè§„ |
| **columnName** | ç”¨æˆ·äº¤äº’ | é¼ æ ‡æ‚¬åœäº‹ä»¶ â†’ ReactçŠ¶æ€ | âœ… ç‹¬ç«‹å‚æ•° |
| **isHovered** | ç”¨æˆ·äº¤äº’ | é¼ æ ‡äº‹ä»¶ â†’ ReactçŠ¶æ€ | âœ… ç‹¬ç«‹å‚æ•° |
| **allPatterns** | ç»¼åˆæ‰“åˆ†JSON | comprehensive_scoring_data.json â†’ table_scores[] | âœ… åˆè§„ |
| **globalMaxRows** | ç»¼åˆæ‰“åˆ†JSON | comprehensive_scoring_data.json â†’ table_scores[].total_rows | âœ… åˆè§„ |
| **maxWidth** | UIé…ç½® | ç¡¬ç¼–ç å¸¸é‡ï¼ˆ300pxï¼‰ | âœ… ç‹¬ç«‹å‚æ•° |
| **maxHeight** | UIé…ç½® | ç¡¬ç¼–ç å¸¸é‡ï¼ˆ24pxï¼‰ | âœ… ç‹¬ç«‹å‚æ•° |
| **tableData** | ç»¼åˆæ‰“åˆ†JSON | comprehensive_scoring_data.json â†’ table_names + table_urls | âœ… åˆè§„ |
| **detailedScores** | ç»¼åˆæ‰“åˆ†JSON | comprehensive_scoring_data.json â†’ table_scores[].column_scores | âœ… åˆè§„ |

### 2.2 Patternå¯¹è±¡å†…éƒ¨å‚æ•°

```javascript
pattern = {
  tableId: number,              // æ¥æºï¼šè¡¨æ ¼é…ç½®çš„ID
  tableName: string,            // æ¥æºï¼šreal_documents.jsonæˆ–åŠ¨æ€ç”Ÿæˆ
  columnPatterns: {},           // æ¥æºï¼šç»¼åˆè¯„åˆ†çš„column_scores
  rowOverallIntensity: number,  // æ¥æºï¼šè®¡ç®—å€¼ï¼ˆä¿®æ”¹æ•°/æ€»è¡Œæ•°ï¼‰
  riskLevel: 'L1'|'L2'|'L3',  // æ¥æºï¼šç»¼åˆè¯„åˆ†çš„risk_level
  realData: {
    totalRows: number,          // æ¥æºï¼šCSVæ–‡ä»¶å®é™…è¡Œæ•°
    totalDifferences: number,   // æ¥æºï¼šç»¼åˆè¯„åˆ†çš„total_modifications
    modifiedRowsCount: number,  // æ¥æºï¼šmodified_rowsæ•°ç»„é•¿åº¦
    allModifiedRows: [],        // æ¥æºï¼šç»¼åˆè¯„åˆ†çš„modified_rows
    originalTableId: number,    // æ¥æºï¼šåŸå§‹è¡¨æ ¼ID
    currentPosition: number     // æ¥æºï¼šå½“å‰åœ¨æ•°ç»„ä¸­çš„ä½ç½®
  },
  totalModifications: number    // å¤‡ç”¨å­—æ®µï¼šç»¼åˆè¯„åˆ†çš„æ€»ä¿®æ”¹æ•°
}
```

## 3. æ•°æ®æ¥æºå±‚çº§å…³ç³»

### 3.1 ç¬¬ä¸€å±‚ï¼šCSVæ–‡ä»¶ï¼ˆæºå¤´ï¼‰
- **ä½ç½®**: `/root/projects/tencent-doc-manager/csv_versions/`
- **æ ¼å¼**: æ ‡å‡†CSVæ ¼å¼
- **å†…å®¹**: å®é™…ä¸šåŠ¡æ•°æ®
- **ä½œç”¨**: æä¾›åŸå§‹æ•°æ®ç”¨äºå¯¹æ¯”

### 3.2 ç¬¬äºŒå±‚ï¼šè¯¦ç»†æ‰“åˆ†ï¼ˆå¤„ç†ï¼‰
- **ä½ç½®**: `/scoring_results/detailed/`
- **å¤„ç†**: `scoring_engine.py`
- **è¾“å‡º**: å•è¡¨è¯¦ç»†æ‰“åˆ†ç»“æœ
- **åŒ…å«**: ä¿®æ”¹çš„å…·ä½“å•å…ƒæ ¼ã€é£é™©ç­‰çº§ã€åˆ†æ•°

### 3.3 ç¬¬ä¸‰å±‚ï¼šç»¼åˆè¯„åˆ†ï¼ˆèšåˆï¼‰
- **ä½ç½®**: `/tmp/comprehensive_scoring_data.json`
- **å¤„ç†**: `comprehensive_aggregator.py`
- **è¾“å‡º**: æ‰€æœ‰è¡¨æ ¼çš„èšåˆæ•°æ®
- **å…³é”®å­—æ®µ**:
  ```json
  {
    "table_scores": [{
      "table_name": "è¡¨å",
      "total_rows": 270,        // CSVå®é™…è¡Œæ•°
      "total_modifications": 45, // æ€»ä¿®æ”¹æ•°
      "column_scores": {
        "åˆ—å": {
          "modified_rows": [4, 6, 8, 11], // ä¿®æ”¹çš„è¡Œå·
          "aggregated_score": 0.75,
          "column_level": "L2"
        }
      }
    }]
  }
  ```

### 3.4 ç¬¬å››å±‚ï¼šFlaskæœåŠ¡å™¨ï¼ˆæä¾›ï¼‰
- **åŠ è½½**: å¯åŠ¨æ—¶åŠ è½½ç»¼åˆè¯„åˆ†æ•°æ®
- **APIç«¯ç‚¹**:
  - `/api/data` - çƒ­åŠ›å›¾ä¸»æ•°æ®
  - `/api/detailed_scores/<table>` - è¯¦ç»†æ‰“åˆ†æ•°æ®
  - `/api/document-links` - æ–‡æ¡£é“¾æ¥

### 3.5 ç¬¬äº”å±‚ï¼šReactå‰ç«¯ï¼ˆæ¶ˆè´¹ï¼‰
- **è·å–**: fetch APIè°ƒç”¨
- **å¤„ç†**: æ•°æ®è½¬æ¢å’Œè®¡ç®—
- **æ¸²æŸ“**: ç»„ä»¶propsä¼ é€’

## 4. å…³é”®å‚æ•°çš„è®¡ç®—é€»è¾‘

### 4.1 rowOverallIntensityï¼ˆè¡Œæ•´ä½“å¼ºåº¦ï¼‰
```javascript
// è®¡ç®—å…¬å¼
rowOverallIntensity = Math.min(0.95, totalModifications / 100 * 2);

// æˆ–è€…ä»ç»¼åˆè¯„åˆ†è·å–
rowOverallIntensity = table.max_intensity || table.risk_score || è®¡ç®—å€¼;
```

### 4.2 barWidthï¼ˆæ¨ªæ¡å®½åº¦ï¼‰
```javascript
// ä¿®å¤åçš„è®¡ç®—é€»è¾‘
const normalizedIntensity = modifications > 0 ? Math.max(0.1, intensity) : intensity;
const barWidth = Math.max(20, Math.min(maxWidth * 0.8, normalizedIntensity * maxWidth * 0.8));
```

### 4.3 globalMaxRowsï¼ˆå…¨å±€æœ€å¤§è¡Œæ•°ï¼‰
```javascript
// ä»æ‰€æœ‰è¡¨æ ¼ä¸­å–æœ€å¤§å€¼
const globalMaxRows = Math.max(...tables.map(t => t.realData?.totalRows || 50));
```

## 5. ç‹¬ç«‹å‚æ•°ä¸æµç¨‹å‚æ•°çš„åŒºåˆ«

### 5.1 æµç¨‹å‚æ•°ï¼ˆæ•°æ®å¤„ç†é“¾çš„ä¸€éƒ¨åˆ†ï¼‰
è¿™äº›å‚æ•°æ˜¯æ•°æ®å¤„ç†æµç¨‹çš„äº§ç‰©ï¼Œä»CSVåˆ°UIçš„å®Œæ•´é“¾è·¯ï¼š
- âœ… **pattern** - ç»¼åˆè¯„åˆ†çš„æ ¸å¿ƒæ•°æ®
- âœ… **totalRows** - CSVæ–‡ä»¶çš„å®é™…è¡Œæ•°
- âœ… **modified_rows** - å®é™…ä¿®æ”¹çš„è¡Œå·
- âœ… **riskLevel** - AIè®¡ç®—çš„é£é™©ç­‰çº§
- âœ… **aggregated_score** - èšåˆåçš„åˆ†æ•°

### 5.2 ç‹¬ç«‹å‚æ•°ï¼ˆé…ç½®æˆ–äº¤äº’äº§ç”Ÿï¼‰
è¿™äº›å‚æ•°ç‹¬ç«‹äºæ•°æ®å¤„ç†æµç¨‹ï¼š
- âŒ **columnName** - ç”¨æˆ·é¼ æ ‡æ‚¬åœäº§ç”Ÿ
- âŒ **isHovered** - UIäº¤äº’çŠ¶æ€
- âŒ **maxWidth/maxHeight** - UIå¸ƒå±€é…ç½®
- âŒ **é¢œè‰²é…ç½®** - è§†è§‰è®¾è®¡å¸¸é‡

## 6. æ•°æ®æ›´æ–°æœºåˆ¶

### 6.1 å®æ—¶æ›´æ–°
- é¼ æ ‡æ‚¬åœç«‹å³è§¦å‘
- APIè°ƒç”¨è·å–æœ€æ–°æ•°æ®
- ReactçŠ¶æ€æ›´æ–°è§¦å‘é‡æ¸²æŸ“

### 6.2 ç¼“å­˜æœºåˆ¶
```javascript
// 5åˆ†é’Ÿç¼“å­˜ç­–ç•¥
const scoreCache = new Map();
const CACHE_DURATION = 300000; // 5åˆ†é’Ÿ

function getCachedOrFetch(tableName) {
  if (scoreCache.has(tableName)) {
    return scoreCache.get(tableName);
  }
  // è·å–æ–°æ•°æ®å¹¶ç¼“å­˜
  const data = await fetchData(tableName);
  scoreCache.set(tableName, data);
  setTimeout(() => scoreCache.delete(tableName), CACHE_DURATION);
  return data;
}
```

## 7. æ•°æ®å®Œæ•´æ€§ä¿è¯

### 7.1 å¿…éœ€å­—æ®µéªŒè¯
```javascript
// ç¡®ä¿å…³é”®å­—æ®µå­˜åœ¨
const requiredFields = ['total_rows', 'modified_rows', 'column_level'];
const isValid = requiredFields.every(field => data[field] !== undefined);
```

### 7.2 é™çº§ç­–ç•¥
1. **ä¼˜å…ˆä½¿ç”¨**: ç»¼åˆè¯„åˆ†æ•°æ®ï¼ˆcomprehensiveï¼‰
2. **æ¬¡é€‰**: è¯¦ç»†æ‰“åˆ†æ•°æ®ï¼ˆdetailedï¼‰
3. **å…œåº•**: æ¨¡æ‹Ÿæ•°æ®ï¼ˆmockï¼‰

## 8. è°ƒè¯•ä¸ç›‘æ§

### 8.1 æ•°æ®æµè¿½è¸ª
```javascript
console.log('ğŸ“Š æ•°æ®æº:', dataSource);
console.log('ğŸ“ˆ å‚æ•°æ¥æº:', {
  pattern: 'ç»¼åˆè¯„åˆ†',
  columnName: 'ç”¨æˆ·äº¤äº’',
  totalRows: 'CSVæ–‡ä»¶',
  riskLevel: 'AIè®¡ç®—'
});
```

### 8.2 æ€§èƒ½ç›‘æ§ç‚¹
- CSVæ–‡ä»¶è¯»å–æ—¶é—´
- æ‰“åˆ†è®¡ç®—è€—æ—¶
- APIå“åº”å»¶è¿Ÿ
- UIæ¸²æŸ“å¸§ç‡

## 9. æ€»ç»“

UIå‚æ•°æ¥æºå¯åˆ†ä¸ºä¸‰ç±»ï¼š
1. **æ ¸å¿ƒä¸šåŠ¡æ•°æ®**: æ¥è‡ªCSVå¯¹æ¯”å’ŒAIæ‰“åˆ†æµç¨‹
2. **é…ç½®å…ƒæ•°æ®**: æ¥è‡ªé…ç½®æ–‡ä»¶å’Œç³»ç»Ÿè®¾ç½®
3. **äº¤äº’çŠ¶æ€æ•°æ®**: æ¥è‡ªç”¨æˆ·æ“ä½œå’ŒUIçŠ¶æ€

è¿™äº›å‚æ•°é€šè¿‡æ˜ç¡®çš„æ•°æ®æµç¨‹ï¼Œä»æºå¤´ï¼ˆCSVæ–‡ä»¶ï¼‰ç»è¿‡å¤šå±‚å¤„ç†ï¼ˆæ‰“åˆ†ã€èšåˆã€APIï¼‰ï¼Œæœ€ç»ˆåˆ°è¾¾UIç»„ä»¶è¿›è¡Œæ¸²æŸ“ã€‚ç†è§£è¿™ä¸ªå®Œæ•´çš„æ•°æ®æµå¯¹äºç³»ç»Ÿç»´æŠ¤å’Œé—®é¢˜æ’æŸ¥è‡³å…³é‡è¦ã€‚

---

**ç»´æŠ¤è¯´æ˜**: æœ¬æ–‡æ¡£åº”ä¸ä»£ç å®ç°ä¿æŒåŒæ­¥æ›´æ–°