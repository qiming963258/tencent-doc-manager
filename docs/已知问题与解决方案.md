# 腾讯文档智能监控系统 - 已知问题与解决方案

最后更新：2025-09-19

## 🔴 严重问题

### 1. 虚假变更问题（显示2010处变更）

**问题描述**：
系统总是显示"发现2010处变更"，无论实际变更数量多少。

**发现日期**：2025-09-19

**根本原因分析**：
1. **文档不匹配**：系统对比了不同的文档
   - 基线：出国销售计划表（270行）
   - 目标：小红书部门（1474行）
   - 完全不同的表格产生大量"虚假"变更

2. **测试数据污染**：
   - 文件：`generate_standard_comprehensive_score.py`
   - 第43行硬编码：`"total_rows": 2010`

3. **配置错误**：
   - 基线URL和目标URL指向不同文档
   - 违反了版本对比的基本原则

**解决方案**：

#### 临时解决（立即可用）
```bash
# 1. 验证下载的文件行数
wc -l /root/projects/tencent-doc-manager/csv_versions/2025_W38/midweek/*.csv

# 2. 手动确保对比同一文档
# 将基线和目标都设置为同一个文档的URL
```

#### 永久解决（需要代码修改）
1. 修改URL配置逻辑，强制基线和目标为同一文档
2. 删除或重命名测试数据生成文件
3. 添加文档名称验证逻辑

**验证方法**：
```python
# 检查对比结果
import json
data = json.load(open('comparison_results/latest.json'))
print(f"实际修改数: {data['statistics']['total_modifications']}")
```

---

## 🟡 中等问题

### 2. 下载系统架构不一致

**问题描述**：
技术文档与实际实现不符。

**差异对比**：
| 项目 | 文档描述 | 实际实现 |
|------|---------|---------|
| 核心类 | PlaywrightDownloader | TencentDocAutoExporter |
| 位置 | 未实现 | production/core_modules/tencent_export_automation.py |
| 备用方法数 | 4重 | 7重 |

**影响**：
- 功能正常，但可能造成维护困惑
- 新开发者可能被误导

**解决方案**：
- 短期：在所有相关文档添加说明
- 长期：统一命名或创建适配器类

---

## 🟢 轻微问题

### 3. Cookie过期问题

**问题描述**：
Cookie有效期7-14天，需要定期更新。

**当前状态**：
- 最后更新：2025-09-19
- 预计过期：2025-10-03

**更新方法**：
1. 从浏览器获取新cookie
2. 更新`config/cookies.json`
3. 重启服务

**自动化建议**：
创建cookie过期提醒脚本。

---

## 📋 问题追踪清单

| ID | 问题 | 严重性 | 状态 | 发现日期 | 解决日期 |
|----|------|--------|------|---------|---------|
| 001 | 2010处虚假变更 | 🔴高 | 未解决 | 2025-09-19 | - |
| 002 | PlaywrightDownloader不存在 | 🟡中 | 已记录 | 2025-09-19 | - |
| 003 | Cookie过期 | 🟢低 | 监控中 | 2025-09-19 | - |
| 004 | 文件扩展名问题 | 🟢低 | ✅已解决 | 2025-09-15 | 2025-09-15 |

---

## 🔧 调试命令集

### 快速诊断
```bash
# 检查文件行数
wc -l csv_versions/2025_W38/midweek/*.csv

# 查看最新对比结果
python3 -c "import json; print(json.load(open('comparison_results/comparison_20250919_144420.json'))['statistics'])"

# 验证cookie状态
ls -la config/cookies.json

# 检查服务状态
ps aux | grep 8093
```

### 日志分析
```bash
# 查看下载日志
grep "下载" /tmp/8093_service.log | tail -20

# 查看对比结果
grep "发现.*处变更" /tmp/8093_service.log | tail -10
```

---

## 📚 相关文档

- [技术架构规格](specifications/01-腾讯文档下载完全技术架构规格.md) - 已更新差异说明
- [CLAUDE.md](../CLAUDE.md) - 主项目文档，已添加问题说明
- [配置中心使用指南](配置中心使用指南.md) - 配置管理说明

---

## 🚀 下一步行动

1. **紧急**：修复文档对比逻辑，确保对比同一文档
2. **重要**：清理测试数据，避免硬编码值
3. **计划**：重构下载模块，统一架构
4. **监控**：建立自动化测试，防止问题复发