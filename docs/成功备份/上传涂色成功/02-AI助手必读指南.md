# 🤖 AI助手必读 - 腾讯文档上传涂色问题解决指南

## ⚡ 快速解决路径

如果用户报告"涂色不显示"或"上传失败"，**立即执行以下步骤**：

### 第1步：直接使用成功的方法
```python
# 这是唯一正确的方法！！！
from production.core_modules.tencent_doc_upload_production_v3 import quick_upload_v3

result = await quick_upload_v3(
    cookie_string=cookie_string,
    file_path=excel_file,
    headless=True
)
```

### 第2步：检查颜色配置
查看 `intelligent_excel_marker.py` 第244-248行，确保使用深色：
- L1: "FF6666"（不是FFCCCC）
- L2: "FFB366"（不是FFFFCC）
- L3: "66FF66"（不是CCFFCC）

---

## 🚫 绝对不要做的事

### 1. ❌ 不要尝试这些方法
```python
# ❌ 错误1：不要直接调用upload_file
uploader.upload_file(excel_file)  # 会报错"未找到导入按钮"

# ❌ 错误2：不存在的方法
uploader.upload_excel_preserve_colors()  # AttributeError

# ❌ 错误3：不要用V2版本
TencentDocProductionUploaderV2().upload_file()  # 也会失败

# ❌ 错误4：不要手动构建上传流程
async_playwright()...  # 太复杂，容易出错
```

### 2. ❌ 不要被这些错误信息误导

| 错误信息 | 真实原因 | 正确处理 |
|---------|---------|---------|
| "未找到导入按钮" | 使用了错误的upload_file方法 | 改用quick_upload_v3 |
| "存储空间不足95%" | 本地预防性检查 | 忽略，继续上传 |
| "Timeout 60000ms" | Cookie可能过期 | 检查cookie更新时间 |
| "颜色不显示" | 颜色太浅或方法错误 | 检查颜色值和上传方法 |

---

## ✅ 正确的完整流程

### 1. 准备阶段
```python
import sys
sys.path.append('/root/projects/tencent-doc-manager')
import asyncio
import json
from pathlib import Path
from production.core_modules.tencent_doc_upload_production_v3 import quick_upload_v3
```

### 2. 读取Cookie
```python
cookie_file = Path('/root/projects/tencent-doc-manager/config/cookies.json')
with open(cookie_file, 'r') as f:
    cookie_data = json.load(f)
cookie_string = cookie_data.get('current_cookies', '')
```

### 3. 执行上传（唯一正确方法）
```python
async def upload():
    result = await quick_upload_v3(
        cookie_string=cookie_string,
        file_path=excel_file,
        headless=True
    )
    return result

result = asyncio.run(upload())
```

### 4. 验证成功
```python
if result and result.get('success'):
    print(f"✅ 成功URL: {result.get('url')}")
else:
    print("❌ 上传失败，检查cookie是否过期")
```

---

## 🔍 调试检查清单

遇到问题时，按顺序检查：

1. **Cookie有效性**
   ```bash
   cat /root/projects/tencent-doc-manager/config/cookies.json | grep last_update
   # 超过7天需要更新
   ```

2. **打分文件是否存在变更**
   ```bash
   grep total_modifications scoring_results/detailed/*.json
   # 应该>0
   ```

3. **颜色配置是否正确**
   ```bash
   grep "FF6666\|FFB366\|66FF66" intelligent_excel_marker.py
   # 应该找到这些深色值
   ```

4. **是否使用了quick_upload_v3**
   ```bash
   grep "quick_upload_v3" your_script.py
   # 必须使用这个函数
   ```

---

## 📋 成功的标志

### 日志中应该看到：
```
✅ 通过文件名匹配找到文档: https://docs.qq.com/sheet/xxx
✅ 上传成功: https://docs.qq.com/sheet/xxx
```

### 不应该看到：
```
❌ 未找到导入按钮
❌ AttributeError: 'xxx' object has no attribute 'xxx'
❌ Timeout 60000ms exceeded
```

---

## 🎯 记住核心原则

### 1. 永远参考specs文档
- `15-全链路测试成功技术细节与复刻指南.md` - 包含quick_upload_v3用法
- `07-腾讯文档上传技术规格.md` - Cookie处理细节
- `09-上传模块集成方案.md` - 集成方案

### 2. 不要重新发明轮子
- quick_upload_v3已经解决了所有问题
- 不要试图自己写上传逻辑

### 3. 相信成功的方法
- 这个方法在2025-09-29已验证成功
- URL: https://docs.qq.com/sheet/DWHRicFFiRXNqWUtz

---

## 💡 最后的提醒

**如果用户说"涂色不显示"，99%的情况是：**
1. 使用了错误的上传方法（不是quick_upload_v3）
2. 颜色太浅（检查intelligent_excel_marker.py）

**直接执行本文档的"正确的完整流程"即可解决！**

---

*本文档基于实际成功案例编写，请严格遵循以避免重复错误。*