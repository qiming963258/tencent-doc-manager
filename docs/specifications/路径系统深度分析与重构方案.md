# ğŸ”§ è·¯å¾„ç³»ç»Ÿæ·±åº¦åˆ†æä¸é‡æ„æ–¹æ¡ˆ

## æ‰§è¡Œæ‘˜è¦
**æ—¥æœŸ**: 2025-09-10  
**çŠ¶æ€**: ğŸ”´ å‘ç°ä¸¥é‡è·¯å¾„ä¸ä¸€è‡´é—®é¢˜  
**å½±å“**: æ ¸å¿ƒæ‰“åˆ†åŠŸèƒ½è·¯å¾„é”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå¤±æ•ˆ  
**è§£å†³æ–¹æ¡ˆ**: å·²åˆ›å»ºç»Ÿä¸€è·¯å¾„ç®¡ç†ç³»ç»Ÿ

---

## ä¸€ã€é—®é¢˜æ ¹æºåˆ†æ

### 1.1 æ ¸å¿ƒé—®é¢˜ï¼šç›¸å¯¹è·¯å¾„è®¡ç®—å¯¼è‡´çš„è·¯å¾„é”™è¯¯

#### é—®é¢˜ä»£ç ï¼ˆintegrated_scorer.py ç¬¬500-503è¡Œï¼‰
```python
output_dir = os.path.join(
    os.path.dirname(os.path.dirname(os.path.dirname(input_file))),
    'scoring_results',
    'detailed'
)
```

#### è·¯å¾„è®¡ç®—è¿‡ç¨‹
```
å‡è®¾ input_file = /root/projects/tencent-doc-manager/comparison_results/xxx.json

ç¬¬1æ¬¡ dirname: /root/projects/tencent-doc-manager/comparison_results
ç¬¬2æ¬¡ dirname: /root/projects/tencent-doc-manager
ç¬¬3æ¬¡ dirname: /root/projects  â† é”™è¯¯ï¼å°‘äº†ä¸€å±‚

ç»“æœ: /root/projects/scoring_results/detailed/
æ­£ç¡®: /root/projects/tencent-doc-manager/scoring_results/detailed/
```

### 1.2 è·¯å¾„å®šä¹‰åˆ†æ•£é—®é¢˜

é€šè¿‡ä»£ç æœç´¢å‘ç°14ä¸ªæ–‡ä»¶åŒ…å«`scoring_results`è·¯å¾„å®šä¹‰ï¼Œè·¯å¾„ç¡¬ç¼–ç æ•£å¸ƒåœ¨ï¼š
- production/scoring_engine/integrated_scorer.py
- production/servers/final_heatmap_server.py
- production/core_modules/url_sync_service.py
- ç­‰11ä¸ªå…¶ä»–æ–‡ä»¶

### 1.3 å¹½çµè·¯å¾„é—®é¢˜

æ–‡æ¡£ä¸­å­˜åœ¨ä½†å®é™…ä¸å­˜åœ¨çš„è·¯å¾„ï¼š
1. `/csv_versions/comparison_cache/` - è®¡åˆ’çš„ç¼“å­˜ç›®å½•
2. `/csv_versions/comparison/` - è®¡åˆ’çš„å¯¹æ¯”ç›®å½•
3. `/csv_versions/standard_outputs/` - è®¡åˆ’çš„æ ‡å‡†åŒ–è¾“å‡º

---

## äºŒã€æ•°æ®æµç¨‹åˆ†æ

### 2.1 å®é™…æ•°æ®æµï¼ˆå·²éªŒè¯ï¼‰

```mermaid
graph LR
    A[è…¾è®¯æ–‡æ¡£] -->|ä¸‹è½½| B[downloads/]
    B -->|è½¬æ¢| C[csv_versions/]
    C -->|å¯¹æ¯”| D[comparison_results/]
    D -->|æ‰“åˆ†| E[scoring_results/detailed/]
    E -->|èšåˆ| F[ç»¼åˆæ‰“åˆ†]
    F -->|å±•ç¤º| G[8089 UI]
    
    style E fill:#ff9999
```

**å…³é”®å‘ç°**ï¼š
- scoring_resultsè·¯å¾„é”™è¯¯å‘ç”Ÿåœ¨æ­¥éª¤E
- ç”±äºè·¯å¾„è®¡ç®—é”™è¯¯ï¼Œè¯¦ç»†æ‰“åˆ†å­˜å‚¨åœ¨`/root/projects/`è€Œé`/root/projects/tencent-doc-manager/`

### 2.2 è·¯å¾„ä½¿ç”¨ç»Ÿè®¡

| è·¯å¾„ç±»å‹ | å®šä¹‰æ–¹å¼ | æ–‡ä»¶æ•° | ä¸€è‡´æ€§ |
|---------|---------|--------|--------|
| downloads | ç¡¬ç¼–ç  | 15+ | âœ… ä¸€è‡´ |
| csv_versions | ç¡¬ç¼–ç  | 8+ | âœ… ä¸€è‡´ |
| comparison_results | ç¡¬ç¼–ç  | 10+ | âœ… ä¸€è‡´ |
| scoring_results | ç›¸å¯¹è®¡ç®— | 14+ | âŒ ä¸ä¸€è‡´ |
| semantic_results | ç¡¬ç¼–ç  | 5+ | âœ… ä¸€è‡´ |

---

## ä¸‰ã€è§£å†³æ–¹æ¡ˆå®æ–½

### 3.1 åˆ›å»ºç»Ÿä¸€è·¯å¾„é…ç½®

**æ–‡ä»¶**: `/root/projects/tencent-doc-manager/config/unified_paths.json`

```json
{
  "base_paths": {
    "project_root": "/root/projects/tencent-doc-manager",
    "parent_root": "/root/projects"
  },
  "storage_paths": {
    "scoring_results": {
      "detailed": {
        "path": "{project_root}/scoring_results/detailed",
        "warning": "å†å²é”™è¯¯ï¼šæ›¾åœ¨parent_rootä¸‹"
      }
    }
    // ... å…¶ä»–è·¯å¾„é…ç½®
  }
}
```

### 3.2 åˆ›å»ºè·¯å¾„ç®¡ç†å™¨

**æ–‡ä»¶**: `/root/projects/tencent-doc-manager/production/core_modules/path_manager.py`

#### æ ¸å¿ƒåŠŸèƒ½
1. **å•ä¾‹æ¨¡å¼**: ç¡®ä¿å…¨å±€å”¯ä¸€è·¯å¾„ç®¡ç†
2. **è·¯å¾„è§£æ**: æ”¯æŒæ¨¡æ¿å˜é‡æ›¿æ¢
3. **å‘åå…¼å®¹**: é€šè¿‡ç¯å¢ƒå˜é‡æ”¯æŒæ—§è·¯å¾„
4. **è·¯å¾„éªŒè¯**: è‡ªåŠ¨æ£€æŸ¥è·¯å¾„å­˜åœ¨æ€§
5. **æ¸…ç†åŠŸèƒ½**: è‡ªåŠ¨æ¸…ç†downloadsæ—§æ–‡ä»¶

#### ä½¿ç”¨ç¤ºä¾‹
```python
from production.core_modules.path_manager import path_manager

# è·å–è·¯å¾„
downloads_path = path_manager.get_path("downloads")
scoring_path = path_manager.get_scoring_results_path(detailed=True)

# éªŒè¯æ‰€æœ‰è·¯å¾„
results = path_manager.verify_paths(fix_missing=True)

# æ¸…ç†æ—§æ–‡ä»¶
path_manager.cleanup_downloads(days=7)
```

### 3.3 ä¿®å¤integrated_scorer.py

#### åŸä»£ç ï¼ˆé”™è¯¯ï¼‰
```python
output_dir = os.path.join(
    os.path.dirname(os.path.dirname(os.path.dirname(input_file))),
    'scoring_results',
    'detailed'
)
```

#### ä¿®å¤åä»£ç 
```python
from production.core_modules.path_manager import path_manager

# ä½¿ç”¨ç»Ÿä¸€è·¯å¾„ç®¡ç†å™¨
output_dir = path_manager.get_scoring_results_path(detailed=True)
```

---

## å››ã€å®æ–½è®¡åˆ’

### 4.1 ç¬¬ä¸€é˜¶æ®µï¼šç´§æ€¥ä¿®å¤ï¼ˆç«‹å³æ‰§è¡Œï¼‰

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | çŠ¶æ€ | è¯´æ˜ |
|-----|--------|------|------|
| åˆ›å»ºunified_paths.json | P0 | âœ… å®Œæˆ | ç»Ÿä¸€è·¯å¾„é…ç½®æ–‡ä»¶ |
| åˆ›å»ºPathManagerç±» | P0 | âœ… å®Œæˆ | è·¯å¾„ç®¡ç†æ ¸å¿ƒæ¨¡å— |
| ä¿®å¤integrated_scorer.py | P0 | å¾…æ‰§è¡Œ | ä¿®æ­£è·¯å¾„è®¡ç®—é€»è¾‘ |
| è¿ç§»scoring_results | P0 | å¾…æ‰§è¡Œ | ä»é”™è¯¯ä½ç½®è¿ç§»åˆ°æ­£ç¡®ä½ç½® |

### 4.2 ç¬¬äºŒé˜¶æ®µï¼šç³»ç»Ÿæ”¹é€ ï¼ˆ1å‘¨å†…ï¼‰

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å½±å“èŒƒå›´ |
|-----|--------|----------|
| æ›´æ–°æ‰€æœ‰æ¨¡å—ä½¿ç”¨PathManager | P1 | 14ä¸ªæ–‡ä»¶ |
| å®ç°downloadsè‡ªåŠ¨æ¸…ç† | P1 | 350+æ–‡ä»¶ç§¯å‹ |
| åˆ é™¤å¹½çµè·¯å¾„å¼•ç”¨ | P1 | 3ä¸ªä¸å­˜åœ¨è·¯å¾„ |
| æ·»åŠ è·¯å¾„å¥åº·æ£€æŸ¥API | P2 | ç›‘æ§ç³»ç»Ÿ |

### 4.3 ç¬¬ä¸‰é˜¶æ®µï¼šé•¿æœŸä¼˜åŒ–ï¼ˆ1ä¸ªæœˆï¼‰

| ä»»åŠ¡ | ç›®æ ‡ | é¢„æœŸæ•ˆæœ |
|-----|------|----------|
| è·¯å¾„ç‰ˆæœ¬ç®¡ç† | æ”¯æŒå¹³æ»‘è¿ç§» | é›¶åœæœºå‡çº§ |
| è·¯å¾„ç›‘æ§å‘Šè­¦ | å®æ—¶å‘ç°é—®é¢˜ | ä¸»åŠ¨é˜²å¾¡ |
| æ–‡æ¡£è‡ªåŠ¨éªŒè¯ | ä¿æŒæ–‡æ¡£å‡†ç¡® | å‡å°‘æŠ€æœ¯å€ºåŠ¡ |

---

## äº”ã€é£é™©è¯„ä¼°ä¸ç¼“è§£

### 5.1 é£é™©çŸ©é˜µ

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|----------|
| è·¯å¾„è¿ç§»æ•°æ®ä¸¢å¤± | ä½ | é«˜ | å…ˆå¤‡ä»½å†è¿ç§» |
| å‘åå…¼å®¹æ€§ç ´å | ä¸­ | é«˜ | ç¯å¢ƒå˜é‡æ§åˆ¶ |
| æ€§èƒ½ä¸‹é™ | ä½ | ä½ | è·¯å¾„ç¼“å­˜æœºåˆ¶ |

### 5.2 å›æ»šæ–¹æ¡ˆ

```bash
# å¦‚éœ€å›æ»šåˆ°æ—§è·¯å¾„ç³»ç»Ÿ
export USE_LEGACY_SCORING_PATH=true
# ç³»ç»Ÿå°†ä½¿ç”¨æ—§çš„é”™è¯¯è·¯å¾„
```

---

## å…­ã€éªŒè¯ä¸æµ‹è¯•

### 6.1 è·¯å¾„ä¸€è‡´æ€§æµ‹è¯•

```python
# è¿è¡Œè·¯å¾„éªŒè¯è„šæœ¬
python3 /root/projects/tencent-doc-manager/production/core_modules/path_manager.py
```

é¢„æœŸè¾“å‡ºï¼š
```
=== è·¯å¾„ç®¡ç†å™¨æµ‹è¯• ===
1. æ‰€æœ‰é…ç½®è·¯å¾„: [åˆ—å‡ºæ‰€æœ‰è·¯å¾„]
2. è·¯å¾„éªŒè¯ç»“æœ: [æ˜¾ç¤ºå­˜åœ¨æ€§]
3. è·å–ç‰¹å®šè·¯å¾„: [æ˜¾ç¤ºè·¯å¾„å€¼]
```

### 6.2 æ•°æ®æµæµ‹è¯•

1. ä¸‹è½½æµ‹è¯•æ–‡ä»¶åˆ°downloads/
2. è¿è¡Œå¯¹æ¯”åˆ†æ
3. éªŒè¯scoring_resultsç”Ÿæˆä½ç½®
4. ç¡®è®¤UIèƒ½æ­£ç¡®è¯»å–

---

## ä¸ƒã€æ–‡æ¡£æ›´æ–°æ¸…å•

### éœ€è¦æ›´æ–°çš„æ–‡æ¡£

| æ–‡æ¡£ | æ›´æ–°å†…å®¹ | ä¼˜å…ˆçº§ |
|------|---------|--------|
| 0000-å®Œæ•´å­˜å‚¨è·¯å¾„ç´¢å¼•.md | ä¿®æ­£scoring_resultsè·¯å¾„ | P0 |
| 06-è¯¦ç»†åˆ†è¡¨æ‰“åˆ†æ–¹æ³•è§„èŒƒ.md | æ›´æ–°è·¯å¾„å¼•ç”¨ | P1 |
| 07-ç»¼åˆé›†æˆæ‰“åˆ†ç®—æ³•è§„èŒƒ.md | æ›´æ–°æ•°æ®æµè·¯å¾„ | P1 |
| 01-ç³»ç»Ÿæ€»ä½“æ¶æ„.md | åæ˜ å®é™…æ¶æ„ | P2 |

### éœ€è¦åˆ é™¤çš„å†…å®¹

1. æ‰€æœ‰æåŠ8098 AIæœåŠ¡çš„å¼ºåˆ¶è¦æ±‚ï¼ˆæœåŠ¡å·²åœç”¨ï¼‰
2. å¹½çµè·¯å¾„å¼•ç”¨ï¼ˆcomparison_cacheç­‰ï¼‰
3. åˆ†å¸ƒå¼æ¶æ„æè¿°ï¼ˆå®é™…æ˜¯å•ä½“ï¼‰

---

## å…«ã€ç›‘æ§æŒ‡æ ‡

### 8.1 å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | ç›‘æ§æ–¹æ³• |
|------|--------|--------|----------|
| è·¯å¾„ä¸€è‡´æ€§ | 75% | 100% | è‡ªåŠ¨éªŒè¯è„šæœ¬ |
| downloadsæ–‡ä»¶æ•° | 350+ | <50 | å®šæœŸæ¸…ç†ä»»åŠ¡ |
| è·¯å¾„é”™è¯¯ç‡ | 25% | 0% | å¼‚å¸¸æ—¥å¿—ç›‘æ§ |

### 8.2 å‘Šè­¦è§„åˆ™

```python
# è·¯å¾„å¥åº·æ£€æŸ¥
if not path_manager.verify_paths():
    send_alert("è·¯å¾„ç³»ç»Ÿå¼‚å¸¸")

# downloadsç§¯å‹æ£€æŸ¥
if count_files(downloads_path) > 100:
    send_alert("downloadséœ€è¦æ¸…ç†")
```

---

## ä¹ã€ç»“è®ºä¸å»ºè®®

### 9.1 ä¸»è¦å‘ç°

1. **æ ¹æœ¬åŸå› **: ç›¸å¯¹è·¯å¾„è®¡ç®—å¯¼è‡´scoring_resultsä½ç½®é”™è¯¯
2. **å½±å“èŒƒå›´**: 14ä¸ªæ–‡ä»¶å—å½±å“ï¼Œæ ¸å¿ƒæ‰“åˆ†åŠŸèƒ½å­˜åœ¨é£é™©
3. **æŠ€æœ¯å€ºåŠ¡**: è·¯å¾„ç¡¬ç¼–ç ä¸¥é‡ï¼Œç¼ºä¹ç»Ÿä¸€ç®¡ç†

### 9.2 æ ¸å¿ƒå»ºè®®

1. **ç«‹å³è¡ŒåŠ¨**: ä¿®å¤integrated_scorer.pyçš„è·¯å¾„è®¡ç®—
2. **çŸ­æœŸæ”¹è¿›**: å…¨é¢é‡‡ç”¨PathManagerç»Ÿä¸€ç®¡ç†
3. **é•¿æœŸè§„åˆ’**: å»ºç«‹è·¯å¾„æ²»ç†ä½“ç³»ï¼Œé˜²æ­¢é—®é¢˜é‡ç°

### 9.3 ç»éªŒæ•™è®­

1. **é¿å…ç›¸å¯¹è·¯å¾„è®¡ç®—**: å®¹æ˜“å‡ºé”™ä¸”éš¾ä»¥ç»´æŠ¤
2. **é›†ä¸­é…ç½®ç®¡ç†**: æ‰€æœ‰è·¯å¾„åº”ä»é…ç½®æ–‡ä»¶è¯»å–
3. **å®šæœŸéªŒè¯**: è‡ªåŠ¨åŒ–æ£€æŸ¥è·¯å¾„ä¸€è‡´æ€§
4. **æ–‡æ¡£åŒæ­¥**: ä»£ç å˜æ›´å¿…é¡»åŒæ­¥æ›´æ–°æ–‡æ¡£

---

## é™„å½•Aï¼šå¿«é€Ÿä¿®å¤å‘½ä»¤

```bash
# 1. å¤‡ä»½ç°æœ‰scoring_results
cp -r /root/projects/scoring_results /root/projects/scoring_results.backup

# 2. åˆ›å»ºæ­£ç¡®ä½ç½®çš„ç›®å½•
mkdir -p /root/projects/tencent-doc-manager/scoring_results/detailed

# 3. è¿ç§»æ•°æ®
mv /root/projects/scoring_results/detailed/* \
   /root/projects/tencent-doc-manager/scoring_results/detailed/

# 4. éªŒè¯è·¯å¾„
python3 /root/projects/tencent-doc-manager/production/core_modules/path_manager.py

# 5. æ¸…ç†downloads
find /root/projects/tencent-doc-manager/downloads -mtime +7 -delete
```

## é™„å½•Bï¼šç¯å¢ƒå˜é‡é…ç½®

```bash
# æ·»åŠ åˆ° ~/.bashrc æˆ–ç³»ç»Ÿç¯å¢ƒå˜é‡

# ä½¿ç”¨æ–°è·¯å¾„ç³»ç»Ÿï¼ˆæ¨èï¼‰
export USE_LEGACY_SCORING_PATH=false

# å¯ç”¨è·¯å¾„è°ƒè¯•æ—¥å¿—
export PATH_DEBUG=true

# è®¾ç½®è‡ªåŠ¨æ¸…ç†å‘¨æœŸï¼ˆå¤©ï¼‰
export DOWNLOADS_CLEANUP_DAYS=7
```

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-09-10*  
*ç³»ç»Ÿç‰ˆæœ¬: v2.0*  
*åˆ†ææ·±åº¦: UltraThinkæ¨¡å¼*