# 0000 - 系统统一颜色和级别打分标准

> 本文档定义了整个系统的统一打分标准和颜色映射规则，所有模块必须严格遵循本标准。

## 1. 颜色打分阈值标准

### 1.1 打分颜色映射表

| 打分范围 | 颜色 | 颜色代码 | 风险等级 | 描述 |
|---------|------|---------|---------|------|
| score ≥ 0.8 | 红色 | #FF0000 | 极高风险 | 关键修改，需要立即关注 |
| 0.6 ≤ score < 0.8 | 橙色 | #FFA500 | 高风险 | 重要修改，需要重点审查 |
| 0.4 ≤ score < 0.6 | 黄色 | #FFFF00 | 中风险 | 一般修改，需要常规审查 |
| 0.1 ≤ score < 0.4 | 绿色 | #00FF00 | 低风险 | 轻微修改，可以快速审查 |
| score < 0.1 | 蓝色 | #0000FF | 极低风险 | 微小修改，基本可以忽略 |

### 1.2 应用说明

- **Excel表格涂色**：直接使用上述颜色代码对修改单元格进行背景色标记
- **UI热力图渲染**：基于上述颜色进行渐变渲染，支持平滑过渡效果
- **风险评估报告**：使用风险等级描述进行文字说明

## 2. 三级列表基础得分标准

### 2.1 列级别定义

| 列级别 | 最低基础得分 | 权重系数 | 说明 |
|--------|------------|---------|------|
| L1 | 0.8 | 1.0 | 核心关键列，任何修改都是高风险 |
| L2 | 0.4 | 0.5 | 重要业务列，修改需要AI评估 |
| L3 | 0.1 | 0.2 | 一般信息列，修改风险较低 |

### 2.2 得分计算公式

```
最终得分 = max(基础得分, 实际计算得分 × 权重系数)
```

### 2.3 特殊规则

1. **L1列修改**：无论修改内容如何，最终得分不得低于0.8
2. **L2列修改**：
   - 基础得分不得低于0.4
   - 需要AI智能评估介入
   - 根据AI评估结果可能上调得分
3. **L3列修改**：
   - 基础得分大于0.1即可
   - 仅做基础对比，不需要AI介入

## 3. 打分流程标准

### 3.1 CSV对比阶段

1. **差异检测**：识别baseline和current之间的所有差异
2. **列级别识别**：根据列名确定L1/L2/L3级别
3. **基础打分**：应用最低基础得分

### 3.2 AI分析打分阶段

1. **L2列AI评估**：
   - 输入：修改前后内容、列名、上下文
   - 输出：风险评分（0-1）
   - 调整：max(0.4, AI评分)

2. **打分聚合**：
   - 单元格级别：直接使用计算得分
   - 列级别：加权平均（考虑修改数量）
   - 表级别：所有修改的加权平均

### 3.3 综合打分生成

综合打分JSON必须包含以下五个关键内容：

1. **所有表名列表** (`table_names`)
2. **每标准列平均加权修改打分** (`column_avg_scores`)
3. **每列具体修改行数和打分** (`column_modifications`)
4. **表格URL列表** (`table_urls`)
5. **全部修改数** (`total_modifications`)

## 4. 数据结构标准

### 4.1 综合打分JSON结构

```json
{
  "generation_time": "2025-09-13T10:00:00",
  "scoring_version": "2.0",
  "table_scores": [
    {
      "table_id": 0,
      "table_name": "表格名称",
      "table_url": "https://docs.qq.com/sheet/xxx",
      "total_modifications": 15,
      "overall_risk_score": 0.65,
      "column_scores": {
        "列名": {
          "avg_score": 0.75,
          "modified_rows": [1, 5, 10, 15],
          "row_scores": [0.8, 0.7, 0.75, 0.8],
          "column_level": "L1"
        }
      }
    }
  ],
  "column_avg_scores": {
    "列名1": 0.65,
    "列名2": 0.45
  },
  "total_modifications": 150,
  "risk_summary": {
    "high_risk_count": 30,
    "medium_risk_count": 50,
    "low_risk_count": 70
  }
}
```

## 5. UI热力图参数获取规则

### 5.1 强制要求

- **唯一数据源**：UI热力图只能从综合打分JSON文件获取数据
- **禁止直接访问**：不允许直接访问CSV文件、详细打分文件或其他中间文件
- **数据完整性**：综合打分文件必须包含上述五个关键内容

### 5.2 UI展示映射

| UI元素 | 数据来源 | 字段路径 |
|--------|---------|---------|
| 热力图矩阵 | 综合打分 | `table_scores[].column_scores[].avg_score` |
| 表格名称 | 综合打分 | `table_scores[].table_name` |
| 右侧总修改数 | 综合打分 | `table_scores[].total_modifications` |
| 列修改分布 | 综合打分 | `table_scores[].column_scores[].modified_rows` |
| 颜色渲染 | 本标准1.1节 | 根据score值映射 |

## 6. 验证规则

### 6.1 打分验证

```python
def validate_score(score, column_level):
    """验证打分是否符合标准"""
    if column_level == 'L1' and score < 0.8:
        return False, "L1列打分不能低于0.8"
    if column_level == 'L2' and score < 0.4:
        return False, "L2列打分不能低于0.4"
    if column_level == 'L3' and score <= 0.1:
        return False, "L3列打分必须大于0.1"
    return True, "打分有效"
```

### 6.2 颜色映射验证

```python
def get_color(score):
    """根据打分获取颜色"""
    if score >= 0.8:
        return "#FF0000"  # 红色
    elif score >= 0.6:
        return "#FFA500"  # 橙色
    elif score >= 0.4:
        return "#FFFF00"  # 黄色
    elif score >= 0.1:
        return "#00FF00"  # 绿色
    else:
        return "#0000FF"  # 蓝色
```

## 7. 更新历史

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|---------|--------|
| 1.0 | 2025-09-13 | 初始版本，统一颜色和打分标准 | System |

## 8. 强制执行说明

本标准自发布之日起立即生效，所有相关模块必须：

1. **立即更新**：更新代码以符合本标准
2. **严格遵守**：不得擅自修改阈值或颜色映射
3. **统一引用**：所有文档必须引用本标准，不得重复定义
4. **版本控制**：任何修改必须更新版本号和更新历史

---

**注意**：本文档是系统的核心标准文档，任何模块都必须严格遵循。如需修改，必须经过完整的评审流程。