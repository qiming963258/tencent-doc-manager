# çƒ­åŠ›å›¾ç®—æ³•æ¸²æŸ“å®ç°æŠ€æœ¯è§„æ ¼

## æ–‡æ¡£ç‰ˆæœ¬
- ç‰ˆæœ¬ï¼š4.0ï¼ˆé«˜é£é™©æ·±çº¢ä¼˜åŒ–ç‰ˆï¼‰
- åˆ›å»ºæ—¥æœŸï¼š2025-09-11
- æ›´æ–°æ—¥æœŸï¼š2025-09-18
- ä½œè€…ï¼šClaude Code
- çŠ¶æ€ï¼šå·²å®ç°å¹¶éƒ¨ç½²ï¼ˆ8089ç”Ÿäº§ç¯å¢ƒï¼‰
- æœ€æ–°æ›´æ–°ï¼šä¿®å¤é«˜é£é™©å€¼æ˜¾ç¤ºä¸ºæ·±çº¢è‰²è€Œéç™½è‰²

## ğŸ“Œ æœ¬è§„èŒƒèŒè´£
- **åŒ…å«**ï¼šçƒ­åŠ›å›¾æ¸²æŸ“ç®—æ³•ã€è‰²å½©æ˜ å°„ã€æ’å€¼ç®—æ³•ã€èšç±»ä¼˜åŒ–
- **ä¸åŒ…å«**ï¼šæ‰“åˆ†ç®—æ³•ï¼ˆè§10è§„èŒƒï¼‰ã€æ•°æ®æºç®¡ç†ï¼ˆè§10è§„èŒƒï¼‰

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 åŸºæœ¬ä¿¡æ¯
- **ç”Ÿäº§ç«¯å£**ï¼š8089
- **æµ‹è¯•ç«¯å£**ï¼š8090
- **æŠ€æœ¯æ ˆ**ï¼šCanvas 2D + WebGLæ¸²æŸ“
- **çƒ­åŠ›å›¾çŸ©é˜µ**ï¼šNÃ—19ï¼ˆNä¸ºåŠ¨æ€è¡¨æ ¼æ•°é‡ï¼‰

### 1.2 æ ¸å¿ƒåŠŸèƒ½
å®ç°ä»æ•°å€¼çŸ©é˜µåˆ°è¿ç»­çƒ­åŠ›åœºå¯è§†åŒ–çš„ä¸“ä¸šçº§æ¸²æŸ“ï¼Œé‡‡ç”¨å¤šå±‚ç®—æ³•ç»„åˆå®ç°çƒ­æˆåƒæ•ˆæœã€‚

---

## 2. æ ¸å¿ƒæ¸²æŸ“ç®—æ³•

### 2.1 IDWåè·ç¦»åŠ æƒæ’å€¼ç®—æ³•

#### 2.1.1 ç®—æ³•å‚æ•°
```javascript
powerParameter = 2.0;  // åŠŸç‡å‚æ•°ï¼ˆè·ç¦»å¹³æ–¹åæ¯”ï¼‰
maxInfluenceDistance = cellSize * 3;  // æœ€å¤§å½±å“è·ç¦»ï¼ˆ96åƒç´ ï¼‰
```

#### 2.1.2 æ ¸å¿ƒå…¬å¼
```javascript
// IDWæ’å€¼æ ¸å¿ƒå®ç°
for (const source of heatSources) {
  const distance = Math.sqrt((x - source.x)Â² + (y - source.y)Â²);

  if (distance < 1) {
    // æè¿‘è·ç¦»ç›´æ¥ä½¿ç”¨æºå€¼
    weightedSum = source.intensity;
    weightSum = 1;
    break;
  }

  if (distance <= maxInfluenceDistance) {
    const weight = 1 / Math.pow(distance, powerParameter);
    weightedSum += source.intensity * weight;
    weightSum += weight;
  }
}

finalIntensity = weightedSum / weightSum;
```

#### 2.1.3 è¾¹ç•Œå¤„ç†ç­–ç•¥
- **æè¿‘è·ç¦»**ï¼ˆ< 1pxï¼‰ï¼šç›´æ¥ä½¿ç”¨æºç‚¹å¼ºåº¦å€¼
- **å½±å“èŒƒå›´å†…**ï¼ˆâ‰¤ 3*cellSizeï¼‰ï¼šæ ‡å‡†IDWæ’å€¼
- **å½±å“èŒƒå›´å¤–**ï¼šæŒ‡æ•°è¡°å‡è¡¥å¿

### 2.2 FLIRçƒ­æˆåƒè‰²å½©æ˜ å°„

#### 2.2.1 8æ®µç²¾ç¡®è‰²å½©è¿‡æ¸¡
```javascript
// çƒ­æˆåƒé¢œè‰²æ˜ å°„è¡¨
const colorStops = [
  { value: 0.000, color: [0, 0, 0] },       // é»‘è‰²
  { value: 0.125, color: [0, 0, 139] },     // æ·±è“
  { value: 0.250, color: [0, 0, 255] },     // çº¯è“
  { value: 0.375, color: [100, 255, 255] }, // é’è‰²
  { value: 0.500, color: [0, 255, 55] },    // ç»¿è‰²
  { value: 0.625, color: [255, 255, 0] },   // é»„è‰²
  { value: 0.750, color: [255, 128, 0] },   // æ©™è‰²
  { value: 0.875, color: [255, 0, 0] },     // çº¢è‰²
  { value: 1.000, color: [255, 255, 255] }  // ç™½è‰²ï¼ˆæå€¼ï¼‰
];
```

#### 2.2.2 çº¿æ€§æ’å€¼è®¡ç®—
```javascript
function interpolateColor(value) {
  // æ‰¾åˆ°ç›¸é‚»çš„ä¸¤ä¸ªé¢œè‰²åœé ç‚¹
  for (let i = 0; i < colorStops.length - 1; i++) {
    if (value <= colorStops[i + 1].value) {
      const lower = colorStops[i];
      const upper = colorStops[i + 1];

      // è®¡ç®—æ’å€¼æ¯”ä¾‹
      const range = upper.value - lower.value;
      const t = (value - lower.value) / range;

      // RGBçº¿æ€§æ’å€¼
      const r = Math.floor(lower.color[0] + t * (upper.color[0] - lower.color[0]));
      const g = Math.floor(lower.color[1] + t * (upper.color[1] - lower.color[1]));
      const b = Math.floor(lower.color[2] + t * (upper.color[2] - lower.color[2]));

      return `rgb(${r}, ${g}, ${b})`;
    }
  }
}
```

### 2.3 çƒ­æ‰©æ•£ç®—æ³•

#### 2.3.1 ç®—æ³•å‚æ•°
```python
iterations = 3        # è¿­ä»£æ¬¡æ•°ï¼ˆè½»åº¦æ‰©æ•£ï¼‰
diffusion_rate = 0.08 # æ‰©æ•£ç‡ï¼ˆä¿ç•™çœŸå®çƒ­ç‚¹ï¼‰
```

#### 2.3.2 5Ã—5é‚»åŸŸæ‰©æ•£
```python
# æ‰©æ•£æ ¸ï¼ˆé«˜æ–¯æƒé‡ï¼‰
kernel = [
  [0.003, 0.013, 0.022, 0.013, 0.003],
  [0.013, 0.059, 0.097, 0.059, 0.013],
  [0.022, 0.097, 0.159, 0.097, 0.022],
  [0.013, 0.059, 0.097, 0.059, 0.013],
  [0.003, 0.013, 0.022, 0.013, 0.003]
]
```

#### 2.3.3 æ‰©æ•£è®¡ç®—
```python
def apply_heat_diffusion(matrix, iterations=3):
    """åº”ç”¨çƒ­æ‰©æ•£ç®—æ³•"""
    result = matrix.copy()

    for _ in range(iterations):
        temp = np.zeros_like(result)

        for i in range(2, rows-2):
            for j in range(2, cols-2):
                # åº”ç”¨5Ã—5å·ç§¯æ ¸
                weighted_sum = 0
                for ki in range(5):
                    for kj in range(5):
                        weighted_sum += result[i-2+ki, j-2+kj] * kernel[ki][kj]

                # æ··åˆåŸå€¼å’Œæ‰©æ•£å€¼
                temp[i, j] = result[i, j] * (1 - diffusion_rate) + weighted_sum * diffusion_rate

        result = temp

    return result
```

---

## 3. é«˜çº§èšç±»ä¼˜åŒ–ç®—æ³•

### 3.1 Getis-Ord Gi*çƒ­ç‚¹æ£€æµ‹

#### 3.1.1 ç®—æ³•åŸç†
è¯†åˆ«ç»Ÿè®¡æ˜¾è‘—çš„ç©ºé—´èšé›†æ¨¡å¼ï¼ˆçƒ­ç‚¹å’Œå†·ç‚¹ï¼‰

#### 3.1.2 Z-scoreè®¡ç®—
```python
def calculate_getis_ord(matrix):
    """è®¡ç®—Getis-Ord Gi*ç»Ÿè®¡é‡"""
    n = matrix.size
    mean = np.mean(matrix)
    std = np.std(matrix)

    z_scores = np.zeros_like(matrix)

    for i in range(rows):
        for j in range(cols):
            # è®¡ç®—å±€éƒ¨å’Œ
            neighbors = get_neighbors(i, j, radius=2)
            local_sum = sum(matrix[ni, nj] for ni, nj in neighbors)

            # è®¡ç®—Z-score
            expected = mean * len(neighbors)
            variance = std * np.sqrt(len(neighbors))
            z_scores[i, j] = (local_sum - expected) / variance

    return z_scores
```

#### 3.1.3 æ˜¾è‘—æ€§åˆ¤å®š
```python
# p < 0.05çš„æ˜¾è‘—æ€§é˜ˆå€¼
if abs(z_score) > 1.96:
    if z_score > 0:
        # æ˜¾è‘—çƒ­ç‚¹
        classification = "HOT_SPOT"
    else:
        # æ˜¾è‘—å†·ç‚¹
        classification = "COLD_SPOT"
```

### 3.2 SpectralCoclusteringåŒèšç±»

#### 3.2.1 ç®—æ³•ç›®æ ‡
åŒæ—¶ä¼˜åŒ–è¡Œå’Œåˆ—çš„æ’åºï¼Œä½¿ç›¸ä¼¼çš„è¡Œ/åˆ—èšé›†åœ¨ä¸€èµ·

#### 3.2.2 å®ç°æ­¥éª¤
```python
def apply_spectral_coclustering(matrix):
    """åº”ç”¨è°±åŒèšç±»ç®—æ³•"""
    from sklearn.cluster.bicluster import SpectralCoclustering

    # åˆ›å»ºæ¨¡å‹
    model = SpectralCoclustering(
        n_clusters=(3, 3),  # 3Ã—3èšç±»ç½‘æ ¼
        method='bistochastic',
        n_init=10,
        random_state=42
    )

    # æ‹Ÿåˆæ¨¡å‹
    model.fit(matrix)

    # è·å–è¡Œåˆ—æ’åº
    row_order = np.argsort(model.row_labels_)
    col_order = np.argsort(model.column_labels_)

    return row_order, col_order
```

### 3.3 Cuthill-McKeeå¸¦å®½ä¼˜åŒ–

#### 3.3.1 ç®—æ³•ç›®æ ‡
æœ€å°åŒ–çŸ©é˜µå¸¦å®½ï¼Œæé«˜ç©ºé—´è¿ç»­æ€§

#### 3.3.2 å®ç°
```python
def cuthill_mckee_ordering(adjacency_matrix):
    """Cuthill-McKeeç®—æ³•ä¼˜åŒ–çŸ©é˜µå¸¦å®½"""
    from scipy.sparse.csgraph import reverse_cuthill_mckee

    # åº”ç”¨RCMç®—æ³•
    perm = reverse_cuthill_mckee(adjacency_matrix)

    return perm
```

---

## 4. Canvasæ¸²æŸ“ä¼˜åŒ–æŠ€æœ¯

### 4.1 åŒç¼“å†²æ¸²æŸ“
```javascript
// åˆ›å»ºç¦»å±ç”»å¸ƒ
const offscreenCanvas = document.createElement('canvas');
const offscreenCtx = offscreenCanvas.getContext('2d');

// ç¦»å±æ¸²æŸ“
renderHeatmap(offscreenCtx);

// ä¸€æ¬¡æ€§ç»˜åˆ¶åˆ°ä¸»ç”»å¸ƒ
mainCtx.drawImage(offscreenCanvas, 0, 0);
```

### 4.2 å›¾åƒæ•°æ®ç›´æ¥æ“ä½œ
```javascript
// ç›´æ¥æ“ä½œåƒç´ æ•°æ®
const imageData = ctx.createImageData(width, height);
const data = imageData.data;

for (let i = 0; i < data.length; i += 4) {
  const intensity = calculateIntensity(i / 4);
  const color = getColorForIntensity(intensity);

  data[i] = color.r;     // Red
  data[i + 1] = color.g; // Green
  data[i + 2] = color.b; // Blue
  data[i + 3] = 255;     // Alpha
}

ctx.putImageData(imageData, 0, 0);
```

### 4.3 æ¸å˜ç¼“å­˜
```javascript
// é¢„ç”Ÿæˆæ¸å˜è‰²è°±
const gradientCanvas = createGradientCanvas();
const gradientCtx = gradientCanvas.getContext('2d');
const gradient = gradientCtx.createLinearGradient(0, 0, 256, 0);

// æ·»åŠ è‰²æ ‡
colorStops.forEach(stop => {
  gradient.addColorStop(stop.value, stop.color);
});

// ç¼“å­˜æ¸å˜æŸ¥æ‰¾è¡¨
const colorLUT = new Uint8ClampedArray(256 * 4);
const imageData = gradientCtx.getImageData(0, 0, 256, 1);
colorLUT.set(imageData.data);
```

---

## 5. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 5.1 åˆ†å—æ¸²æŸ“
- å°†å¤§çŸ©é˜µåˆ†æˆå°å—
- ä½¿ç”¨requestAnimationFrameé€å—æ¸²æŸ“
- é¿å…é•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹

### 5.2 Web Workerså¹¶è¡Œè®¡ç®—
```javascript
// ä¸»çº¿ç¨‹
const worker = new Worker('heatmap-worker.js');
worker.postMessage({
  matrix: matrixData,
  params: renderParams
});

worker.onmessage = (e) => {
  const imageData = e.data;
  ctx.putImageData(imageData, 0, 0);
};
```

### 5.3 WebGLåŠ é€Ÿï¼ˆå¯é€‰ï¼‰
- ä½¿ç”¨WebGLç€è‰²å™¨è¿›è¡Œå¹¶è¡Œæ’å€¼è®¡ç®—
- GPUåŠ é€Ÿé¢œè‰²æ˜ å°„
- é€‚åˆå¤§è§„æ¨¡æ•°æ®æ¸²æŸ“

---

## 6. æ¸²æŸ“å‚æ•°é…ç½®

### 6.1 å¯è°ƒå‚æ•°
```javascript
const renderConfig = {
  // IDWæ’å€¼
  idw: {
    power: 2.0,
    maxDistance: 96,
    minDistance: 1
  },

  // çƒ­æ‰©æ•£
  diffusion: {
    enabled: true,
    iterations: 3,
    rate: 0.08
  },

  // è‰²å½©æ˜ å°„
  colorMap: {
    type: 'FLIR',  // FLIR | JET | HSV | GRAYSCALE
    interpolation: 'linear'  // linear | cubic
  },

  // æ€§èƒ½
  performance: {
    useWebWorkers: true,
    useWebGL: false,
    blockSize: 100
  }
};
```

### 6.2 è‡ªé€‚åº”å‚æ•°
ç³»ç»Ÿæ ¹æ®æ•°æ®ç‰¹å¾è‡ªåŠ¨è°ƒæ•´ï¼š
- ç¨€ç–æ•°æ®ï¼šå¢åŠ æ‰©æ•£è¿­ä»£æ¬¡æ•°
- å¯†é›†æ•°æ®ï¼šå‡å°‘æ’å€¼èŒƒå›´
- å¤§çŸ©é˜µï¼šå¯ç”¨åˆ†å—æ¸²æŸ“

---

## 7. æ¸²æŸ“è´¨é‡ä¿è¯

### 7.1 è§†è§‰ä¸€è‡´æ€§
- ç¡®ä¿ç›¸åŒæ•°å€¼äº§ç”Ÿç›¸åŒé¢œè‰²
- é¢œè‰²è¿‡æ¸¡å¹³æ»‘æ— çªå˜
- è¾¹ç•Œå¤„ç†è‡ªç„¶

### 7.2 æ•°å€¼å‡†ç¡®æ€§
- æ’å€¼ç»“æœå¯éªŒè¯
- é¢œè‰²æ˜ å°„å¯é€†
- ä¿ç•™åŸå§‹çƒ­ç‚¹ç‰¹å¾

### 7.3 æ€§èƒ½æŒ‡æ ‡
- 30Ã—19çŸ©é˜µæ¸²æŸ“ < 100ms
- 60fpsäº¤äº’å“åº”
- å†…å­˜å ç”¨ < 50MB

---

## é™„å½•ï¼šå‚è€ƒå®ç°

### A. å®Œæ•´æ¸²æŸ“æµç¨‹
```javascript
function renderHeatmap(matrix, canvas) {
  const ctx = canvas.getContext('2d');

  // 1. æ•°æ®é¢„å¤„ç†
  const normalizedMatrix = normalizeData(matrix);

  // 2. åº”ç”¨èšç±»ä¼˜åŒ–
  const optimizedMatrix = applyClusteringOptimization(normalizedMatrix);

  // 3. çƒ­æ‰©æ•£å¤„ç†
  const diffusedMatrix = applyHeatDiffusion(optimizedMatrix);

  // 4. IDWæ’å€¼
  const interpolatedData = applyIDWInterpolation(diffusedMatrix);

  // 5. é¢œè‰²æ˜ å°„
  const imageData = mapToColors(interpolatedData);

  // 6. æ¸²æŸ“åˆ°ç”»å¸ƒ
  ctx.putImageData(imageData, 0, 0);
}
```

### B. é¢œè‰²æŸ¥æ‰¾è¡¨ç”Ÿæˆ
```javascript
function generateColorLUT() {
  const lut = new Array(256);

  for (let i = 0; i < 256; i++) {
    const value = i / 255;
    lut[i] = interpolateColor(value);
  }

  return lut;
}
```

---

**ç»´æŠ¤è¯´æ˜**: æœ¬è§„èŒƒä¸“æ³¨äºæ¸²æŸ“ç®—æ³•å®ç°ï¼Œä¸10è§„èŒƒçš„æ‰“åˆ†é€»è¾‘å®Œå…¨è§£è€¦ã€‚