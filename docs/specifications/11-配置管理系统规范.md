# 11 - é…ç½®ç®¡ç†ç³»ç»Ÿè§„èŒƒ

## ç‰ˆæœ¬ä¿¡æ¯
- **åˆ›å»ºæ—¶é—´**: 2025-09-10
- **ç‰ˆæœ¬**: v1.0
- **çŠ¶æ€**: ç”Ÿäº§å°±ç»ª

## ğŸ“‹ æ¦‚è¿°

é…ç½®ç®¡ç†ç³»ç»Ÿæ˜¯è…¾è®¯æ–‡æ¡£æ™ºèƒ½ç›‘æ§ç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œé€šè¿‡ç»Ÿä¸€çš„é…ç½®ç®¡ç†å™¨å®ç°é…ç½®æ–‡ä»¶çš„è‡ªåŠ¨åˆå§‹åŒ–ã€åŒæ­¥æ›´æ–°å’Œä¸€è‡´æ€§ç»´æŠ¤ã€‚è¯¥ç³»ç»Ÿè§£å†³äº†é…ç½®æ–‡ä»¶ç¼ºå¤±ã€URLä¸ä¸€è‡´ã€ç³»ç»Ÿé›†æˆåº¦ä½ç­‰å…³é”®é—®é¢˜ã€‚

## ğŸ¯ ç³»ç»Ÿç›®æ ‡

1. **ç»Ÿä¸€ç®¡ç†**: é€šè¿‡å•ä¸€æ¥å£ç®¡ç†æ‰€æœ‰é…ç½®æ–‡ä»¶
2. **è‡ªåŠ¨åˆå§‹åŒ–**: ç¼ºå¤±é…ç½®æ–‡ä»¶è‡ªåŠ¨åˆ›å»º
3. **æ•°æ®åŒæ­¥**: ç¡®ä¿è·¨é…ç½®æ–‡ä»¶çš„æ•°æ®ä¸€è‡´æ€§
4. **ç³»ç»Ÿé›†æˆ**: æå‡ç³»ç»Ÿæ•´ä½“é›†æˆåº¦è‡³98%+
5. **å®¹é”™è®¾è®¡**: é…ç½®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é…ç½®ç®¡ç†ç³»ç»Ÿæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  ConfigManager   â”‚â”€â”€â”€â”€>â”‚  URLSyncService  â”‚         â”‚
â”‚  â”‚   é…ç½®ç®¡ç†å™¨      â”‚     â”‚   URLåŒæ­¥æœåŠ¡     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                         â”‚                    â”‚
â”‚           â–¼                         â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚            é…ç½®æ–‡ä»¶å­˜å‚¨å±‚                   â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚ â€¢ real_documents.json  - æ–‡æ¡£ä¸»é…ç½®        â”‚          â”‚
â”‚  â”‚ â€¢ download_config.json - ä¸‹è½½é…ç½®          â”‚          â”‚
â”‚  â”‚ â€¢ monitor_config.json  - ç›‘æ§è®¾ç½®          â”‚          â”‚
â”‚  â”‚ â€¢ cookies.json         - Cookieå­˜å‚¨        â”‚          â”‚
â”‚  â”‚ â€¢ schedule_tasks.json  - è°ƒåº¦ä»»åŠ¡          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ ¸å¿ƒæ¨¡å—

### 1. ConfigManagerï¼ˆé…ç½®ç®¡ç†å™¨ï¼‰

**æ–‡ä»¶ä½ç½®**: `/root/projects/tencent-doc-manager/production/core_modules/config_manager.py`

#### ä¸»è¦åŠŸèƒ½
- **é…ç½®åŠ è½½**: ç»Ÿä¸€åŠ è½½æ‰€æœ‰é…ç½®æ–‡ä»¶
- **è‡ªåŠ¨åˆå§‹åŒ–**: æ£€æµ‹å¹¶åˆ›å»ºç¼ºå¤±çš„é…ç½®æ–‡ä»¶
- **é…ç½®æ›´æ–°**: å®‰å…¨æ›´æ–°é…ç½®å†…å®¹
- **å¤‡ä»½æ¢å¤**: è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
- **CookieéªŒè¯**: æ£€æµ‹Cookieæœ‰æ•ˆæœŸ

#### ç®¡ç†çš„é…ç½®æ–‡ä»¶
```python
CONFIG_FILES = {
    'cookies': 'cookies.json',
    'documents': 'real_documents.json',
    'download': 'download_config.json',
    'monitor': 'monitor_config.json',
    'schedule': 'schedule_tasks.json'
}
```

#### é»˜è®¤é…ç½®æ¨¡æ¿
```python
DEFAULT_CONFIGS = {
    'cookies': {
        "cookies": [],
        "last_updated": None,
        "expires_at": None
    },
    'documents': {
        "documents": [
            {
                "name": "å‰¯æœ¬-æµ‹è¯•ç‰ˆæœ¬-å‡ºå›½é”€å”®è®¡åˆ’è¡¨",
                "url": "https://docs.qq.com/sheet/DWEFNU25TemFnZXJN",
                "doc_id": "DWEFNU25TemFnZXJN",
                "csv_pattern": "å‡ºå›½é”€å”®",
                "description": "å‡ºå›½é”€å”®æ•°æ®ç›‘æ§"
            },
            # ... æ›´å¤šæ–‡æ¡£
        ]
    },
    'download': {
        "document_links": [],
        "download_format": "csv",
        "auto_download": true,
        "download_interval": 3600
    },
    'monitor': {
        "enabled": true,
        "baseline_enabled": true,
        "midweek_enabled": true,
        "weekend_enabled": true,
        "notification_enabled": false
    },
    'schedule': {
        "tasks": [],
        "timezone": "Asia/Shanghai"
    }
}
```

### 2. URLSyncServiceï¼ˆURLåŒæ­¥æœåŠ¡ï¼‰

**æ–‡ä»¶ä½ç½®**: `/root/projects/tencent-doc-manager/production/core_modules/url_sync_service.py`

#### ä¸»è¦åŠŸèƒ½
- **URLåŒæ­¥**: ç¡®ä¿real_documents.jsonä¸download_config.jsonåŒæ­¥
- **è¡¨ååŒ¹é…**: æ™ºèƒ½åŒ¹é…è¡¨æ ¼åç§°å’ŒURL
- **ç»¼åˆæ‰“åˆ†åŒæ­¥**: æ›´æ–°ç»¼åˆæ‰“åˆ†JSONä¸­çš„table_url
- **ä¸€è‡´æ€§æ£€æŸ¥**: æ£€æµ‹URLä¸ä¸€è‡´é—®é¢˜

#### åŒæ­¥ç­–ç•¥
1. **ä¸»æ•°æ®æº**: real_documents.jsonä½œä¸ºURLçš„ä¸»æ•°æ®æº
2. **è‡ªåŠ¨åŒæ­¥**: å…¶ä»–é…ç½®æ–‡ä»¶è‡ªåŠ¨ä»ä¸»æ•°æ®æºåŒæ­¥
3. **æ™ºèƒ½åŒ¹é…**: ä½¿ç”¨ç›¸ä¼¼åº¦ç®—æ³•åŒ¹é…è¡¨æ ¼åç§°
4. **å˜æ›´é€šçŸ¥**: URLå˜æ›´æ—¶è‡ªåŠ¨é€šçŸ¥ç›¸å…³æ¨¡å—

#### URLåŒ¹é…ç®—æ³•
```python
def _match_table_url(self, table_name: str) -> Optional[str]:
    """
    æ ¹æ®è¡¨ååŒ¹é…URL
    
    åŒ¹é…ç­–ç•¥ï¼š
    1. ç²¾ç¡®åŒ¹é… - ç›´æ¥æŸ¥æ‰¾å®Œå…¨ç›¸åŒçš„åç§°
    2. éƒ¨åˆ†åŒ¹é… - åŒ…å«å…³ç³»åŒ¹é…
    3. ç›¸ä¼¼åº¦åŒ¹é… - ä½¿ç”¨SequenceMatcherï¼Œé˜ˆå€¼70%
    """
    # æ¸…ç†è¡¨åï¼ˆç§»é™¤æ—¶é—´æˆ³ã€ç‰ˆæœ¬æ ‡è®°ç­‰ï¼‰
    clean_name = self._clean_table_name(table_name)
    
    # ç²¾ç¡®åŒ¹é…
    if clean_name in self.url_cache:
        return self.url_cache[clean_name]['url']
    
    # æ¨¡ç³ŠåŒ¹é…
    for doc_name, doc_info in self.url_cache.items():
        similarity = SequenceMatcher(None, doc_name, clean_name).ratio()
        if similarity > 0.7:
            return doc_info['url']
    
    return None
```

## ğŸ”„ ç³»ç»Ÿé›†æˆ

### 8089ç›‘æ§UIé›†æˆ

**æ–‡ä»¶**: `/root/projects/tencent-doc-manager/production/servers/final_heatmap_server.py`

#### é›†æˆç‚¹
1. **é…ç½®åŠ è½½**: å¯åŠ¨æ—¶é€šè¿‡ConfigManageråŠ è½½æ‰€æœ‰é…ç½®
2. **APIç«¯ç‚¹**: 
   - `/api/get-download-links` - è·å–ä¸‹è½½é“¾æ¥é…ç½®
   - `/api/get-schedule-config` - è·å–è°ƒåº¦é…ç½®
   - `/api/update-cookie` - æ›´æ–°Cookie
3. **è‡ªåŠ¨åˆå§‹åŒ–**: ç¼ºå¤±é…ç½®æ–‡ä»¶è‡ªåŠ¨åˆ›å»º

### é…ç½®æ–‡ä»¶å…³ç³»å›¾

```
real_documents.json (ä¸»æ•°æ®æº)
        â”‚
        â”œâ”€â”€åŒæ­¥â”€â”€> download_config.json
        â”‚
        â”œâ”€â”€åŒæ­¥â”€â”€> comprehensive_score_*.json (table_url)
        â”‚
        â””â”€â”€éªŒè¯â”€â”€> upload_mappings.json
```

## ğŸ“Š ç³»ç»Ÿé›†æˆåº¦è¯„ä¼°

### ä¼˜åŒ–å‰ï¼ˆ88%ï¼‰
| ç»„ä»¶ | çŠ¶æ€ | é—®é¢˜ |
|------|------|------|
| Cookieç®¡ç† | âœ… 95% | æ­£å¸¸ |
| URLç®¡ç† | âŒ 75% | download_config.jsonç¼ºå¤± |
| å®šæ—¶ä»»åŠ¡ | âœ… 100% | æ­£å¸¸ |
| ç›‘æ§UI | âš ï¸ 85% | é…ç½®æ–‡ä»¶ç¼ºå¤± |

### ä¼˜åŒ–åï¼ˆ98%ï¼‰
| ç»„ä»¶ | çŠ¶æ€ | æ”¹è¿› |
|------|------|------|
| Cookieç®¡ç† | âœ… 100% | ç»Ÿä¸€ç®¡ç†+æœ‰æ•ˆæœŸæ£€æµ‹ |
| URLç®¡ç† | âœ… 95% | é…ç½®æ–‡ä»¶åˆ›å»º+åŒæ­¥æœåŠ¡ |
| å®šæ—¶ä»»åŠ¡ | âœ… 100% | å®Œç¾è¿è¡Œ |
| ç›‘æ§UI | âœ… 100% | æ‰€æœ‰åŠŸèƒ½å¯ç”¨ |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### è·å–é…ç½®ç®¡ç†å™¨å®ä¾‹
```python
from production.core_modules.config_manager import get_config_manager

# è·å–å•ä¾‹å®ä¾‹
config_manager = get_config_manager()

# åŠ è½½é…ç½®
documents_config = config_manager.get_config('documents')
```

### è·å–URLåŒæ­¥æœåŠ¡
```python
from production.core_modules.url_sync_service import get_sync_service

# è·å–å•ä¾‹å®ä¾‹
sync_service = get_sync_service()

# æ‰§è¡ŒåŒæ­¥
report = sync_service.sync_all_configs()

# æ£€æŸ¥ä¸€è‡´æ€§
inconsistencies = sync_service.check_url_consistency()
```

### æ›´æ–°é…ç½®
```python
# æ›´æ–°ä¸‹è½½é…ç½®
config_manager.update_config('download', {
    'document_links': new_links,
    'auto_download': True
})

# æ·»åŠ æ–°æ–‡æ¡£URL
sync_service.add_url_mapping(
    doc_name="æ–°æ–‡æ¡£åç§°",
    url="https://docs.qq.com/sheet/xxx",
    doc_id="xxx"
)
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **é…ç½®æ–‡ä»¶ç¼ºå¤±**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„é…ç½®æ–‡ä»¶
   - æ£€æŸ¥`/config`ç›®å½•æƒé™

2. **URLä¸ä¸€è‡´**
   - è¿è¡Œ`sync_service.check_url_consistency()`æ£€æŸ¥
   - æ‰§è¡Œ`sync_service.sync_all_configs()`åŒæ­¥

3. **Cookieè¿‡æœŸ**
   - æ£€æŸ¥`config_manager.check_cookie_validity()`
   - é€šè¿‡8089 UIæ›´æ–°Cookie

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **é…ç½®åŠ è½½æ—¶é—´**: < 100ms
- **URLåŒæ­¥æ—¶é—´**: < 500msï¼ˆ100ä¸ªæ–‡æ¡£ï¼‰
- **å†…å­˜å ç”¨**: < 10MB
- **å¹¶å‘æ”¯æŒ**: çº¿ç¨‹å®‰å…¨è®¾è®¡

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **CookieåŠ å¯†**: æ”¯æŒCookieåŠ å¯†å­˜å‚¨
2. **é…ç½®å¤‡ä»½**: è‡ªåŠ¨å¤‡ä»½é‡è¦é…ç½®
3. **æƒé™æ§åˆ¶**: é…ç½®æ–‡ä»¶æƒé™ç®¡ç†
4. **å®¡è®¡æ—¥å¿—**: é…ç½®å˜æ›´è®°å½•

## ğŸ¯ æœªæ¥ä¼˜åŒ–

1. **é…ç½®ç‰ˆæœ¬æ§åˆ¶**: å®ç°é…ç½®å˜æ›´å†å²
2. **åˆ†å¸ƒå¼é…ç½®**: æ”¯æŒé…ç½®ä¸­å¿ƒé›†æˆ
3. **å®æ—¶åŒæ­¥**: WebSocketé…ç½®æ¨é€
4. **æ™ºèƒ½éªŒè¯**: AIé©±åŠ¨çš„é…ç½®éªŒè¯

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿé›†æˆæµ‹è¯•æŠ¥å‘Š](../system_integration_report.md)
- [01-ç³»ç»Ÿæ€»ä½“æ¶æ„è§„æ ¼](01-ç³»ç»Ÿæ€»ä½“æ¶æ„è§„æ ¼.md)
- [0000-å®Œæ•´å­˜å‚¨è·¯å¾„ç´¢å¼•](0000-å®Œæ•´å­˜å‚¨è·¯å¾„ç´¢å¼•.md)

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0*  
*æœ€åæ›´æ–°: 2025-09-10*  
*ä½œè€…: System Architecture Team*