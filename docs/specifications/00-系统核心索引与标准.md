# 0000 - 系统核心索引与标准
## System Core Index and Standards

> 统一整合版本 - 合并自原0000系列三个文档
> 更新时间: 2025-09-17
> 版本: 2.0.0

---

## 第一部分：系统统一颜色和级别打分标准

### 1.1 打分颜色映射表

| 打分范围 | 颜色 | 颜色代码 | 风险等级 | 描述 |
|---------|------|---------|---------|------|
| score ≥ 0.8 | 红色 | #FF0000 | 极高风险 | 关键修改，需要立即关注 |
| 0.6 ≤ score < 0.8 | 橙色 | #FFA500 | 高风险 | 重要修改，需要重点审查 |
| 0.4 ≤ score < 0.6 | 黄色 | #FFFF00 | 中风险 | 一般修改，需要常规审查 |
| 0.1 ≤ score < 0.4 | 绿色 | #00FF00 | 低风险 | 轻微修改，可以快速审查 |
| score < 0.1 | 蓝色 | #0000FF | 极低风险 | 微小修改，基本可以忽略 |

### 1.2 三级列表基础得分标准

| 列级别 | 最低基础得分 | 权重系数 | 说明 |
|--------|------------|---------|------|
| L1 | 0.8 | 1.0 | 核心关键列，任何修改都是高风险 |
| L2 | 0.4 | 0.5 | 重要业务列，修改需要AI评估 |
| L3 | 0.1 | 0.2 | 一般信息列，修改风险较低 |

### 1.3 得分计算公式

```
最终得分 = max(基础得分, 实际计算得分 × 权重系数)
```

---

## 第二部分：完整存储路径索引

### ⚠️ 重要提示：路径一致性问题

**已知路径问题**（2025-09-10验证）:
- 🔴 **scoring_results路径错误**: 实际存储在`/root/projects/`而非文档记载的`/root/projects/tencent-doc-manager/`
- 🟡 **不存在的路径**: `comparison_cache`、`standard_outputs`、`comparison`目录不存在
- 🟢 **downloads目录特殊性**: 包含350+个UUID命名的临时文件

### 2.1 数据流完整路径图谱

```
Cookie/URL → 自动下载配置 → CSV下载 → CSV对比 → 简化 → 标准化 → L2语义分析 → 详细打分 → 综合汇总
```

### 2.2 核心存储路径（验证准确）

#### Cookie与URL存储
| 描述 | 存储路径 | 状态 |
|------|----------|------|
| Cookie主存储 | `/root/projects/tencent-doc-manager/config/cookies.json` | ✅ |
| Cookie备份 | `/root/projects/tencent-doc-manager/config/cookies_backup.json` | ✅ |
| URL配置 | `/root/projects/tencent-doc-manager/config/ui_config.json` | ✅ |
| 真实文档配置 | `/root/projects/tencent-doc-manager/config/real_documents.json` | ✅ |
| 监控配置 | `/root/projects/tencent-doc-manager/config/monitor_config.json` | ✅ |
| 下载链接配置（含软删除） | `/root/projects/tencent-doc-manager/config/download_config.json` | ✅ |

#### CSV下载与版本管理
| 描述 | 存储路径 | 状态 |
|------|----------|------|
| 主下载目录（UUID文件） | `/root/projects/tencent-doc-manager/downloads/` | ✅ 350+文件 |
| 版本根目录 | `/root/projects/tencent-doc-manager/csv_versions/` | ✅ |
| 周版本存储 | `/root/projects/tencent-doc-manager/csv_versions/2025_W{周数}/` | ✅ |
| - 基准版 | `.../baseline/` | ✅ |
| - 周中版 | `.../midweek/` | ✅ |
| - 周末版 | `.../weekend/` | ✅ |
| - 软删除文件夹 | `.../baseline/.deleted/` | ✅ |

#### 对比与打分存储
| 描述 | 存储路径 | 状态 |
|------|----------|------|
| 对比结果 | `/root/projects/tencent-doc-manager/comparison_results/` | ✅ |
| 简化结果 | `/root/projects/tencent-doc-manager/comparison_results/simplified_*.json` | ✅ |
| **详细打分（实际位置）** | `/root/projects/scoring_results/detailed/` | ⚠️ 路径偏差 |
| 综合打分 | `/root/projects/tencent-doc-manager/scoring_results/comprehensive/` | ✅ |
| UI数据 | `/root/projects/tencent-doc-manager/ui_data/` | ✅ |

#### 其他重要目录
| 描述 | 存储路径 | 状态 |
|------|----------|------|
| Excel上传 | `/root/projects/tencent-doc-manager/excel_uploads/` | ✅ |
| 语义分析结果 | `/root/projects/tencent-doc-manager/semantic_results/` | ✅ |
| 日志目录 | `/root/projects/tencent-doc-manager/logs/` | ✅ |

### 2.3 文件命名规范

#### CSV文件命名
```
tencent_{文档名}_{时间戳}_{版本类型}_W{周数}.{扩展名}
```
- 扩展名根据实际格式动态决定（csv/xlsx）
- 示例: `tencent_副本-测试版本-出国销售计划表_20250909_2250_midweek_W37.csv`

#### 对比结果命名
```
{baseline_name}_vs_{target_name}_{timestamp}.json
simplified_{source_name}_vs_{target_name}_{timestamp}.json
```

#### 综合打分命名
```
comprehensive_score_W{周数}_{timestamp}.json
```

---

## 第三部分：综合打分数据结构标准

### 3.1 综合打分JSON结构（UI唯一数据源）

```json
{
  "generation_time": "2025-09-13T10:00:00",
  "scoring_version": "2.0",
  "table_scores": [
    {
      "table_id": 0,
      "table_name": "表格名称",
      "table_url": "https://docs.qq.com/sheet/xxx",
      "total_modifications": 15,
      "overall_risk_score": 0.65,
      "column_scores": {
        "列名": {
          "avg_score": 0.75,
          "modified_rows": [1, 5, 10, 15],
          "row_scores": [0.8, 0.7, 0.75, 0.8],
          "column_level": "L1"
        }
      }
    }
  ],
  "column_avg_scores": {
    "列名1": 0.65,
    "列名2": 0.45
  },
  "total_modifications": 150,
  "risk_summary": {
    "high_risk_count": 30,
    "medium_risk_count": 50,
    "low_risk_count": 70
  }
}
```

### 3.2 UI热力图参数映射

| UI元素 | 数据来源 | 字段路径 |
|--------|---------|---------|
| 热力图矩阵 | 综合打分 | `table_scores[].column_scores[].avg_score` |
| 表格名称 | 综合打分 | `table_scores[].table_name` |
| 右侧总修改数 | 综合打分 | `table_scores[].total_modifications` |
| 列修改分布 | 综合打分 | `table_scores[].column_scores[].modified_rows` |
| 颜色渲染 | 打分标准 | 根据score值映射颜色代码 |

### 3.3 强制要求

- **唯一数据源**：UI热力图只能从综合打分JSON文件获取数据
- **禁止直接访问**：不允许直接访问CSV文件、详细打分文件或其他中间文件
- **数据完整性**：综合打分文件必须包含以下五个关键内容：
  1. 所有表名列表 (`table_names`)
  2. 每标准列平均加权修改打分 (`column_avg_scores`)
  3. 每列具体修改行数和打分 (`column_modifications`)
  4. 表格URL列表 (`table_urls`)
  5. 全部修改数 (`total_modifications`)

---

## 第四部分：验证规则与代码示例

### 4.1 打分验证

```python
def validate_score(score, column_level):
    """验证打分是否符合标准"""
    if column_level == 'L1' and score < 0.8:
        return False, "L1列打分不能低于0.8"
    if column_level == 'L2' and score < 0.4:
        return False, "L2列打分不能低于0.4"
    if column_level == 'L3' and score <= 0.1:
        return False, "L3列打分必须大于0.1"
    return True, "打分有效"
```

### 4.2 颜色映射

```python
def get_color(score):
    """根据打分获取颜色"""
    if score >= 0.8:
        return "#FF0000"  # 红色
    elif score >= 0.6:
        return "#FFA500"  # 橙色
    elif score >= 0.4:
        return "#FFFF00"  # 黄色
    elif score >= 0.1:
        return "#00FF00"  # 绿色
    else:
        return "#0000FF"  # 蓝色
```

---

## 第五部分：系统配置架构

### 5.1 配置文件清单（8个核心配置）

```
/root/projects/tencent-doc-manager/config/
├── cookies.json            # Cookie存储
├── cookies_backup.json      # Cookie备份
├── ui_config.json          # UI配置
├── real_documents.json     # 真实文档配置
├── monitor_config.json     # 监控配置
├── download_config.json    # 下载配置
├── schedule_tasks.json     # 定时任务
└── column_mapping.json     # 列名映射（计划中）
```

### 5.2 核心服务端口

| 服务 | 端口 | 文件 | 功能 |
|------|------|------|------|
| Claude封装 | 8081 | claude_wrapper_integration.py | AI分析接口 |
| 热力图UI | 8089 | final_heatmap_server.py | 生产UI服务 |
| 下载服务 | 8093 | download_and_upload_server.py | 文档下载上传 |

---

## 强制执行说明

本标准文档自发布之日起立即生效，所有相关模块必须：

1. **立即更新**：更新代码以符合本标准
2. **严格遵守**：不得擅自修改阈值、颜色映射或路径定义
3. **统一引用**：所有文档必须引用本标准，不得重复定义
4. **版本控制**：任何修改必须更新版本号和更新历史

---

**版本历史**:
- v2.0.0 (2025-09-17): 合并原0000系列三个文档，统一索引和标准
- v1.2.0 (2025-09-12): 更新路径索引，添加软删除机制
- v1.0.0 (2025-09-08): 初始版本