# 00 - 系统实际架构说明

> 📌 **重要**: 本文档描述系统的**实际实现**，而非设计愿景
> - 创建日期：2025-09-10
> - 目的：提供准确的系统架构参考
> - 状态：反映当前生产环境

## 🎯 系统概述

腾讯文档智能监控系统是一个基于Python的**单体应用**，用于监控腾讯文档的变更并生成可视化报告。

### 实际技术栈
- **后端**: Python 3.8+ / Flask 2.x
- **自动化**: Playwright（浏览器自动化）
- **数据处理**: pandas、openpyxl
- **AI集成**: Claude API（内置集成）
- **前端**: Flask模板 + 内嵌JavaScript/HTML
- **数据存储**: JSON配置文件

### 不存在的组件 ❌
- ❌ React前端（0个JSX文件）
- ❌ SQLite数据库（0个.db文件）
- ❌ Docker部署（Dockerfile存在但未使用）
- ❌ Nginx反向代理
- ❌ 分布式微服务架构

## 🏗️ 实际系统架构

```
┌──────────────────────────────────────────────────────┐
│              腾讯文档智能监控系统（实际）                │
├──────────────────────────────────────────────────────┤
│                                                      │
│  用户浏览器                                           │
│      ↓                                               │
│  ┌──────────────────────────────────────────────┐   │
│  │         Flask Web服务器 (8089端口)              │   │
│  │  final_heatmap_server.py (289KB)              │   │
│  │  - HTML模板渲染                                │   │
│  │  - API端点                                    │   │
│  │  - 静态文件服务                                │   │
│  └──────────────────────────────────────────────┘   │
│                     ↓                                │
│  ┌──────────────────────────────────────────────┐   │
│  │           核心处理模块                          │   │
│  │  production/core_modules/                     │   │
│  │  - config_manager.py（配置管理）               │   │
│  │  - url_sync_service.py（URL同步）             │   │
│  │  - real_doc_loader.py（文档加载）             │   │
│  │  - tencent_doc_upload_production_v3.py       │   │
│  └──────────────────────────────────────────────┘   │
│                     ↓                                │
│  ┌──────────────────────────────────────────────┐   │
│  │           数据存储（JSON文件）                  │   │
│  │  config/                                      │   │
│  │  - real_documents.json（文档配置）             │   │
│  │  - download_config.json（下载配置）            │   │
│  │  - monitor_config.json（监控设置）             │   │
│  │  - cookies.json（认证信息）                    │   │
│  └──────────────────────────────────────────────┘   │
│                                                      │
└──────────────────────────────────────────────────────┘
```

## 📁 实际目录结构

```
/root/projects/tencent-doc-manager/
├── production/
│   ├── servers/
│   │   └── final_heatmap_server.py    # 主服务器（8089端口）
│   └── core_modules/                  # 核心业务逻辑
│       ├── config_manager.py          # 配置管理器
│       ├── url_sync_service.py        # URL同步服务
│       └── real_doc_loader.py         # 文档加载器
├── config/                            # 配置文件目录
│   ├── real_documents.json           # 真实文档列表
│   ├── download_config.json          # 下载配置
│   └── monitor_config.json           # 监控配置
├── csv_versions/                      # CSV版本管理
│   └── 2025_W{周数}/                 # 按周组织
├── scoring_results/                   # 评分结果
│   ├── detailed/                     # 详细评分
│   └── comprehensive/                # 综合评分
└── uploads/                          # 上传文件存储

```

## 🚀 实际运行的服务

### 1. 主服务：8089端口
- **文件**: `production/servers/final_heatmap_server.py`
- **功能**: 
  - 热力图可视化UI
  - 监控设置界面
  - API端点服务
  - Cookie管理
  - **URL软删除管理**（⚡新增）
  - **基线文件CRUD操作**（⚡新增）
  - **增强日志显示**（⚡新增）
- **启动命令**: `python3 production/servers/final_heatmap_server.py`
- **最新更新**: 2025-09-12 - 添加软删除和基线文件管理功能

### 2. 集成测试系统：8093端口
- **文件**: `production_integrated_test_system_8093.py`
- **功能**: 文档上传和集成测试
- **状态**: 按需运行

### 3. 计划但未运行的服务 ⚠️
- **8081端口**: Claude封装服务（代码存在但未部署）
- **8098端口**: DeepSeek服务（已停用）
- **8090端口**: 从未实现

## 📊 数据流（实际）

```
1. 用户通过8089 UI输入Cookie和文档URL
    ↓
2. 配置保存到JSON文件
    ↓
3. Playwright自动下载CSV/Excel
    ↓
4. pandas处理和对比分析
    ↓
5. 生成评分JSON文件
    ↓
6. 8089 UI读取JSON展示热力图
    ↓
7. Excel MCP生成标记文件
    ↓
8. 上传到腾讯文档（v3模块）
```

## 🔧 配置驱动架构

系统采用**配置驱动**设计，支持动态文档数量：

### 核心配置文件
1. **real_documents.json**
   - 主数据源，定义所有监控的文档
   - 支持动态添加/删除文档

2. **ConfigManager**（统一管理器）
   - 自动初始化缺失配置
   - 配置文件同步
   - Cookie有效期检测

3. **URLSyncService**（URL同步）
   - 确保URL一致性
   - 智能表名匹配

## ⚠️ 与文档描述的差异

| 功能 | 文档描述 | 实际情况 |
|------|---------|---------|
| 前端框架 | React 18.x + 1381行组件 | Flask模板 + 内嵌JS |
| 数据库 | SQLite + Redis | JSON文件 |
| 部署 | Docker + Nginx | 直接运行Python |
| 架构 | 分布式微服务 | 单体应用 |
| 矩阵大小 | 固定30×19 | 动态N×19 |

## 🎯 系统特点

### 优点
- ✅ 简单可维护
- ✅ 配置灵活
- ✅ 功能完整
- ✅ 易于部署

### 限制
- ⚠️ 单点故障风险
- ⚠️ 无横向扩展能力
- ⚠️ 缺少持久化数据库
- ⚠️ 无用户认证系统

## 📝 相关准确文档

以下文档反映实际实现：
- [11-配置管理系统规范.md](11-配置管理系统规范.md)
- [07-腾讯文档上传技术规格.md](07-腾讯文档上传技术规格.md)
- [system_integration_report.md](../system_integration_report.md)

## ⚠️ 注意事项

许多规格文档描述的是"设计愿景"而非实际实现。使用文档时请注意：
- 查看文档创建日期
- 验证代码是否存在
- 检查服务是否运行

---

*本文档基于系统实际代码分析生成*
*最后更新：2025-09-10*
*准确度：基于代码验证*