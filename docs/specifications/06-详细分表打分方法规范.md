# ğŸ“Š è¯¦ç»†åˆ†è¡¨æ‰“åˆ†æ–¹æ³•è§„èŒƒ v3.0

**ç‰ˆæœ¬**: v3.0  
**æ›´æ–°æ—¥æœŸ**: 2025-09-11  
**çŠ¶æ€**: ç”Ÿäº§å¼ºåˆ¶æ‰§è¡Œç‰ˆ  
**æ ¸å¿ƒåŸåˆ™**: **ç»Ÿä¸€æ ‡å‡†ã€å¼ºåˆ¶é˜ˆå€¼ã€ç¦æ­¢é™çº§**

---

## âš ï¸ å…³é”®è¦æ±‚

**æœ¬è§„èŒƒä¸¥æ ¼ç¦æ­¢ä»¥ä¸‹è¡Œä¸º**ï¼š
1. âŒ ä»»ä½•å½¢å¼çš„é™çº§æ–¹æ³•ï¼ˆfallbackï¼‰
2. âŒ ä½¿ç”¨DetailedScoreGeneratoræˆ–å…¶ä»–è¯„åˆ†å™¨
3. âŒ L1åˆ—å˜æ›´åˆ†æ•°ä½äº0.8ï¼ˆçº¢è‰²é˜ˆå€¼ï¼‰
4. âŒ L2åˆ—å˜æ›´åˆ†æ•°ä½äº0.6ï¼ˆæ©™è‰²é˜ˆå€¼ï¼‰

**å¿…é¡»ç¡®ä¿**ï¼š
- âœ… ç»Ÿä¸€ä½¿ç”¨IntegratedScorerä½œä¸ºå”¯ä¸€è¯„åˆ†å™¨
- âœ… L1åˆ—ä»»ä½•å˜æ›´è§¦å‘çº¢è‰²è­¦å‘Šï¼ˆ>=0.8åˆ†ï¼‰
- âœ… L2åˆ—ä»»ä½•å˜æ›´è§¦å‘æ©™è‰²è­¦å‘Šï¼ˆ>=0.6åˆ†ï¼‰
- âœ… ä¸¥æ ¼æ‰§è¡Œé£é™©æ§åˆ¶åŸåˆ™

---

## 1. ç³»ç»Ÿæ¶æ„æ€»è§ˆ

### 1.1 ä¸‰å±‚å·®å¼‚åŒ–æ‰“åˆ†ç­–ç•¥

| åˆ—çº§åˆ« | é£é™©ç­‰çº§ | åŸºç¡€åˆ† | æœ€ä½åˆ†æ•° | è­¦å‘Šé¢œè‰² | å¤„ç†æ–¹å¼ | åˆ—æ•°é‡ |
|--------|---------|--------|---------|---------|---------|--------|
| **L1** | æé«˜é£é™© | 0.8 | 0.8 | ğŸ”´çº¢è‰² | çº¯è§„åˆ™+å¼ºåˆ¶é˜ˆå€¼ | 7åˆ— |
| **L2** | é«˜é£é™© | 0.5 | 0.6 | ğŸŸ æ©™è‰² | è§„åˆ™+å¼ºåˆ¶é˜ˆå€¼ | 7åˆ— |
| **L3** | ä¸€èˆ¬é£é™© | 0.2 | æ—  | åŠ¨æ€ | æ ‡å‡†è®¡ç®— | 5åˆ— |

### 1.2 æ ¸å¿ƒæ‰“åˆ†å…¬å¼

```
æœ€ç»ˆå¾—åˆ† = åŸºç¡€åˆ† Ã— å˜æ›´ç³»æ•° Ã— åˆ—æƒé‡ Ã— AIè°ƒæ•´ç³»æ•° Ã— ç½®ä¿¡åº¦æƒé‡
```

å…¶ä¸­ï¼š
- **åŸºç¡€åˆ†**ï¼šL1=0.8, L2=0.5, L3=0.2
- **å˜æ›´ç³»æ•°**ï¼šæ ¹æ®ä¿®æ”¹ç±»å‹è®¡ç®—ï¼ˆ0.0-1.3ï¼‰
- **åˆ—æƒé‡**ï¼šç‰¹å®šåˆ—çš„ä¸šåŠ¡é‡è¦æ€§ï¼ˆ1.0-1.4ï¼‰
- **AIè°ƒæ•´ç³»æ•°**ï¼šä»…L2åˆ—ï¼ŒåŸºäºAIå†³ç­–ï¼ˆ0.6-1.5ï¼‰
- **ç½®ä¿¡åº¦æƒé‡**ï¼šä»…L2åˆ—ï¼ŒåŸºäºAIç½®ä¿¡åº¦ï¼ˆ0.7-1.0ï¼‰

---

## 2. L1åˆ—è§„åˆ™æ‰“åˆ†ï¼ˆé«˜é£é™©ï¼‰

### 2.1 L1åˆ—å®šä¹‰ä¸ä¸šåŠ¡å«ä¹‰

```python
L1_COLUMNS = [
    "æ¥æº",           # æ•°æ®æ¥æºæ ‡è¯†ï¼Œä¸å¯éšæ„ä¿®æ”¹
    "ä»»åŠ¡å‘èµ·æ—¶é—´",    # å…³é”®æ—¶é—´èŠ‚ç‚¹ï¼Œå½±å“æ•´ä½“è¿›åº¦
    "ç›®æ ‡å¯¹é½",       # æˆ˜ç•¥ç›®æ ‡å…³è”ï¼Œä¸å¯åç¦»ä¸»çº¿
    "å…³é”®KRå¯¹é½",     # æ ¸å¿ƒKPIå…³è”ï¼Œä¸å¯éšæ„è°ƒæ•´
    "é‡è¦ç¨‹åº¦",       # ä¼˜å…ˆçº§æ ‡è¯†ï¼Œä¸å¯éšæ„é™çº§
    "é¢„è®¡å®Œæˆæ—¶é—´",    # äº¤ä»˜æ‰¿è¯ºï¼Œä¸å¯æ— æ•…å»¶æœŸ
    "å®Œæˆè¿›åº¦"        # æ‰§è¡ŒçŠ¶æ€ï¼Œä¸å¯è™šå‡å¡«æŠ¥
]
```

### 2.2 L1æ‰“åˆ†ç®—æ³•

```python
def process_l1_modification(mod: Dict) -> Dict:
    """L1åˆ—æ‰“åˆ†ï¼ˆçº¯è§„åˆ™ï¼Œæ— AIï¼‰"""
    
    # Step 1: åŸºç¡€åˆ†
    base_score = 0.8  # L1å›ºå®šåŸºç¡€åˆ†
    
    # Step 2: å˜æ›´ç³»æ•°è®¡ç®—
    old_value = str(mod.get('old_value', '')).strip()
    new_value = str(mod.get('new_value', '')).strip()
    
    if old_value == new_value:
        change_factor = 0.0  # æ— å˜åŒ–
    elif not old_value and new_value:
        change_factor = 1.0  # è¡¥å……ä¿¡æ¯
    elif old_value and not new_value:
        change_factor = 1.3  # åˆ é™¤å†…å®¹ï¼ˆæœ€å±é™©ï¼‰
    elif 'å»¶æœŸ' in new_value or 'æ¨è¿Ÿ' in new_value:
        change_factor = 1.2  # åŒ…å«é£é™©å…³é”®è¯
    else:
        change_factor = 1.1  # ä¸€èˆ¬ä¿®æ”¹
    
    # Step 3: åˆ—æƒé‡
    column_weights = {
        "é‡è¦ç¨‹åº¦": 1.4,
        "ä»»åŠ¡å‘èµ·æ—¶é—´": 1.3,
        "é¢„è®¡å®Œæˆæ—¶é—´": 1.3,
        "å®Œæˆè¿›åº¦": 1.1,
        "é‚“æ€»æŒ‡å¯¼ç™»è®°": 1.15
    }
    importance_weight = column_weights.get(mod['column_name'], 1.0)
    
    # Step 4: è®¡ç®—æœ€ç»ˆåˆ†æ•°
    final_score = min(base_score * change_factor * importance_weight, 1.0)
    
    return {
        'base_score': base_score,
        'change_factor': change_factor,
        'importance_weight': importance_weight,
        'ai_adjustment': 1.0,  # L1ä¸ä½¿ç”¨AI
        'confidence_weight': 1.0,  # L1ä¸ä½¿ç”¨AI
        'final_score': final_score,
        'ai_used': False,
        'ai_reason': 'L1_column_rule_based'
    }
```

### 2.3 L1é¢„æœŸæ•ˆæœæ¡ˆä¾‹

| æ¡ˆä¾‹ | ä¿®æ”¹å†…å®¹ | è®¡ç®—è¿‡ç¨‹ | æœ€ç»ˆå¾—åˆ† | é£é™©ç­‰çº§ |
|------|---------|----------|---------|---------|
| é‡è¦ç¨‹åº¦é™çº§ | é«˜â†’ä¸­ | 0.8Ã—1.1Ã—1.4 | 1.0 | æé«˜é£é™©ğŸ”´ |
| å»¶æœŸäº¤ä»˜ | 3æœˆâ†’4æœˆ | 0.8Ã—1.2Ã—1.3 | 1.0 | æé«˜é£é™©ğŸ”´ |
| åˆ é™¤è¿›åº¦ | 80%â†’ç©º | 0.8Ã—1.3Ã—1.1 | 1.0 | æé«˜é£é™©ğŸ”´ |
| è¡¥å……æ¥æº | ç©ºâ†’å†…éƒ¨ | 0.8Ã—1.0Ã—1.0 | 0.8 | é«˜é£é™©ğŸŸ  |

---

## 3. L3åˆ—è§„åˆ™æ‰“åˆ†ï¼ˆä½é£é™©ï¼‰

### 3.1 L3åˆ—å®šä¹‰ä¸ä¸šåŠ¡å«ä¹‰

```python
L3_COLUMNS = [
    "åºå·",          # é¡ºåºæ ‡è¯†ï¼Œä»…æ ¼å¼ä½œç”¨
    "å¤ç›˜æ—¶é—´",      # å›é¡¾æ—¶é—´ï¼Œè®°å½•æ€§è´¨
    "å¯¹ä¸Šæ±‡æŠ¥",      # æ±‡æŠ¥è®°å½•ï¼Œéå…³é”®ä¿¡æ¯
    "åº”ç”¨æƒ…å†µ",      # ä½¿ç”¨æƒ…å†µï¼Œå‚è€ƒä¿¡æ¯
    "è¿›åº¦åˆ†ææ€»ç»“"    # æ€»ç»“æ–‡æœ¬ï¼Œè¾…åŠ©ä¿¡æ¯
]
```

### 3.2 L3æ‰“åˆ†ç®—æ³•

```python
def process_l3_modification(mod: Dict) -> Dict:
    """L3åˆ—æ‰“åˆ†ï¼ˆçº¯è§„åˆ™ï¼Œæ— AIï¼‰"""
    
    # Step 1: åŸºç¡€åˆ†
    base_score = 0.2  # L3å›ºå®šåŸºç¡€åˆ†
    
    # Step 2: å˜æ›´ç³»æ•°è®¡ç®—ï¼ˆè¾ƒå®½æ¾ï¼‰
    old_value = str(mod.get('old_value', '')).strip()
    new_value = str(mod.get('new_value', '')).strip()
    
    if old_value == new_value:
        change_factor = 0.0  # æ— å˜åŒ–
    elif not old_value and new_value:
        change_factor = 0.8  # è¡¥å……æ€»ç»“ï¼ˆå¥½äº‹ï¼‰
    elif old_value and not new_value:
        change_factor = 1.0  # æ¸…ç©ºå†…å®¹
    elif abs(len(new_value) - len(old_value)) < 10:
        change_factor = 0.3  # å¾®å°è°ƒæ•´
    else:
        change_factor = 0.5  # ä¸€èˆ¬ä¿®æ”¹
    
    # Step 3: L3åˆ—æ— ç‰¹æ®Šæƒé‡
    importance_weight = 1.0
    
    # Step 4: è®¡ç®—æœ€ç»ˆåˆ†æ•°
    final_score = base_score * change_factor * importance_weight
    
    return {
        'base_score': base_score,
        'change_factor': change_factor,
        'importance_weight': importance_weight,
        'ai_adjustment': 1.0,  # L3ä¸ä½¿ç”¨AI
        'confidence_weight': 1.0,  # L3ä¸ä½¿ç”¨AI
        'final_score': final_score,
        'ai_used': False,
        'ai_reason': 'L3_column_rule_based'
    }
```

### 3.3 L3é¢„æœŸæ•ˆæœæ¡ˆä¾‹

| æ¡ˆä¾‹ | ä¿®æ”¹å†…å®¹ | è®¡ç®—è¿‡ç¨‹ | æœ€ç»ˆå¾—åˆ† | é£é™©ç­‰çº§ |
|------|---------|----------|---------|---------|
| åºå·è°ƒæ•´ | 1â†’01 | 0.2Ã—0.3Ã—1.0 | 0.06 | æä½é£é™©ğŸ”µ |
| è¡¥å……æ€»ç»“ | ç©ºâ†’å·²å®Œæˆ | 0.2Ã—0.8Ã—1.0 | 0.16 | æä½é£é™©ğŸ”µ |
| æ¸…ç©ºå¤ç›˜æ—¶é—´ | 9æœˆâ†’ç©º | 0.2Ã—1.0Ã—1.0 | 0.20 | ä½é£é™©ğŸŸ¢ |
| æ›´æ–°æ±‡æŠ¥ | ç®€è¦â†’è¯¦ç»† | 0.2Ã—0.5Ã—1.0 | 0.10 | æä½é£é™©ğŸ”µ |

---

## 4. L2åˆ—AIè¯­ä¹‰åˆ†æé›†æˆï¼ˆä¸­é£é™©ï¼‰ã€æ ¸å¿ƒã€‘

### 4.1 L2åˆ—å®šä¹‰ä¸ä¸šåŠ¡å«ä¹‰

```python
L2_COLUMNS = [
    "é¡¹ç›®ç±»å‹",          # é¡¹ç›®æ€§è´¨ï¼Œéœ€è¦åˆ¤æ–­å˜æ›´åˆç†æ€§
    "å…·ä½“è®¡åˆ’å†…å®¹",      # è¯¦ç»†æè¿°ï¼Œéœ€è¦åˆ†æå®è´¨å˜åŒ–
    "é‚“æ€»æŒ‡å¯¼ç™»è®°",      # é¢†å¯¼æ‰¹ç¤ºï¼Œéœ€è¦è°¨æ…å¤„ç†
    "è´Ÿè´£äºº",           # è´£ä»»äººï¼Œäººå‘˜å˜æ›´éœ€è¦è¯„ä¼°
    "ååŠ©äºº",           # åä½œè€…ï¼Œå›¢é˜Ÿè°ƒæ•´å½±å“åˆ†æ
    "ç›‘ç£äºº",           # ç›‘ç£è€…ï¼Œç›‘ç£é“¾å®Œæ•´æ€§æ£€æŸ¥
    "å½¢æˆè®¡åˆ’æ¸…å•"       # è®¡åˆ’åˆ—è¡¨ï¼Œå¯è¡Œæ€§åˆ†æ
]
```

### 4.2 L2 AIè¯­ä¹‰åˆ†æè°ƒç”¨é“¾ã€å…³é”®ã€‘

#### 4.2.1 æ•°æ®å‡†å¤‡

```python
def prepare_l2_data_for_ai(mod: Dict) -> Dict:
    """å‡†å¤‡L2ä¿®æ”¹æ•°æ®ç”¨äºAIåˆ†æ"""
    return {
        'modification_id': f"M{mod.get('index', 1):03d}",
        'cell': mod.get('cell', ''),
        'column_name': mod['column_name'],
        'old_value': mod.get('old_value', ''),
        'new_value': mod.get('new_value', ''),
        'table_name': mod.get('table_name', ''),
        'row_number': mod.get('row_number', 0),
        'context': {
            'same_row': mod.get('row_context', {}),  # åŒè¡Œå…¶ä»–åˆ—
            'history': mod.get('change_history', [])  # å†å²ä¿®æ”¹
        }
    }
```

#### 4.2.2 è°ƒç”¨AIæœåŠ¡ï¼ˆå¿…é¡»æˆåŠŸï¼‰

```python
def call_l2_semantic_service(mod: Dict) -> Dict:
    """
    è°ƒç”¨L2è¯­ä¹‰åˆ†ææœåŠ¡
    
    é‡è¦ï¼šä¸å…è®¸ä»»ä½•é™çº§ï¼å¦‚æœAIæœåŠ¡ä¸å¯ç”¨ï¼Œå¿…é¡»æŠ¥é”™
    """
    
    # æ–¹æ¡ˆAï¼šè°ƒç”¨8098ç«¯å£æœåŠ¡
    try:
        response = requests.post(
            'http://localhost:8098/api/semantic_analysis',
            json={'modifications': [prepare_l2_data_for_ai(mod)]},
            timeout=5
        )
        
        if response.status_code != 200:
            raise Exception(f"AIæœåŠ¡è¿”å›é”™è¯¯: {response.status_code}")
        
        result = response.json()
        return result['results'][0] if result.get('results') else None
        
    except Exception as e:
        # ä¸å…è®¸é™çº§ï¼å¿…é¡»æŠ¥é”™
        raise Exception(f"L2 AIè¯­ä¹‰åˆ†ææœåŠ¡è°ƒç”¨å¤±è´¥: {e}")
    
    # æ–¹æ¡ˆBï¼šç›´æ¥è°ƒç”¨L2SemanticAnalyzer
    from production.core_modules.l2_semantic_analysis_two_layer import L2SemanticAnalyzer
    
    analyzer = L2SemanticAnalyzer(api_client=deepseek_client)
    result = analyzer.analyze_single_modification(mod)  # éœ€è¦æ·»åŠ æ­¤æ–¹æ³•
    
    if not result:
        raise Exception("L2 AIåˆ†æè¿”å›ç©ºç»“æœ")
    
    return result
```

#### 4.2.3 è§£æAIç»“æœ

```python
def parse_l2_ai_result(ai_result: Dict) -> Tuple[float, float, Dict]:
    """
    è§£æAIåˆ†æç»“æœ
    
    Returns:
        (ai_adjustment_factor, confidence, full_analysis)
    """
    
    # æå–ä¸¤å±‚åˆ†æç»“æœ
    layer1_result = ai_result.get('layer1_result', {})
    layer2_result = ai_result.get('layer2_result', {})
    
    # è·å–æœ€ç»ˆå†³ç­–
    final_decision = ai_result.get('final_decision')
    if not final_decision and layer2_result:
        final_decision = layer2_result.get('decision', 'UNSURE')
    elif not final_decision and layer1_result:
        judgment = layer1_result.get('judgment', 'UNSURE')
        final_decision = 'APPROVE' if judgment == 'SAFE' else 'REVIEW'
    else:
        final_decision = 'UNSURE'
    
    # å†³ç­–æ˜ å°„åˆ°è°ƒæ•´ç³»æ•°
    AI_DECISION_FACTORS = {
        'APPROVE': 0.6,      # AIæ‰¹å‡†ï¼Œé™ä½40%é£é™©
        'CONDITIONAL': 0.8,  # æ¡ä»¶é€šè¿‡ï¼Œé™ä½20%é£é™©
        'REVIEW': 1.2,       # éœ€è¦å®¡æ ¸ï¼Œæé«˜20%é£é™©
        'REJECT': 1.5,       # AIæ‹’ç»ï¼Œæé«˜50%é£é™©
        'UNSURE': 1.0        # ä¸ç¡®å®šï¼Œä¸è°ƒæ•´
    }
    
    ai_factor = AI_DECISION_FACTORS.get(final_decision, 1.0)
    
    # è·å–ç½®ä¿¡åº¦
    if layer2_result:
        confidence = layer2_result.get('confidence', 70)
    elif layer1_result:
        confidence = layer1_result.get('confidence', 50)
    else:
        confidence = 50
    
    # æ„å»ºå®Œæ•´åˆ†æç»“æœ
    full_analysis = {
        'layer1_result': layer1_result,
        'layer2_result': layer2_result,
        'final_decision': final_decision,
        'confidence': confidence,
        'key_risks': layer2_result.get('key_risks', []) if layer2_result else [],
        'recommendation': layer2_result.get('recommendation', '') if layer2_result else ''
    }
    
    return ai_factor, confidence, full_analysis
```

#### 4.2.4 ç»¼åˆæ‰“åˆ†è®¡ç®—

```python
def process_l2_modification(mod: Dict) -> Dict:
    """
    L2åˆ—æ‰“åˆ†ï¼ˆAIè¯­ä¹‰åˆ†æ+è§„åˆ™ï¼‰
    
    æ ¸å¿ƒï¼šå¿…é¡»ä½¿ç”¨AIï¼Œä¸å…è®¸é™çº§
    """
    
    # Step 1: åŸºç¡€åˆ†
    base_score = 0.5  # L2å›ºå®šåŸºç¡€åˆ†
    
    # Step 2: è§„åˆ™éƒ¨åˆ†
    old_value = str(mod.get('old_value', '')).strip()
    new_value = str(mod.get('new_value', '')).strip()
    
    # å˜æ›´ç³»æ•°
    if old_value == new_value:
        change_factor = 0.0
    elif not old_value and new_value:
        change_factor = 0.9  # è¡¥å……ä¿¡æ¯
    elif old_value and not new_value:
        change_factor = 1.2  # åˆ é™¤å†…å®¹
    else:
        change_factor = 1.0  # ä¸€èˆ¬ä¿®æ”¹
    
    # åˆ—æƒé‡
    column_weights = {
        "è´Ÿè´£äºº": 1.2,
        "é‚“æ€»æŒ‡å¯¼ç™»è®°": 1.15,
        "é¡¹ç›®ç±»å‹": 1.1
    }
    importance_weight = column_weights.get(mod['column_name'], 1.0)
    
    # Step 3: AIåˆ†æï¼ˆå¿…é¡»æˆåŠŸï¼‰
    ai_result = call_l2_semantic_service(mod)
    ai_factor, confidence, full_analysis = parse_l2_ai_result(ai_result)
    
    # Step 4: ç½®ä¿¡åº¦åŠ æƒ
    if confidence >= 90:
        confidence_weight = 1.0
    elif confidence >= 70:
        confidence_weight = 0.9
    elif confidence >= 50:
        confidence_weight = 0.8
    else:
        confidence_weight = 0.7
    
    # Step 5: ç»¼åˆè®¡ç®—
    final_score = min(
        base_score * change_factor * importance_weight * ai_factor * confidence_weight,
        1.0
    )
    
    return {
        'base_score': base_score,
        'change_factor': change_factor,
        'importance_weight': importance_weight,
        'ai_adjustment': ai_factor,
        'confidence_weight': confidence_weight,
        'final_score': final_score,
        'ai_used': True,
        'ai_analysis': full_analysis
    }
```

### 4.3 L2é¢„æœŸæ•ˆæœæ¡ˆä¾‹

| æ¡ˆä¾‹ | ä¿®æ”¹å†…å®¹ | AIå†³ç­– | è®¡ç®—è¿‡ç¨‹ | æœ€ç»ˆå¾—åˆ† | é£é™©ç­‰çº§ |
|------|---------|--------|---------|---------|---------|
| é¡¹ç›®ç±»å‹å˜æ›´ | ç›®æ ‡ç®¡ç†â†’ä½“ç³»å»ºè®¾ | REVIEW(85%) | 0.5Ã—1.0Ã—1.1Ã—1.2Ã—0.9 | 0.594 | ä¸­é£é™©ğŸŸ¡ |
| å¢åŠ ååŠ©äºº | å¼ ä¸‰â†’å¼ ä¸‰,æå›› | APPROVE(90%) | 0.5Ã—0.9Ã—1.0Ã—0.6Ã—1.0 | 0.270 | ä½é£é™©ğŸŸ¢ |
| åˆ é™¤é¢†å¯¼æ‰¹ç¤º | é‡è¦â†’ç©º | REJECT(95%) | 0.5Ã—1.2Ã—1.15Ã—1.5Ã—1.0 | 1.0 | æé«˜é£é™©ğŸ”´ |
| è´Ÿè´£äººå˜æ›´ | ç‹äº”â†’èµµå…­ | CONDITIONAL(75%) | 0.5Ã—1.0Ã—1.2Ã—0.8Ã—0.9 | 0.432 | ä¸­é£é™©ğŸŸ¡ |

---

## 5. è¯¦ç»†æ‰“åˆ†æ–‡ä»¶è¾“å‡ºæ ¼å¼

### 5.1 æ–‡ä»¶è·¯å¾„è§„èŒƒ

```
/root/projects/tencent-doc-manager/
â””â”€â”€ scoring_results/
    â””â”€â”€ detailed/
        â”œâ”€â”€ detailed_score_å‰¯æœ¬-æµ‹è¯•ç‰ˆæœ¬-å‡ºå›½é”€å”®è®¡åˆ’è¡¨_20250908_153045.json
        â”œâ”€â”€ detailed_score_å‰¯æœ¬-æµ‹è¯•ç‰ˆæœ¬-å›å›½é”€å”®è®¡åˆ’è¡¨_20250908_153146.json
        â””â”€â”€ detailed_score_æµ‹è¯•ç‰ˆæœ¬-å°çº¢ä¹¦éƒ¨é—¨_20250908_153247.json
```

### 5.2 å®Œæ•´JSONè¾“å‡ºæ ¼å¼

```json
{
  "metadata": {
    "table_name": "å‰¯æœ¬-æµ‹è¯•ç‰ˆæœ¬-å‡ºå›½é”€å”®è®¡åˆ’è¡¨",
    "table_url": "https://docs.qq.com/sheet/DWEFNU25TemFnZXJN",
    "source_file": "/comparison_results/simplified_xxx_20250908.json",
    "scoring_time": "2025-09-08 15:30:45",
    "total_modifications": 25,
    "scoring_version": "v2.0",
    "ai_service": {
      "status": "active",
      "endpoint": "http://localhost:8098",
      "mode": "two_layer_analysis"
    }
  },
  
  "scores": [
    {
      "modification_id": "M001",
      "cell": "C4",
      "row_number": 4,
      "column_name": "é¡¹ç›®ç±»å‹",
      "column_level": "L2",
      "old_value": "ç›®æ ‡ç®¡ç†",
      "new_value": "ä½“ç³»å»ºè®¾",
      
      "scoring_components": {
        "base_score": 0.5,
        "change_factor": 1.0,
        "column_weight": 1.1,
        "ai_adjustment": 1.2,
        "confidence_weight": 0.9,
        "calculation": "0.5 Ã— 1.0 Ã— 1.1 Ã— 1.2 Ã— 0.9 = 0.594"
      },
      
      "ai_analysis": {
        "enabled": true,
        "service_used": "8098_semantic_api",
        "processing_time": "0.47s",
        
        "layer1_result": {
          "judgment": "UNSURE",
          "confidence": 60,
          "reason": "é¡¹ç›®æ€§è´¨å‘ç”Ÿå®è´¨æ”¹å˜"
        },
        
        "layer2_result": {
          "decision": "REVIEW",
          "risk_level": "MEDIUM",
          "confidence": 85,
          "key_risks": [
            "é¡¹ç›®ç±»å‹ä»ç®¡ç†è½¬å‘å»ºè®¾",
            "å¯èƒ½å½±å“èµ„æºåˆ†é…",
            "éœ€è¦ç¡®è®¤å˜æ›´åŸå› "
          ],
          "recommendation": "å»ºè®®é¡¹ç›®è´Ÿè´£äººè¯´æ˜å˜æ›´åŸå› å’Œé¢„æœŸå½±å“"
        },
        
        "final_decision": "REVIEW"
      },
      
      "final_score": 0.594,
      "risk_level": "MEDIUM",
      "risk_color": "yellow",
      "risk_icon": "ğŸŸ¡",
      "action_required": "manual_review",
      "priority": 3
    },
    
    {
      "modification_id": "M002",
      "cell": "D5",
      "row_number": 5,
      "column_name": "é‡è¦ç¨‹åº¦",
      "column_level": "L1",
      "old_value": "é«˜",
      "new_value": "ä¸­",
      
      "scoring_components": {
        "base_score": 0.8,
        "change_factor": 1.1,
        "column_weight": 1.4,
        "ai_adjustment": 1.0,
        "confidence_weight": 1.0,
        "calculation": "0.8 Ã— 1.1 Ã— 1.4 Ã— 1.0 Ã— 1.0 = 1.232 â†’ 1.0"
      },
      
      "ai_analysis": {
        "enabled": false,
        "reason": "L1_column_rule_based"
      },
      
      "final_score": 1.0,
      "risk_level": "EXTREME_HIGH",
      "risk_color": "red",
      "risk_icon": "ğŸ”´",
      "action_required": "immediate_review",
      "priority": 1
    }
  ],
  
  "summary": {
    "total_score": 15.234,
    "average_score": 0.609,
    
    "risk_distribution": {
      "EXTREME_HIGH": 2,
      "HIGH": 5,
      "MEDIUM": 8,
      "LOW": 7,
      "EXTREME_LOW": 3
    },
    
    "column_level_stats": {
      "L1": {
        "count": 8,
        "avg_score": 0.875,
        "max_score": 1.0
      },
      "L2": {
        "count": 10,
        "avg_score": 0.523,
        "ai_calls": 10,
        "ai_failures": 0
      },
      "L3": {
        "count": 7,
        "avg_score": 0.142,
        "max_score": 0.2
      }
    },
    
    "ai_statistics": {
      "total_l2_modifications": 10,
      "ai_calls_made": 10,
      "layer1_only": 6,
      "layer2_analyzed": 4,
      "average_confidence": 82.5,
      "decision_distribution": {
        "APPROVE": 3,
        "CONDITIONAL": 2,
        "REVIEW": 4,
        "REJECT": 1
      }
    },
    
    "processing_metrics": {
      "total_time": "2.34s",
      "ai_processing_time": "1.89s",
      "rule_processing_time": "0.45s",
      "average_per_modification": "0.094s"
    }
  }
}
```

---

## 6. å…³é”®å®ç°è¦æ±‚

### 6.1 å¼ºåˆ¶è¦æ±‚

1. **ç¦æ­¢é™çº§**
   - L2åˆ—å¿…é¡»è°ƒç”¨AIè¯­ä¹‰åˆ†æ
   - AIæœåŠ¡ä¸å¯ç”¨æ—¶å¿…é¡»æŠ¥é”™ï¼Œä¸å…è®¸fallback
   - ä¸å…è®¸ä½¿ç”¨mockæˆ–æ¨¡æ‹Ÿæ•°æ®

2. **æ•°æ®å®Œæ•´æ€§**
   - AIåˆ†æç»“æœå¿…é¡»å®Œæ•´ä¿å­˜
   - æ¯ä¸ªæ‰“åˆ†ç»„ä»¶éƒ½è¦è®°å½•
   - ä¿ç•™è®¡ç®—è¿‡ç¨‹ç”¨äºå®¡è®¡

3. **æœåŠ¡ä¾èµ–**
   - ç¡®ä¿8098ç«¯å£è¯­ä¹‰åˆ†ææœåŠ¡è¿è¡Œ
   - é…ç½®çœŸå®çš„DeepSeek APIå¯†é’¥
   - å®ç°ä¸¤å±‚AIæ¶æ„ï¼ˆå¿«é€Ÿç­›é€‰+æ·±åº¦åˆ†æï¼‰

### 6.2 æ€§èƒ½è¦æ±‚

- å•ä¸ªä¿®æ”¹å¤„ç†æ—¶é—´ < 200msï¼ˆä¸å«AIï¼‰
- AIåˆ†æå“åº”æ—¶é—´ < 2s
- æ‰¹é‡å¤„ç†æ”¯æŒå¹¶å‘

### 6.3 é”™è¯¯å¤„ç†

```python
def handle_scoring_error(mod: Dict, error: Exception) -> Dict:
    """
    é”™è¯¯å¤„ç†ï¼ˆä¸å…è®¸é™çº§ï¼‰
    """
    # è®°å½•é”™è¯¯ä½†ä¸é™çº§
    logger.error(f"æ‰“åˆ†å¤±è´¥: {error}")
    
    # å¿…é¡»æŠ›å‡ºå¼‚å¸¸ï¼Œä¸å…è®¸è¿”å›é»˜è®¤å€¼
    raise Exception(f"æ— æ³•å®Œæˆæ‰“åˆ†: {error}")
```

---

## 7. ç³»ç»Ÿé›†æˆç‚¹

### 7.1 ä¸Šæ¸¸è¾“å…¥
- **æ¥æº**: åˆ—æ ‡å‡†åŒ–åçš„ç®€åŒ–å¯¹æ¯”JSON
- **è·¯å¾„**: `/comparison_results/simplified_*.json`
- **æ ¼å¼**: æ ‡å‡†åŒ–çš„modificationsæ•°ç»„

### 7.2 å¤„ç†æµç¨‹
1. è¯»å–ç®€åŒ–å¯¹æ¯”æ–‡ä»¶
2. æŒ‰åˆ—çº§åˆ«åˆ†ç±»ï¼ˆL1/L2/L3ï¼‰
3. L1/L3ä½¿ç”¨è§„åˆ™æ‰“åˆ†
4. L2è°ƒç”¨AIè¯­ä¹‰åˆ†æ
5. ç»¼åˆè®¡ç®—æœ€ç»ˆå¾—åˆ†
6. ç”Ÿæˆè¯¦ç»†æ‰“åˆ†æ–‡ä»¶

### 7.3 ä¸‹æ¸¸è¾“å‡º
- **æ¶ˆè´¹è€…**: ç»¼åˆæ±‡æ€»å™¨ï¼ˆcomprehensive_aggregator.pyï¼‰
- **ç”¨é€”**: ç”Ÿæˆåˆ—çº§é£é™©æŠ¥å‘Š
- **æ ¼å¼**: è¯¦ç»†æ‰“åˆ†JSONæ–‡ä»¶

---

## 8. æµ‹è¯•éªŒè¯

### 8.1 L1åˆ—æµ‹è¯•ç”¨ä¾‹
```python
# æµ‹è¯•é«˜é£é™©ä¿®æ”¹
test_l1 = {
    'column_name': 'é‡è¦ç¨‹åº¦',
    'old_value': 'é«˜',
    'new_value': 'ä½'
}
# é¢„æœŸ: final_score = 1.0 (æé«˜é£é™©)
```

### 8.2 L2åˆ—æµ‹è¯•ç”¨ä¾‹
```python
# æµ‹è¯•AIåˆ†æ
test_l2 = {
    'column_name': 'é¡¹ç›®ç±»å‹',
    'old_value': 'ç ”å‘',
    'new_value': 'è¿è¥'
}
# é¢„æœŸ: è°ƒç”¨AIæœåŠ¡ï¼Œè¿”å›REVIEWå†³ç­–
```

### 8.3 L3åˆ—æµ‹è¯•ç”¨ä¾‹
```python
# æµ‹è¯•ä½é£é™©ä¿®æ”¹
test_l3 = {
    'column_name': 'åºå·',
    'old_value': '1',
    'new_value': '01'
}
# é¢„æœŸ: final_score < 0.2 (æä½é£é™©)
```

---

## 9. å¸¸è§é—®é¢˜

### Q1: AIæœåŠ¡è°ƒç”¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A**: å¿…é¡»æŠ¥é”™ï¼Œä¸å…è®¸é™çº§ã€‚æ£€æŸ¥8098ç«¯å£æœåŠ¡çŠ¶æ€ã€‚

### Q2: å¦‚ä½•æ·»åŠ æ–°çš„L2åˆ—ï¼Ÿ
**A**: æ›´æ–°L2_COLUMNSæ•°ç»„ï¼Œç¡®ä¿AIæç¤ºè¯åŒ…å«æ–°åˆ—çš„ä¸šåŠ¡å«ä¹‰ã€‚

### Q3: æ‰“åˆ†ç»“æœä¸åˆç†æ€ä¹ˆè°ƒæ•´ï¼Ÿ
**A**: è°ƒæ•´åˆ—æƒé‡æˆ–AIå†³ç­–æ˜ å°„ç³»æ•°ï¼Œä½†ä¸èƒ½è·³è¿‡AIåˆ†æã€‚

---

## 10. ç‰ˆæœ¬å†å²

- v2.0 (2025-09-08): ç¦æ­¢é™çº§æ–¹æ³•ï¼Œå¼ºåˆ¶L2ä½¿ç”¨AI
- v1.0 (2025-09-07): åˆå§‹ç‰ˆæœ¬

---

**æ–‡æ¡£ç»´æŠ¤**: è…¾è®¯æ–‡æ¡£æ™ºèƒ½ç›‘æ§ç³»ç»Ÿå›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-09-08  
**çŠ¶æ€**: ç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶æ‰§è¡Œ