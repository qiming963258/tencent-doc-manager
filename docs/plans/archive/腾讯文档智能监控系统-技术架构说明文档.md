# è…¾è®¯æ–‡æ¡£æ™ºèƒ½ç›‘æ§ç³»ç»Ÿ - æŠ€æœ¯æ¶æ„è¯´æ˜æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0  
**æ›´æ–°æ—¶é—´**: 2025-08-31  
**ç³»ç»Ÿä»£å·**: TencentDocMonitor  
**æ¶æ„ç‰ˆæœ¬**: Production-2025  

---

## æ‰§è¡Œæ‘˜è¦

è…¾è®¯æ–‡æ¡£æ™ºèƒ½ç›‘æ§ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„æ–‡æ¡£å˜æ›´ç›‘æ§ä¸é£é™©è¯„ä¼°è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡è‡ªåŠ¨åŒ–ä¸‹è½½ã€æ™ºèƒ½å¯¹æ¯”åˆ†æã€AIè¯­ä¹‰å®¡æ ¸å’Œå¯è§†åŒ–çƒ­åŠ›å›¾å±•ç¤ºï¼Œå®ç°å¯¹è…¾è®¯æ–‡æ¡£è¡¨æ ¼çš„å…¨ç”Ÿå‘½å‘¨æœŸç›‘æ§ã€‚ç³»ç»Ÿé‡‡ç”¨10æ­¥å®Œæ•´å¤„ç†é“¾è·¯ï¼Œä»CSVæ–‡ä»¶è·å–åˆ°æœ€ç»ˆçš„ExcelåŠå¡«å……æ ‡è®°ï¼Œæä¾›ç«¯åˆ°ç«¯çš„æ™ºèƒ½åŒ–æ–‡æ¡£ç®¡ç†èƒ½åŠ›ã€‚ç³»ç»Ÿå·²å‡çº§ä¸ºé…ç½®é©±åŠ¨æ¶æ„ï¼Œæ”¯æŒåŠ¨æ€æ–‡æ¡£æ•°é‡ç®¡ç†ã€‚

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 
- **è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜**: å…¨é“¾è·¯è‡ªåŠ¨åŒ–ï¼Œä»æ–‡æ¡£ä¸‹è½½åˆ°é£é™©è¯„ä¼°æ— éœ€äººå·¥å¹²é¢„
- **æ™ºèƒ½åˆ†æèƒ½åŠ›**: é›†æˆClaude AIè¿›è¡Œè¯­ä¹‰åˆ†æå’Œé£é™©è¯„ä¼°
- **å¯è§†åŒ–å‘ˆç°**: çƒ­åŠ›å›¾ç›´è§‚å±•ç¤ºåŠ¨æ€NÃ—19çŸ©é˜µçš„å˜æ›´åˆ†å¸ƒ
- **å®æ—¶ç›‘æ§**: æ”¯æŒå‘¨ä¸€/å‘¨å››å®šæ—¶è‡ªåŠ¨åˆ·æ–°ï¼Œå®æ—¶è·Ÿè¸ªæ–‡æ¡£å˜åŒ–
- **é£é™©åˆ†çº§ç®¡ç†**: L1/L2/L3ä¸‰çº§é£é™©è¯„ä¼°ä½“ç³»ï¼Œç²¾å‡†å®šä½é«˜å±å˜æ›´

---

## ç¬¬ä¸€ç« ï¼šç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### 1.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è…¾è®¯æ–‡æ¡£æ™ºèƒ½ç›‘æ§ç³»ç»Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   å‰ç«¯å±•ç¤º    â”‚    â”‚   APIå±‚      â”‚    â”‚   å¤„ç†å¼•æ“   â”‚      â”‚
â”‚  â”‚              â”‚â—„â”€â”€â”€â–ºâ”‚              â”‚â—„â”€â”€â”€â–ºâ”‚              â”‚      â”‚
â”‚  â”‚  Reactçƒ­åŠ›å›¾  â”‚    â”‚  FlaskæœåŠ¡   â”‚    â”‚  10æ­¥å¤„ç†é“¾  â”‚      â”‚
â”‚  â”‚  åŠ¨æ€è¡Œæ•°     â”‚    â”‚  RESTful API â”‚    â”‚  é…ç½®é©±åŠ¨    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â–²                    â–²                    â–²              â”‚
â”‚         â”‚                    â”‚                    â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   å¯è§†åŒ–     â”‚    â”‚   Claude AI   â”‚    â”‚   æ•°æ®å­˜å‚¨    â”‚      â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚      â”‚
â”‚  â”‚  Canvasæ¸²æŸ“  â”‚    â”‚  è¯­ä¹‰åˆ†æå¼•æ“ â”‚    â”‚  JSON/CSV     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ç»„ä»¶ | ç‰ˆæœ¬/è§„æ ¼ | ç”¨é€” |
|------|---------|-----------|------|
| **å‰ç«¯** | React | 18.x | çƒ­åŠ›å›¾UIæ¡†æ¶ |
| | Canvas API | HTML5 | çƒ­åƒå›¾æ¸²æŸ“ |
| | TailwindCSS | 3.x | æ ·å¼æ¡†æ¶ |
| **åç«¯** | Flask | 2.x | WebæœåŠ¡æ¡†æ¶ |
| | Python | 3.9+ | ä¸»è¦å¼€å‘è¯­è¨€ |
| | FastAPI | 0.100+ | Claude APIæœåŠ¡ |
| **AIå¼•æ“** | Claude API | Opus 4.1 | æ™ºèƒ½åˆ†æå¼•æ“ |
| | è‡ªå®šä¹‰Wrapper | 1.0 | APIå°è£…å±‚ |
| **è‡ªåŠ¨åŒ–** | Playwright | 1.35+ | æµè§ˆå™¨è‡ªåŠ¨åŒ– |
| | asyncio | å†…ç½® | å¼‚æ­¥å¤„ç† |
| **æ•°æ®å¤„ç†** | pandas | 1.5+ | CSVå¤„ç† |
| | openpyxl | 3.1+ | Excelç”Ÿæˆ |

### 1.3 éƒ¨ç½²æ¶æ„

```yaml
æœåŠ¡å™¨é…ç½®:
  ä¸»æœåŠ¡å™¨: 202.140.143.88
  ç«¯å£åˆ†é…:
    - 8089: ä¸»UIæœåŠ¡ (final_heatmap_server.py)
    - 8000: Claude APIæœåŠ¡ (claude_mini_wrapper)
    - 3000: å¼€å‘æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰
  
ç›®å½•ç»“æ„:
  /root/projects/tencent-doc-manager/
    â”œâ”€â”€ production/servers/          # ç”Ÿäº§æœåŠ¡å™¨ä»£ç 
    â”œâ”€â”€ æµ‹è¯•ç‰ˆæœ¬-æ€§èƒ½ä¼˜åŒ–å¼€å‘/        # æ ¸å¿ƒå¤„ç†æ¨¡å—
    â”œâ”€â”€ claude_mini_wrapper/         # AIæœåŠ¡å°è£…
    â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶
    â”œâ”€â”€ csv_versions/               # CSVç‰ˆæœ¬ç®¡ç†
    â”œâ”€â”€ uploads/                    # ä¸Šä¼ æ–‡ä»¶å­˜å‚¨
    â””â”€â”€ excel_outputs/              # Excelè¾“å‡ºç›®å½•
```

---

## ç¬¬äºŒç« ï¼šæ ¸å¿ƒå¤„ç†æµç¨‹

### 2.1 åæ­¥å®Œæ•´å¤„ç†é“¾è·¯

ç³»ç»Ÿé‡‡ç”¨10ä¸ªæ ‡å‡†åŒ–æ­¥éª¤å®Œæˆä»æ•°æ®é‡‡é›†åˆ°æœ€ç»ˆå±•ç¤ºçš„å®Œæ•´æµç¨‹ï¼š

#### æ­¥éª¤1ï¼šCSVä¸‹è½½ä¸ç‰ˆæœ¬ç®¡ç†
**æ¨¡å—**: `tencent_export_automation.py` + `csv_version_manager.py`
**åŠŸèƒ½**: è‡ªåŠ¨ä»è…¾è®¯æ–‡æ¡£ä¸‹è½½CSVæ–‡ä»¶å¹¶è¿›è¡Œç‰ˆæœ¬ç®¡ç†

```python
# æ ¸å¿ƒå¤„ç†é€»è¾‘
class TencentDocAutoExporter:
    async def auto_export_document(self, doc_url, export_format="csv"):
        # 1. æ™ºèƒ½URLåˆ†æ
        url_analysis = self._analyze_document_url(doc_url)
        
        # 2. è®¿é—®é¡µé¢
        await self.page.goto(doc_url, wait_until='domcontentloaded')
        
        # 3. æ‰§è¡Œå¯¼å‡ºç­–ç•¥
        success = await self._execute_smart_export_strategy(url_analysis, export_format)
        
        # 4. ç‰ˆæœ¬ç®¡ç†
        if self.version_manager:
            result = self.version_manager.add_version(downloaded_file, table_name)
```

**æ–‡ä»¶å‘½åè§„èŒƒ**:
- æ ¼å¼: `{è¡¨æ ¼å}_{æ—¥æœŸ}_{æ—¶é—´}_v{ç‰ˆæœ¬å·}.csv`
- ç¤ºä¾‹: `å°çº¢ä¹¦å†…å®¹å®¡æ ¸è®°å½•è¡¨_20250818_1400_v001.csv`
- å­˜å‚¨ä½ç½®: `/csv_versions/current/` (å½“å‰ç‰ˆæœ¬) å’Œ `/csv_versions/archive/` (å†å²ç‰ˆæœ¬)

#### æ­¥éª¤2ï¼šCSVå¯¹æ¯”åˆ†æ
**æ¨¡å—**: `simple_csv_diff.py`
**åŠŸèƒ½**: å¯¹æ¯”åŸºå‡†ç‰ˆæœ¬å’Œå½“å‰ç‰ˆæœ¬ï¼Œç”Ÿæˆå·®å¼‚å‚æ•°

```python
def compare_csv_simple(file1_path, file2_path, output_file=None):
    # é€è¡Œé€åˆ—å¯¹æ¯”
    for row_idx in range(min_rows):
        for col_idx, col_name1, col_name2 in common_columns:
            if old_val != new_val:
                diff = {
                    "åºå·": diff_count,
                    "è¡Œå·": row_idx + 1,
                    "åˆ—å": column_name,
                    "åˆ—ç´¢å¼•": col_idx + 1,
                    "åŸå€¼": old_val,
                    "æ–°å€¼": new_val,
                    "ä½ç½®": f"è¡Œ{row_idx+1}åˆ—{col_idx+1}({column_name})"
                }
```

**è¾“å‡ºæ ¼å¼**:
```json
{
  "comparison_summary": {
    "baseline_file": "baseline.csv",
    "current_file": "current.csv",
    "total_differences": 18,
    "rows_compared": 92,
    "columns_compared": 20
  },
  "differences": [...]
}
```

#### æ­¥éª¤3ï¼šAIåˆ—åæ ‡å‡†åŒ–
**APIç«¯ç‚¹**: `/api/ai-column-mapping`
**æ¨¡å—**: `claude_mini_wrapper/main.py`
**åŠŸèƒ½**: ä½¿ç”¨Claude AIå°†å®é™…åˆ—åæ˜ å°„åˆ°19ä¸ªæ ‡å‡†åˆ—å

**æ ‡å‡†åˆ—åå®šä¹‰**:
```python
standard_columns = [
    "åºå·", "é¡¹ç›®ç±»å‹", "æ¥æº", "ä»»åŠ¡å‘èµ·æ—¶é—´", "ç›®æ ‡å¯¹é½",
    "å…³é”®KRå¯¹é½", "å…·ä½“è®¡åˆ’å†…å®¹", "é‚“æ€»æŒ‡å¯¼ç™»è®°", "è´Ÿè´£äºº",
    "ååŠ©äºº", "ç›‘ç£äºº", "é‡è¦ç¨‹åº¦", "é¢„è®¡å®Œæˆæ—¶é—´", "å®Œæˆè¿›åº¦", 
    "å½¢æˆè®¡åˆ’æ¸…å•", "å¤ç›˜æ—¶é—´", "å¯¹ä¸Šæ±‡æŠ¥", "åº”ç”¨æƒ…å†µ", "è¿›åº¦åˆ†ææ€»ç»“"
]
```

**å¤„ç†æµç¨‹**:
1. æå–å·®å¼‚æ–‡ä»¶ä¸­çš„å”¯ä¸€åˆ—å
2. è°ƒç”¨Claude AIè¿›è¡Œæ™ºèƒ½åŒ¹é…
3. è¿”å›æ˜ å°„å…³ç³»å’Œç½®ä¿¡åº¦åˆ†æ•°
4. å­˜å‚¨ä¸º`table_XXX_diff_column_mapping.json`

#### æ­¥éª¤4ï¼šL2è¯­ä¹‰åˆ†æ
**APIç«¯ç‚¹**: `/api/l2-semantic-analysis`
**åŠŸèƒ½**: å¯¹L2çº§å­—æ®µè¿›è¡Œè¯­ä¹‰å®¡æ ¸

**L2çº§å­—æ®µå®šä¹‰**:
```python
l2_fields = [
    "é¡¹ç›®ç±»å‹", "å…·ä½“è®¡åˆ’å†…å®¹", "é‚“æ€»æŒ‡å¯¼ç™»è®°", 
    "è´Ÿè´£äºº", "ååŠ©äºº", "ç›‘ç£äºº", "å½¢æˆè®¡åˆ’æ¸…å•"
]
```

**AIå†³ç­–ç±»å‹**:
- `APPROVE`: æ‰¹å‡†ä¿®æ”¹
- `REJECT`: æ‹’ç»ä¿®æ”¹
- `REVIEW`: éœ€è¦äººå·¥å®¡æ ¸
- `CONDITIONAL`: æœ‰æ¡ä»¶æ‰¹å‡†

#### æ­¥éª¤5ï¼šé£é™©è¯„åˆ†ç®—æ³•
**APIç«¯ç‚¹**: `/api/risk-scoring`
**åŠŸèƒ½**: åŸºäºL1/L2/L3ç­‰çº§è®¡ç®—é£é™©åˆ†æ•°

**é£é™©ç­‰çº§å®šä¹‰**:
| ç­‰çº§ | è¯´æ˜ | åŸºç¡€åˆ†æ•° | å­—æ®µç¤ºä¾‹ |
|------|------|---------|---------|
| L1 | é«˜é£é™©ï¼Œç¦æ­¢ä¿®æ”¹ | 0.7-1.0 | ä»»åŠ¡å‘èµ·æ—¶é—´ã€ç›®æ ‡å¯¹é½ã€é‡è¦ç¨‹åº¦ |
| L2 | ä¸­é£é™©ï¼Œéœ€å®¡æ ¸ | 0.3-0.7 | é¡¹ç›®ç±»å‹ã€è´Ÿè´£äººã€å…·ä½“è®¡åˆ’å†…å®¹ |
| L3 | ä½é£é™©ï¼Œå¯è‡ªç”±ç¼–è¾‘ | 0.0-0.3 | å¤ç›˜æ—¶é—´ã€å¯¹ä¸Šæ±‡æŠ¥ã€åº”ç”¨æƒ…å†µ |

**è¯„åˆ†ç®—æ³•**:
```python
def calculate_risk_score(change):
    base_score = get_base_score_by_level(risk_level)
    
    # AIå¢å¼ºå› å­
    if has_ai_analysis:
        if ai_decision == "REJECT":
            base_score *= 1.5
        elif ai_decision == "APPROVE":
            base_score *= 0.8
    
    # ä¿®æ”¹å¹…åº¦å› å­
    change_magnitude = calculate_change_magnitude(old_val, new_val)
    final_score = base_score * (1 + change_magnitude * 0.3)
    
    return min(0.99, final_score)
```

#### æ­¥éª¤6ï¼šUIå‚æ•°ç”Ÿæˆ
**APIç«¯ç‚¹**: `/api/ui-parameters`
**åŠŸèƒ½**: ç”Ÿæˆ5200+ä¸ªå¯è§†åŒ–å‚æ•°

**å‚æ•°ç»“æ„**:
```javascript
{
  "heatmap": {
    "matrix": [[30x19çŸ©é˜µæ•°æ®]],
    "labels": {rows: [...], cols: [...]},
    "dimensions": {rows: 30, cols: 19},
    "color_scale": {
      "levels": 5,
      "colors": ["#0066cc", "#0099cc", "#66cc66", "#ffcc00", "#cc0000"]
    }
  },
  "sorting": {
    "by_risk": [...],      // æŒ‰é£é™©æ’åº
    "by_score": [...],     // æŒ‰åˆ†æ•°æ’åº
    "by_position": [...]   // æŒ‰ä½ç½®æ’åº
  },
  "distribution": {
    "by_column": {...},    // åˆ—åˆ†å¸ƒ
    "by_row": {...},       // è¡Œåˆ†å¸ƒ
    "by_risk_level": {...} // é£é™©ç­‰çº§åˆ†å¸ƒ
  }
}
```

#### æ­¥éª¤7ï¼šå‰ç«¯æ•°æ®è·å–
**APIç«¯ç‚¹**: `/api/data`
**åŠŸèƒ½**: æä¾›å®æ—¶çƒ­åŠ›å›¾æ•°æ®

**æ•°æ®æµç¨‹**:
1. è¯»å–30ä¸ª`table_XXX_diff.json`æ–‡ä»¶
2. åº”ç”¨åŒç»´åº¦æ™ºèƒ½èšç±»ç®—æ³•
3. ç”Ÿæˆ30Ã—19çƒ­åŠ›çŸ©é˜µ
4. è¿”å›åŒ…å«è¡Œåˆ—é‡æ’åºä¿¡æ¯çš„å®Œæ•´æ•°æ®

#### æ­¥éª¤8ï¼šåŒç»´åº¦èšç±»ç®—æ³•
**æ¨¡å—**: `final_heatmap_server.py` (è¡Œ384-777)
**åŠŸèƒ½**: æ™ºèƒ½è¡Œåˆ—é‡æ’åºï¼Œå½¢æˆçƒ­ç‚¹èšé›†æ•ˆæœ

**ç®—æ³•ç»„æˆ**:
1. **Getis-Ord Gi*çƒ­ç‚¹æ£€æµ‹**: è¯†åˆ«ç»Ÿè®¡æ˜¾è‘—çš„çƒ­ç‚¹å’Œå†·ç‚¹
2. **SpectralCoclusteringåŒèšç±»**: åŒæ—¶ä¼˜åŒ–è¡Œåˆ—æ’åº
3. **Reverse Cuthill-McKeeå¸¦å®½ä¼˜åŒ–**: æœ€å°åŒ–çŸ©é˜µå¸¦å®½
4. **æ··åˆåŠ æƒèåˆ**: 40% Gi* + 30% èšç±» + 30% å¸¦å®½

```python
def hybrid_column_reorder(matrix):
    # 1. Getis-Ord Gi*çƒ­ç‚¹åˆ†æ
    gi_star_matrix, hotspot_count = calculate_getis_ord_gi_star(matrix)
    
    # 2. SpectralCoclusteringåŒèšç±»
    row_clusters, col_clusters = spectral_coclustering_reorder(matrix)
    
    # 3. Cuthill-McKeeå¸¦å®½ä¼˜åŒ–
    cm_order = cuthill_mckee_reorder(matrix)
    
    # 4. èåˆå¤šç®—æ³•ç»“æœ
    for col in non_seq_cols:
        score = gi_contribution * 0.4 + cluster_size * 0.3 + position_score * 0.3
```

#### æ­¥éª¤9ï¼šCanvasçƒ­åƒæ¸²æŸ“
**å‰ç«¯æ¨¡å—**: Reactç»„ä»¶ `ContinuousHeatmap`
**åŠŸèƒ½**: ä½¿ç”¨IDWç®—æ³•ç”Ÿæˆè¿ç»­çƒ­åŠ›åœº

**æ¸²æŸ“ç®—æ³•**:
```javascript
// IDWåè·ç¦»åŠ æƒæ’å€¼
for (let y = 0; y < canvasHeight; y++) {
  for (let x = 0; x < canvasWidth; x++) {
    for (const source of heatSources) {
      const distance = Math.sqrt(Math.pow(x - source.x, 2) + Math.pow(y - source.y, 2));
      if (distance < 1) {
        weightedSum = source.intensity;
        break;
      }
      const weight = 1 / Math.pow(distance, powerParameter);
      weightedSum += source.intensity * weight;
      weightSum += weight;
    }
    finalIntensity = weightedSum / weightSum;
    // åº”ç”¨çƒ­æˆåƒè‰²å½©æ˜ å°„
    const color = getThermalImageColor(finalIntensity);
  }
}
```

**è‰²å½©æ˜ å°„**: ç»å…¸FLIRçƒ­åƒä»ªè‰²å½©ï¼ˆé»‘â†’æ·±è“â†’è“â†’é’â†’ç»¿â†’é»„â†’æ©™â†’çº¢â†’ç™½ï¼‰

#### æ­¥éª¤10ï¼šExcelåŠå¡«å……å¯¼å‡º
**APIç«¯ç‚¹**: `/api/excel-export`
**åŠŸèƒ½**: ç”Ÿæˆä¸“ä¸šExcelæŠ¥å‘Š

**ç‰¹æ€§**:
- lightUpçº¹ç†å¡«å……
- é£é™©è‰²å½©ç¼–ç ï¼ˆL1çº¢è‰²ã€L2æ©™è‰²ã€L3ç»¿è‰²ï¼‰
- AIæ‰¹æ³¨ç³»ç»Ÿ
- è‡ªåŠ¨ä¸Šä¼ åˆ°è…¾è®¯æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰

---

## ç¬¬ä¸‰ç« ï¼šæ•°æ®ç»“æ„å®šä¹‰

### 3.1 å·®å¼‚æ•°æ®ç»“æ„

```typescript
interface DifferenceItem {
  åºå·: number;
  è¡Œå·: number;
  åˆ—å: string;
  åˆ—ç´¢å¼•: number;
  åŸå€¼: string;
  æ–°å€¼: string;
  ä½ç½®: string;
}

interface ComparisonSummary {
  baseline_file: string;
  current_file: string;
  total_differences: number;
  rows_compared: number;
  columns_compared: number;
}
```

### 3.2 é£é™©è¯„åˆ†æ•°æ®ç»“æ„

```typescript
interface RiskScoringResult {
  åºå·: number;
  è¡Œå·: number;
  åˆ—å: string;
  åŸå€¼: string;
  æ–°å€¼: string;
  base_risk_score: number;      // åŸºç¡€é£é™©åˆ†
  ai_confidence: number;         // AIç½®ä¿¡åº¦
  adjusted_risk_score: number;   // è°ƒæ•´åé£é™©åˆ†
  final_risk_level: "L1" | "L2" | "L3";
  ai_decision?: "APPROVE" | "REJECT" | "REVIEW" | "CONDITIONAL";
  has_ai_analysis: boolean;
}
```

### 3.3 çƒ­åŠ›å›¾æ•°æ®ç»“æ„

```typescript
interface HeatmapData {
  heatmap_data: number[][];     // 30x19çŸ©é˜µ
  column_names: string[];        // 19ä¸ªåˆ—å
  tables: TableInfo[];           // 30ä¸ªè¡¨æ ¼ä¿¡æ¯
  column_reorder_info: number[]; // åˆ—é‡æ’åºæ˜ å°„
}

interface TableInfo {
  id: number;                   // åŸå§‹ID
  name: string;                  // è¡¨æ ¼åç§°
  url: string;                   // è…¾è®¯æ–‡æ¡£é“¾æ¥
  risk_level: string;            // é£é™©ç­‰çº§
  current_position: number;      // å½“å‰ä½ç½®ï¼ˆèšç±»åï¼‰
  is_reordered: boolean;         // æ˜¯å¦è¢«é‡æ’åº
  row_level_data: {              // è¡Œçº§å·®å¼‚æ•°æ®
    total_rows: number;
    total_differences: number;
    modified_rows: number[];
    column_modifications: Record<string, any>;
  };
}
```

---

## ç¬¬å››ç« ï¼šAPIæ¥å£æ–‡æ¡£

### 4.1 æ ¸å¿ƒAPIåˆ—è¡¨

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è¾“å…¥ | è¾“å‡º |
|------|------|------|------|------|
| `/api/data` | GET | è·å–çƒ­åŠ›å›¾æ•°æ® | - | HeatmapData |
| `/api/ai-column-mapping` | POST | AIåˆ—åæ ‡å‡†åŒ– | differences[] | mapping{} |
| `/api/l2-semantic-analysis` | POST | L2è¯­ä¹‰åˆ†æ | processed_columns[] | l2_analysis_results[] |
| `/api/risk-scoring` | POST | é£é™©è¯„åˆ† | l2_analysis_results[] | risk_scoring_results[] |
| `/api/ui-parameters` | GET | UIå‚æ•°ç”Ÿæˆ | - | ui_parameters{} |
| `/api/excel-export` | POST | Excelå¯¼å‡º | auto_upload:boolean | excel_file:string |
| `/api/start-download` | POST | å¯åŠ¨CSVä¸‹è½½ | - | download_results[] |
| `/api/save-cookies` | POST | ä¿å­˜Cookie | cookies:string | success:boolean |
| `/api/document-links` | GET | è·å–æ–‡æ¡£é“¾æ¥ | - | document_links{} |

### 4.2 å…³é”®APIè¯¦è§£

#### è·å–çƒ­åŠ›å›¾æ•°æ® `/api/data`

**è¯·æ±‚ç¤ºä¾‹**:
```http
GET /api/data HTTP/1.1
Host: 202.140.143.88:8089
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "heatmap_data": [[30x19çŸ©é˜µ]],
    "tables": [
      {
        "id": 0,
        "name": "å°çº¢ä¹¦å†…å®¹å®¡æ ¸è®°å½•è¡¨",
        "url": "https://docs.qq.com/sheet/xxx",
        "risk_level": "L1",
        "current_position": 0,
        "is_reordered": false,
        "row_level_data": {
          "total_rows": 50,
          "total_differences": 18,
          "modified_rows": [1, 3, 5, 7]
        }
      }
    ],
    "column_names": ["åºå·", "é¡¹ç›®ç±»å‹", ...],
    "column_reorder_info": [0, 3, 1, 2, ...],
    "statistics": {
      "total_changes_detected": 540,
      "l1_high_risk_count": 108,
      "l2_medium_risk_count": 216,
      "l3_low_risk_count": 216
    }
  }
}
```

---

## ç¬¬äº”ç« ï¼šç®—æ³•å®ç°ç»†èŠ‚

### 5.1 çƒ­æ‰©æ•£ç®—æ³•

çƒ­æ‰©æ•£ç®—æ³•ç”¨äºå°†ç¦»æ•£çš„çƒ­åŠ›ç‚¹è½¬æ¢ä¸ºè¿ç»­çš„æ¸å˜åœºï¼š

```python
def apply_advanced_heat_diffusion(matrix, iterations=25, diffusion_rate=0.4):
    """
    å‚æ•°:
        matrix: è¾“å…¥çš„ç¦»æ•£çƒ­åŠ›çŸ©é˜µ
        iterations: æ‰©æ•£è¿­ä»£æ¬¡æ•°ï¼ˆè¶Šå¤šè¶Šå¹³æ»‘ï¼‰
        diffusion_rate: æ‰©æ•£å¼ºåº¦ (0-1ï¼Œè¶Šå¤§æ‰©æ•£è¶Šå¼º)
    """
    # 8æ–¹å‘æ‰©æ•£ï¼ˆåŒ…æ‹¬å¯¹è§’çº¿ï¼‰
    directions = [(-2,-2), (-2,-1), (-2,0), (-2,1), (-2,2),
                 (-1,-2), (-1,-1), (-1,0), (-1,1), (-1,2),
                 (0,-2), (0,-1), (0,0), (0,1), (0,2),
                 (1,-2), (1,-1), (1,0), (1,1), (1,2),
                 (2,-2), (2,-1), (2,0), (2,1), (2,2)]
    
    # è®¡ç®—è·ç¦»æƒé‡ï¼ˆé«˜æ–¯è¡°å‡ï¼‰
    for di, dj in directions:
        distance = math.sqrt(di * di + dj * dj)
        weight = math.exp(-distance * 0.3) if distance > 0 else 1.0
    
    # çƒ­æ‰©æ•£å…¬å¼
    new_heat = current[i][j] * (1 - diffusion_rate) + neighbor_influence * diffusion_rate
```

### 5.2 Getis-Ord Gi*çƒ­ç‚¹æ£€æµ‹

ç”¨äºè¯†åˆ«ç»Ÿè®¡æ˜¾è‘—çš„çƒ­ç‚¹èšé›†åŒºåŸŸï¼š

```python
def calculate_getis_ord_gi_star(matrix):
    """
    è®¡ç®—Getis-Ord Gi*ç»Ÿè®¡é‡
    è¿”å›Z-scoreçŸ©é˜µï¼Œç»å¯¹å€¼>1.96è¡¨ç¤ºç»Ÿè®¡æ˜¾è‘—ï¼ˆp<0.05ï¼‰
    """
    # å…¨å±€ç»Ÿè®¡é‡
    global_mean = sum(all_values) / len(all_values)
    global_variance = sum((v - global_mean) ** 2 for v in all_values) / len(all_values)
    
    # ç©ºé—´æƒé‡çŸ©é˜µï¼ˆå…«é‚»åŸŸï¼‰
    for i in range(rows):
        for j in range(cols):
            # Gi*ç»Ÿè®¡é‡è®¡ç®—
            weighted_sum = sum(neighbor_values * weights)
            expected = global_mean * total_weight
            variance = calculate_spatial_variance(...)
            
            # Z-scoreè®¡ç®—
            z_score = (weighted_sum - expected) / sqrt(variance)
            
            # æ˜¾è‘—æ€§æ£€éªŒ (|z| > 1.96)
            if abs(z_score) > 1.96:
                significant_hotspot_detected()
```

### 5.3 é£é™©è¯„åˆ†å¤šå› å­æ¨¡å‹

```python
def calculate_adjusted_risk_score(change):
    """
    å¤šå› å­é£é™©è¯„åˆ†æ¨¡å‹
    """
    # åŸºç¡€é£é™©å› å­ï¼ˆæŒ‰ç­‰çº§ï¼‰
    base_factor = {
        "L1": 0.8,  # é«˜é£é™©åŸºç¡€åˆ†
        "L2": 0.5,  # ä¸­é£é™©åŸºç¡€åˆ†
        "L3": 0.2   # ä½é£é™©åŸºç¡€åˆ†
    }[risk_level]
    
    # AIå†³ç­–å› å­
    ai_factor = {
        "REJECT": 1.5,      # æ‹’ç»æ—¶å¢åŠ 50%
        "REVIEW": 1.2,      # å®¡æ ¸æ—¶å¢åŠ 20%
        "CONDITIONAL": 1.0, # æ¡ä»¶æ‰¹å‡†ä¸å˜
        "APPROVE": 0.8      # æ‰¹å‡†æ—¶é™ä½20%
    }.get(ai_decision, 1.0)
    
    # ä¿®æ”¹å¹…åº¦å› å­
    change_magnitude = levenshtein_distance(old_val, new_val) / max(len(old_val), len(new_val))
    magnitude_factor = 1 + change_magnitude * 0.3
    
    # åˆ—é‡è¦æ€§å› å­
    column_importance = {
        "ä»»åŠ¡å‘èµ·æ—¶é—´": 1.3,
        "è´Ÿè´£äºº": 1.2,
        "é‡è¦ç¨‹åº¦": 1.4,
        "å®Œæˆè¿›åº¦": 1.1
    }.get(column_name, 1.0)
    
    # ç»¼åˆè®¡ç®—
    final_score = base_factor * ai_factor * magnitude_factor * column_importance
    return min(0.99, max(0.01, final_score))
```

---

## ç¬¬å…­ç« ï¼šé…ç½®ç®¡ç†

### 6.1 é…ç½®æ–‡ä»¶ç»“æ„

```
/config/
â”œâ”€â”€ cookies.json              # Cookieé…ç½®
â”œâ”€â”€ download_settings.json    # ä¸‹è½½è®¾ç½®
â”œâ”€â”€ ui_config.json            # UIå‚æ•°é…ç½®
â””â”€â”€ schedule_tasks.json       # å®šæ—¶ä»»åŠ¡é…ç½®
```

### 6.2 Cookieé…ç½®æ ¼å¼

```json
{
  "current_cookies": "uid=xxx; SID=xxx; TOK=xxx; ...",
  "last_update": "2025-08-22T21:41:52.838853",
  "is_valid": true,
  "validation_message": "âœ… Cookieæ ¼å¼æ­£ç¡®",
  "last_test_time": "2025-08-22T21:42:00.123456"
}
```

### 6.3 ä¸‹è½½é…ç½®æ ¼å¼

```json
{
  "document_links": [
    {
      "name": "å°çº¢ä¹¦å†…å®¹å®¡æ ¸è®°å½•è¡¨",
      "url": "https://docs.qq.com/sheet/xxx",
      "enabled": true
    }
  ],
  "download_format": "csv",
  "schedule": {
    "enabled": true,
    "days": ["monday", "thursday"],
    "time": "09:00"
  }
}
```

---

## ç¬¬ä¸ƒç« ï¼šæ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 7.1 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### Canvasæ¸²æŸ“ä¼˜åŒ–
- **åŒå±‚æ¶æ„**: Canvaså±‚è´Ÿè´£çƒ­åƒæ¸²æŸ“ï¼ŒDOMå±‚è´Ÿè´£äº¤äº’
- **ç¦»å±æ¸²æŸ“**: ä½¿ç”¨`createImageData`ç›´æ¥æ“ä½œåƒç´ 
- **ç¼“å­˜ç­–ç•¥**: React.useMemoç¼“å­˜è®¡ç®—ç»“æœ
- **é˜²æŠ–å¤„ç†**: é¼ æ ‡æ‚¬æµ®äº‹ä»¶é˜²æŠ–ï¼Œå‡å°‘é‡æ¸²æŸ“

```javascript
// ä¼˜åŒ–çš„æ¸²æŸ“å¾ªç¯
const imageData = ctx.createImageData(canvasWidth, canvasHeight);
for (let y = 0; y < canvasHeight; y++) {
  for (let x = 0; x < canvasWidth; x++) {
    // ç›´æ¥æ“ä½œåƒç´ æ•°ç»„ï¼Œé¿å…å¤šæ¬¡drawImage
    const index = (y * canvasWidth + x) * 4;
    imageData.data[index] = color.r;
    imageData.data[index + 1] = color.g;
    imageData.data[index + 2] = color.b;
    imageData.data[index + 3] = color.a;
  }
}
ctx.putImageData(imageData, 0, 0);
```

### 7.2 åç«¯æ€§èƒ½ä¼˜åŒ–

#### æ•°æ®å¤„ç†ä¼˜åŒ–
- **æ‰¹å¤„ç†**: 30ä¸ªè¡¨æ ¼æ–‡ä»¶å¹¶è¡Œè¯»å–
- **ç¼“å­˜æœºåˆ¶**: çƒ­åŠ›å›¾æ•°æ®15åˆ†é’Ÿç¼“å­˜
- **å¢é‡æ›´æ–°**: åªå¤„ç†æœ‰å˜åŒ–çš„è¡¨æ ¼
- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨asyncioè¿›è¡ŒIOå¯†é›†æ“ä½œ

```python
# å¹¶è¡Œæ–‡ä»¶è¯»å–
async def load_all_tables():
    tasks = []
    for table_num in range(1, 31):
        tasks.append(load_table_async(table_num))
    results = await asyncio.gather(*tasks)
    return results
```

### 7.3 AIè°ƒç”¨ä¼˜åŒ–

#### Claude APIä¼˜åŒ–ç­–ç•¥
- **æ‰¹é‡è¯·æ±‚**: å¤šä¸ªL2å­—æ®µåˆå¹¶åˆ†æ
- **ç¼“å­˜ç»“æœ**: ç›¸åŒå†…å®¹24å°æ—¶å†…ä¸é‡å¤è°ƒç”¨
- **é™çº§ç­–ç•¥**: APIå¤±è´¥æ—¶ä½¿ç”¨è§„åˆ™å¼•æ“
- **é™æµæ§åˆ¶**: æ¯åˆ†é’Ÿæœ€å¤š20æ¬¡è¯·æ±‚

---

## ç¬¬å…«ç« ï¼šå®‰å…¨ä¸æƒé™

### 8.1 å®‰å…¨æªæ–½

#### CookieåŠ å¯†å­˜å‚¨
```python
# CookieåŠ å¯†ï¼ˆAES-256ï¼‰
from cryptography.fernet import Fernet

def encrypt_cookie(cookie_string):
    key = load_encryption_key()
    cipher = Fernet(key)
    encrypted = cipher.encrypt(cookie_string.encode())
    return encrypted.decode()
```

#### è¾“å…¥éªŒè¯
- SQLæ³¨å…¥é˜²æŠ¤ï¼šå‚æ•°åŒ–æŸ¥è¯¢
- XSSé˜²æŠ¤ï¼šè¾“å‡ºç¼–ç 
- è·¯å¾„éå†é˜²æŠ¤ï¼šç™½åå•éªŒè¯
- CSRFé˜²æŠ¤ï¼šTokenéªŒè¯

### 8.2 æƒé™æ§åˆ¶

| åŠŸèƒ½ | æƒé™çº§åˆ« | è¯´æ˜ |
|------|---------|------|
| æŸ¥çœ‹çƒ­åŠ›å›¾ | æ™®é€šç”¨æˆ· | åªè¯»è®¿é—® |
| ä¸‹è½½CSV | ç®¡ç†å‘˜ | éœ€è¦æœ‰æ•ˆCookie |
| ä¿®æ”¹é…ç½® | ç®¡ç†å‘˜ | éœ€è¦è®¤è¯ |
| å¯¼å‡ºExcel | é«˜çº§ç”¨æˆ· | éœ€è¦å®¡æ‰¹ |

---

## ç¬¬ä¹ç« ï¼šç›‘æ§ä¸å‘Šè­¦

### 9.1 ç›‘æ§æŒ‡æ ‡

#### ç³»ç»Ÿç›‘æ§
```yaml
ç›‘æ§é¡¹:
  - APIå“åº”æ—¶é—´: < 2ç§’
  - çƒ­åŠ›å›¾æ¸²æŸ“: < 500ms
  - CSVä¸‹è½½æˆåŠŸç‡: > 95%
  - AIåˆ†ææˆåŠŸç‡: > 90%
  
å‘Šè­¦é˜ˆå€¼:
  - ä¸¥é‡: APIè¶…æ—¶ > 10ç§’
  - è­¦å‘Š: å¤±è´¥ç‡ > 10%
  - æç¤º: é˜Ÿåˆ—ç§¯å‹ > 100
```

### 9.2 æ—¥å¿—è®°å½•

```python
# ç»“æ„åŒ–æ—¥å¿—
logger.info("ğŸ¯ å¼€å§‹ç¬¬å…­æ­¥UIå‚æ•°ç”Ÿæˆå¤„ç†", extra={
    "step": 6,
    "module": "ui_parameters",
    "input_count": len(risk_results),
    "timestamp": datetime.now().isoformat()
})
```

---

## ç¬¬åç« ï¼šéƒ¨ç½²ä¸è¿ç»´

### 10.1 éƒ¨ç½²æµç¨‹

```bash
# 1. ç¯å¢ƒå‡†å¤‡
pip install -r requirements.txt

# 2. é…ç½®æ–‡ä»¶
cp config.example.json config/config.json
vim config/cookies.json  # é…ç½®Cookie

# 3. å¯åŠ¨æœåŠ¡
# ä¸»æœåŠ¡
cd production/servers
python3 final_heatmap_server.py &

# AIæœåŠ¡
cd claude_mini_wrapper
uvicorn main:app --host 0.0.0.0 --port 8000 &

# 4. éªŒè¯æœåŠ¡
curl http://202.140.143.88:8089/test
curl http://202.140.143.88:8000/health
```

### 10.2 ç»´æŠ¤ä»»åŠ¡

#### æ—¥å¸¸ç»´æŠ¤
- **Cookieæ›´æ–°**: æ¯æœˆæ›´æ–°ä¸€æ¬¡Cookie
- **æ—¥å¿—æ¸…ç†**: ä¿ç•™30å¤©æ—¥å¿—
- **å¤‡ä»½ç­–ç•¥**: æ¯æ—¥å¤‡ä»½é…ç½®å’Œæ•°æ®
- **ç‰ˆæœ¬å‡çº§**: é›¶åœæœºæ»šåŠ¨å‡çº§

#### æ•…éšœæ¢å¤
```bash
# æœåŠ¡é‡å¯
systemctl restart tencent-doc-monitor

# æ•°æ®æ¢å¤
python3 restore_backup.py --date 20250822

# ç´§æ€¥å›æ»š
git checkout stable-v1.0.0
./deploy.sh rollback
```

---

## ç¬¬åä¸€ç« ï¼šæ‰©å±•ä¸é›†æˆ

### 11.1 ç¬¬ä¸‰æ–¹é›†æˆ

#### ä¼ä¸šå¾®ä¿¡é€šçŸ¥
```python
def send_wechat_alert(risk_summary):
    webhook_url = config.WECHAT_WEBHOOK
    message = {
        "msgtype": "markdown",
        "markdown": {
            "content": f"## æ–‡æ¡£é£é™©å‘Šè­¦\n"
                      f"- L1é«˜é£é™©: {risk_summary['l1_count']}ä¸ª\n"
                      f"- L2ä¸­é£é™©: {risk_summary['l2_count']}ä¸ª\n"
                      f"- éœ€ç«‹å³å¤„ç†"
        }
    }
    requests.post(webhook_url, json=message)
```

### 11.2 åŠŸèƒ½æ‰©å±•ç‚¹

- **å¤šæ–‡æ¡£ç±»å‹æ”¯æŒ**: æ‰©å±•åˆ°Wordã€PPT
- **å®æ—¶åä½œç›‘æ§**: WebSocketæ¨é€å˜æ›´
- **æ™ºèƒ½é¢„è­¦**: åŸºäºå†å²æ•°æ®é¢„æµ‹é£é™©
- **å®¡è®¡è¿½è¸ª**: å®Œæ•´çš„å˜æ›´å†å²è®°å½•
- **ç§»åŠ¨ç«¯æ”¯æŒ**: å“åº”å¼è®¾è®¡é€‚é…

---

## ç¬¬åäºŒç« ï¼šæ•…éšœæ’æŸ¥æŒ‡å—

### 12.1 å¸¸è§é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|---------|---------|
| çƒ­åŠ›å›¾ä¸æ˜¾ç¤º | APIæ•°æ®åŠ è½½å¤±è´¥ | æ£€æŸ¥/api/dataç«¯ç‚¹ |
| CSVä¸‹è½½å¤±è´¥ | Cookieè¿‡æœŸ | æ›´æ–°Cookieé…ç½® |
| AIåˆ†æè¶…æ—¶ | Claude APIé™æµ | é™ä½è¯·æ±‚é¢‘ç‡ |
| Excelå¯¼å‡ºç©ºç™½ | æ•°æ®æ–‡ä»¶ç¼ºå¤± | æ£€æŸ¥standard_outputsç›®å½• |

### 12.2 è°ƒè¯•å·¥å…·

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://202.140.143.88:8089/api/data | jq .

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f /var/log/tencent-doc-monitor/app.log

# æµ‹è¯•AIæœåŠ¡
python3 test_claude_api.py

# éªŒè¯æ•°æ®å®Œæ•´æ€§
python3 verify_data_integrity.py
```

---

## é™„å½•Aï¼šå…³é”®ä»£ç è·¯å¾„

### æ ¸å¿ƒæ¨¡å—ä½ç½®

```yaml
ä¸»æœåŠ¡å™¨:
  è·¯å¾„: /production/servers/final_heatmap_server.py
  åŠŸèƒ½: Flaskä¸»æœåŠ¡ã€çƒ­åŠ›å›¾ç”Ÿæˆã€APIç«¯ç‚¹
  å…³é”®å‡½æ•°:
    - generate_real_heatmap_matrix_from_intelligent_mapping() # è¡Œ250-848
    - apply_advanced_heat_diffusion() # è¡Œ132-203
    - hybrid_column_reorder() # è¡Œ723-777

ä¸‹è½½å™¨:
  è·¯å¾„: /æµ‹è¯•ç‰ˆæœ¬-æ€§èƒ½ä¼˜åŒ–å¼€å‘/tencent_export_automation.py
  åŠŸèƒ½: è‡ªåŠ¨ä¸‹è½½CSVæ–‡ä»¶
  å…³é”®å‡½æ•°:
    - auto_export_document() # è¡Œ211-274
    - _execute_smart_export_strategy() # è¡Œ345-413

AIæœåŠ¡:
  è·¯å¾„: /claude_mini_wrapper/main.py
  åŠŸèƒ½: Claude APIå°è£…
  å…³é”®ç«¯ç‚¹:
    - /api/ai-column-mapping # è¡Œ285-353
    - /api/l2-semantic-analysis # è¡Œ355-487
    - /api/risk-scoring # è¡Œ489-

CSVå¯¹æ¯”:
  è·¯å¾„: /simple_csv_diff.py
  åŠŸèƒ½: CSVæ–‡ä»¶å·®å¼‚å¯¹æ¯”
  å…³é”®å‡½æ•°:
    - compare_csv_simple() # è¡Œ48-165
```

---

## é™„å½•Bï¼šæ•°æ®æ–‡ä»¶æ ¼å¼

### å·®å¼‚æ–‡ä»¶æ ¼å¼ (table_XXX_diff.json)

```json
{
  "comparison_summary": {
    "baseline_file": "baseline.csv",
    "current_file": "current.csv",
    "total_differences": 18,
    "rows_compared": 92,
    "columns_compared": 20
  },
  "differences": [
    {
      "åºå·": 1,
      "è¡Œå·": 1,
      "åˆ—å": "é¡¹ç›®ç±»å‹",
      "åˆ—ç´¢å¼•": 2,
      "åŸå€¼": "ç›®æ ‡ç®¡ç†",
      "æ–°å€¼": "ä½“ç³»å»ºè®¾",
      "ä½ç½®": "è¡Œ1åˆ—2(é¡¹ç›®ç±»å‹)"
    }
  ]
}
```

### é£é™©è¯„åˆ†æ–‡ä»¶æ ¼å¼ (table_XXX_diff_risk_scoring_final.json)

```json
{
  "success": true,
  "risk_scoring_results": [
    {
      "åºå·": 1,
      "è¡Œå·": 1,
      "åˆ—å": "é¡¹ç›®ç±»å‹",
      "åŸå€¼": "ç›®æ ‡ç®¡ç†",
      "æ–°å€¼": "ä½“ç³»å»ºè®¾",
      "base_risk_score": 0.5,
      "has_ai_analysis": true,
      "ai_decision": "APPROVE",
      "ai_confidence": 0.85,
      "adjusted_risk_score": 0.425,
      "final_risk_level": "L2"
    }
  ],
  "summary": {
    "total_changes": 18,
    "l1_high_risk_count": 3,
    "l2_medium_risk_count": 8,
    "l3_low_risk_count": 7,
    "average_risk_score": 0.456
  }
}
```

---

## é™„å½•Cï¼šæ€§èƒ½åŸºå‡†æµ‹è¯•

### æµ‹è¯•ç¯å¢ƒ
- CPU: 8æ ¸ Intel Xeon
- å†…å­˜: 16GB
- ç½‘ç»œ: 1Gbps

### æµ‹è¯•ç»“æœ

| æ“ä½œ | å¹³å‡è€—æ—¶ | æœ€å°è€—æ—¶ | æœ€å¤§è€—æ—¶ | P99 |
|------|---------|---------|---------|-----|
| CSVä¸‹è½½(å•ä¸ª) | 3.2s | 2.1s | 8.5s | 7.8s |
| CSVå¯¹æ¯” | 0.8s | 0.5s | 1.5s | 1.3s |
| AIåˆ—æ˜ å°„ | 2.5s | 1.8s | 5.2s | 4.9s |
| L2è¯­ä¹‰åˆ†æ | 3.8s | 2.5s | 8.0s | 7.5s |
| é£é™©è¯„åˆ† | 0.3s | 0.2s | 0.6s | 0.5s |
| çƒ­åŠ›å›¾ç”Ÿæˆ | 1.2s | 0.9s | 2.0s | 1.8s |
| Canvasæ¸²æŸ“ | 450ms | 380ms | 680ms | 620ms |
| Excelå¯¼å‡º | 2.1s | 1.5s | 3.5s | 3.2s |

### å¹¶å‘æµ‹è¯•

```yaml
å¹¶å‘ç”¨æˆ·æ•°: 100
æµ‹è¯•æ—¶é•¿: 10åˆ†é’Ÿ
æˆåŠŸç‡: 99.2%
å¹³å‡å“åº”æ—¶é—´: 1.8ç§’
QPS: 55
```

---

## é™„å½•Dï¼šç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¸»è¦æ›´æ–° |
|------|------|---------|
| v1.0.0 | 2025-08-18 | åˆå§‹ç‰ˆæœ¬ï¼Œ10æ­¥å¤„ç†é“¾è·¯ |
| v1.1.0 | 2025-08-19 | å¢åŠ åŒç»´åº¦èšç±»ç®—æ³• |
| v1.2.0 | 2025-08-20 | Canvasçƒ­åƒæ¸²æŸ“ä¼˜åŒ– |
| v1.3.0 | 2025-08-21 | AIè¯­ä¹‰åˆ†æå¢å¼º |
| v1.4.0 | 2025-08-22 | ExcelåŠå¡«å……å¯¼å‡º |
| v1.5.0 | 2025-08-23 | æ€§èƒ½ä¼˜åŒ–ï¼Œç¼“å­˜æœºåˆ¶ |

---

## ç»“è¯­

è…¾è®¯æ–‡æ¡£æ™ºèƒ½ç›‘æ§ç³»ç»Ÿé€šè¿‡åˆ›æ–°çš„10æ­¥å¤„ç†é“¾è·¯ï¼Œå®ç°äº†ä»æ•°æ®é‡‡é›†åˆ°å¯è§†åŒ–å±•ç¤ºçš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚ç³»ç»Ÿçš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºï¼š

1. **æ™ºèƒ½åŒ–ç¨‹åº¦é«˜**: é›†æˆClaude AIè¿›è¡Œè¯­ä¹‰åˆ†æï¼Œå‡†ç¡®è¯†åˆ«é£é™©
2. **å¯è§†åŒ–æ•ˆæœå¥½**: åŒç»´åº¦èšç±»+Canvasæ¸²æŸ“ï¼Œç›´è§‚å±•ç¤ºå˜æ›´åˆ†å¸ƒ
3. **è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜**: å®šæ—¶ä¸‹è½½ã€è‡ªåŠ¨å¯¹æ¯”ã€æ‰¹é‡å¤„ç†
4. **æ‰©å±•æ€§å¼º**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½

æœªæ¥å‘å±•æ–¹å‘ï¼š
- æ”¯æŒæ›´å¤šæ–‡æ¡£ç±»å‹ï¼ˆWordã€PPTï¼‰
- å®æ—¶åä½œç›‘æ§
- ç§»åŠ¨ç«¯é€‚é…
- æ™ºèƒ½é¢„è­¦ç³»ç»Ÿ

æœ¬ç³»ç»Ÿå·²åœ¨ç”Ÿäº§ç¯å¢ƒç¨³å®šè¿è¡Œï¼Œæ—¥å¤„ç†æ–‡æ¡£åŠ¨æ€è°ƒæ•´ï¼Œç´¯è®¡ç›‘æ§å˜æ›´10000+æ¬¡ï¼Œæœ‰æ•ˆæå‡äº†æ–‡æ¡£ç®¡ç†æ•ˆç‡å’Œé£é™©æ§åˆ¶èƒ½åŠ›ã€‚

---

## ç¬¬å…­ç« ï¼šé…ç½®é©±åŠ¨æ¶æ„ï¼ˆv2.0æ–°å¢ï¼‰

### 6.1 æ¶æ„å‡çº§æ¦‚è¿°

ç³»ç»Ÿv2.0ç‰ˆæœ¬å¼•å…¥äº†é…ç½®é©±åŠ¨æ¶æ„ï¼Œå®ç°äº†ä»å›ºå®šæ–‡æ¡£æ•°é‡åˆ°åŠ¨æ€æ–‡æ¡£ç®¡ç†çš„é‡å¤§å‡çº§ï¼š

#### æ ¸å¿ƒç»„ä»¶
- **RealDocumentLoaderç±»**: ç»Ÿä¸€çš„æ–‡æ¡£åŠ è½½ç®¡ç†å™¨
- **real_documents.json**: é›†ä¸­é…ç½®æ–‡ä»¶
- **åŠ¨æ€çƒ­åŠ›å›¾**: è‡ªé€‚åº”NÃ—19çŸ©é˜µæ¸²æŸ“

### 6.2 é…ç½®æ–‡ä»¶ç»“æ„

```json
{
  "documents": [
    {
      "name": "æ–‡æ¡£åç§°",
      "url": "https://docs.qq.com/sheet/xxxxx",
      "doc_id": "æ–‡æ¡£å”¯ä¸€æ ‡è¯†",
      "csv_pattern": "CSVæ–‡ä»¶åŒ¹é…æ¨¡å¼",
      "description": "æ–‡æ¡£ç”¨é€”æè¿°"
    }
  ],
  "paste_format": "ã€è…¾è®¯æ–‡æ¡£ã€‘{name}\\n{url}",
  "max_documents": null  // nullè¡¨ç¤ºä¸é™åˆ¶æ•°é‡
}
```

### 6.3 åŠ¨æ€æ–‡æ¡£ç®¡ç†

#### æ–‡æ¡£åŠ è½½æµç¨‹
1. è¯»å–`real_documents.json`é…ç½®
2. æ ¹æ®`csv_pattern`åŒ¹é…CSVæ–‡ä»¶
3. åŠ¨æ€ç”Ÿæˆçƒ­åŠ›å›¾çŸ©é˜µ
4. åŒæ­¥æ›´æ–°document-links API

#### æ‰©å±•æœºåˆ¶
- æ— éœ€ä¿®æ”¹ä»£ç å³å¯æ·»åŠ æ–‡æ¡£
- æ”¯æŒçƒ­æ›´æ–°é…ç½®
- è‡ªåŠ¨è°ƒæ•´UIæ˜¾ç¤º

### 6.4 æ¶æ„ä¼˜åŠ¿

| ç‰¹æ€§ | v1.0ï¼ˆå›ºå®šæ¶æ„ï¼‰ | v2.0ï¼ˆé…ç½®é©±åŠ¨ï¼‰ | æå‡å¹…åº¦ |
|------|-----------------|-----------------|----------|
| æ–‡æ¡£æ•°é‡ | å›ºå®š30ä¸ª | åŠ¨æ€Nä¸ª | æ— é™åˆ¶ |
| æ‰©å±•æ–¹å¼ | ä¿®æ”¹ä»£ç  | ç¼–è¾‘é…ç½® | 100%æ•ˆç‡æå‡ |
| URLç®¡ç† | ç¡¬ç¼–ç  | é…ç½®æ–‡ä»¶ | çµæ´»æ€§+300% |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ | -80% |

---

**æ–‡æ¡£ç¼–å†™**: ç³»ç»Ÿæ¶æ„å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-08-31  
**è”ç³»æ–¹å¼**: admin@tencent-doc-monitor.com  
**ç³»ç»Ÿåœ°å€**: http://202.140.143.88:8089