{
  "映射方案元数据": {  // （映射方案的基本信息和版本控制）
    "方案名称": "综合打分到热力图智能映射方案",  // （正式的方案名称）
    "版本": "v1.0",  // （映射算法版本号）
    "创建日期": "2025-09-11",  // （方案创建日期）
    "作者": "Claude Code",  // （方案设计者）
    "目标": "将列级综合打分数据转换为30×19热力图矩阵",  // （核心目标描述）
    "适用范围": "综合打分v1.0 → 热力图8089端口系统"  // （兼容性说明）
  },
  
  "数据源配置": {  // （输入数据源的配置信息）
    "综合打分文件路径": "/root/projects/tencent-doc-manager/csv_security_results/",  // （综合打分输出目录）
    "文件名模式": "comprehensive_score_W{周数}_{时间戳}.json",  // （文件命名规则）
    "实际文档数量": 3,  // （真实腾讯文档数量）
    "目标矩阵规格": {  // （热力图矩阵要求）
      "行数": 30,  // （需要30个表格行）
      "列数": 19,  // （固定19个标准列）
      "总单元格": 570  // （30×19=570个数据点）
    }
  },
  
  "映射算法配置": {  // （三层映射算法的详细参数）
    "第一层_列级映射": {  // （从综合打分到基础热力值的映射）
      "算法名称": "列级风险映射",  // （算法标识）
      "描述": "将column_scores的aggregated_score映射为热力值",  // （功能说明）
      "风险等级基础值": {  // （L1/L2/L3的基础热力权重）
        "L1": 0.8,  // （高风险列：基础热力值0.8，表示高度关注）
        "L2": 0.5,  // （中风险列：基础热力值0.5，需要AI分析的列）
        "L3": 0.2   // （低风险列：基础热力值0.2，一般性监控）
      },
      "映射公式": "heat_value = base_heat[level] * aggregated_score * modification_weight",  // （核心计算公式）
      "修改权重计算": {  // （基于修改次数的权重调整）
        "公式": "modification_weight = min(1.0, modifications / 5)",  // （5次修改达到最大权重）
        "说明": "修改次数越多，热力权重越大，最多5次封顶"  // （权重策略说明）
      },
      "示例计算": {  // （具体计算示例）
        "输入": {
          "列名": "项目类型",
          "column_level": "L2",
          "aggregated_score": 0.54,
          "modifications": 3
        },
        "计算过程": {
          "base_heat": 0.5,  // （L2基础值）
          "modification_weight": 0.6,  // （3/5=0.6）
          "最终热力值": 0.162  // （0.5 * 0.54 * 0.6 = 0.162）
        }
      }
    },
    
    "第二层_行扩展": {  // （从3个文档扩展到30行的算法）
      "算法名称": "智能行扩展",  // （算法标识）
      "描述": "将3个真实文档的数据扩展到30行矩阵",  // （功能说明）
      "扩展策略": {  // （行分配策略）
        "文档1": {  // （第一个腾讯文档）
          "名称": "副本-测试版本-出国销售计划表",
          "占用行": "0-9",  // （占用热力图的前10行）
          "扩展方法": "scores数组分配+插值填充"  // （使用详细分数数组）
        },
        "文档2": {  // （第二个腾讯文档）
          "名称": "副本-测试版本-回国销售计划表",
          "占用行": "10-19",  // （占用热力图的中间10行）
          "扩展方法": "scores数组分配+插值填充"
        },
        "文档3": {  // （第三个腾讯文档）
          "名称": "测试版本-小红书部门",
          "占用行": "20-29",  // （占用热力图的后10行）
          "扩展方法": "scores数组分配+插值填充"
        }
      },
      "分配算法": {  // （详细分数到行的分配）
        "有多个分数时": "按scores数组顺序分配到不同行",  // （多个修改的处理）
        "分数不足时": "使用aggregated_score填充剩余行",  // （分数少于10个的处理）
        "插值方法": "线性插值，保持连续性"  // （空白行的填充方法）
      },
      "虚拟数据生成": {  // （当真实数据不足时的处理）
        "策略": "基于真实数据的统计特征生成相似模式",  // （虚拟数据生成原则）
        "变异参数": {  // （生成虚拟数据的参数）
          "振幅变化": "±20%",  // （热力值的变化范围）
          "模式保持": "保持列间相关性",  // （保持数据的内在关联）
          "噪声添加": "5%高斯噪声"  // （增加自然随机性）
        }
      }
    },
    
    "第三层_智能平滑": {  // （生成连续热力场的算法）
      "算法名称": "自适应高斯平滑",  // （算法标识）
      "描述": "保持真实热点的同时生成连续渐变",  // （功能说明）
      "高斯参数": {  // （高斯平滑的核心参数）
        "radius": 0.3,  // （极小半径，仅处理像素级锯齿）
        "sigma": 0.15,  // （标准差，控制平滑强度）
        "kernel_size": 3  // （3×3卷积核）
      },
      "热点保护": {  // （保护真实修改点的策略）
        "高热点阈值": 0.7,  // （热力值>0.7的点被标记为热点）
        "保护策略": "热点中心不参与平滑，仅平滑边缘",  // （保持峰值）
        "边缘处理": "渐进式衰减，避免硬边界"  // （自然过渡）
      },
      "优化措施": {  // （性能和效果优化）
        "边界处理": "镜像填充避免边缘失真",  // （矩阵边界的处理）
        "权重归一化": "确保平滑后总能量守恒",  // （保持数据总体特征）
        "迭代次数": 1  // （单次平滑，避免过度模糊）
      }
    }
  },
  
  "数据转换流程": {  // （完整的数据处理流程）
    "步骤1_读取综合打分": {  // （数据输入阶段）
      "操作": "读取comprehensive_score_W36_*.json",  // （读取综合打分文件）
      "提取内容": [  // （需要提取的关键字段）
        "table_scores数组",  // （所有表格的评分数据）
        "column_scores对象",  // （每列的详细评分）
        "aggregated_score值",  // （列级汇总分数）
        "column_level分类"  // （L1/L2/L3风险等级）
      ],
      "数据验证": {  // （输入数据的验证规则）
        "检查L2列AI决策": "L2列必须包含ai_decisions",  // （AI分析完整性检查）
        "分数范围验证": "所有分数必须在0-1之间",  // （数值合法性检查）
        "列数验证": "必须包含19个标准列"  // （结构完整性检查）
      }
    },
    
    "步骤2_构建基础矩阵": {  // （初始化阶段）
      "操作": "创建30×19的二维数组",  // （初始化热力图矩阵）
      "初始值": 0.05,  // （所有单元格的基础热力值）
      "数据结构": "matrix[row][col] = heat_value",  // （矩阵索引方式）
      "内存预分配": "570个浮点数，约4.5KB"  // （内存占用估算）
    },
    
    "步骤3_应用列级映射": {  // （核心映射阶段）
      "操作": "遍历每个表格的column_scores",  // （处理所有列评分）
      "映射逻辑": [  // （详细的映射步骤）
        "1. 获取列的column_level (L1/L2/L3)",  // （确定风险等级）
        "2. 查找对应的base_heat基础值",  // （获取基础热力权重）
        "3. 计算modification_weight",  // （基于修改次数的权重）
        "4. 应用映射公式计算heat_value",  // （计算最终热力值）
        "5. 将值写入对应的矩阵位置"  // （更新矩阵）
      ],
      "特殊处理": {  // （特殊情况的处理）
        "无修改的列": "保持初始值0.05",  // （未修改列的处理）
        "AI拒绝的修改": "热力值乘以1.5倍",  // （高风险修改的强调）
        "批量修改": "检测模式并增强热力"  // （系统性修改的识别）
      }
    },
    
    "步骤4_执行行扩展": {  // （扩展阶段）
      "操作": "将3个文档扩展到30行",  // （行数扩展）
      "算法选择": {  // （根据数据情况选择算法）
        "scores数量>=3": "直接分配到不同行",  // （有足够详细分数）
        "scores数量<3": "使用aggregated_score+插值",  // （分数不足）
        "无scores": "复制aggregated_score到所有行"  // （只有汇总分）
      },
      "插值算法": {  // （线性插值的实现）
        "公式": "value[i] = start + (end - start) * i / (n - 1)",  // （线性插值公式）
        "边界处理": "首尾使用实际值，中间插值"  // （保持边界真实性）
      }
    },
    
    "步骤5_智能平滑处理": {  // （平滑优化阶段）
      "操作": "应用自适应高斯平滑",  // （生成连续场）
      "执行顺序": [  // （平滑处理的步骤）
        "1. 识别高热点（值>0.7）",  // （标记需要保护的点）
        "2. 构建高斯卷积核",  // （生成平滑核）
        "3. 对非热点区域应用卷积",  // （选择性平滑）
        "4. 热点边缘渐进衰减",  // （边缘处理）
        "5. 归一化确保值域[0,1]"  // （数值范围控制）
      ],
      "质量控制": {  // （确保平滑质量）
        "对比度保持": "平滑后对比度不低于原始的80%",  // （避免过度模糊）
        "热点完整性": "热点中心值变化不超过5%",  // （保护关键信息）
        "边界连续性": "矩阵边界无突变"  // （视觉连续性）
      }
    },
    
    "步骤6_输出热力图数据": {  // （输出阶段）
      "操作": "生成热力图API响应",  // （准备API数据）
      "输出格式": {  // （标准输出格式）
        "heatmap_data": "30×19矩阵数组",  // （热力值矩阵）
        "table_names": "重排序后的表格名称",  // （表格标识）
        "column_names": "重排序后的列名称",  // （列标识）
        "row_order": "行重排序索引",  // （聚类后的行顺序）
        "col_order": "列重排序索引"  // （聚类后的列顺序）
      },
      "兼容性": {  // （与现有系统的兼容）
        "API端点": "/api/scoring_enhanced_heatmap",  // （新的API路径）
        "向后兼容": "保留原有/api/real_csv_data端点",  // （兼容旧接口）
        "数据格式": "完全兼容现有Canvas渲染器"  // （无需修改前端）
      }
    }
  },
  
  "风险映射对照表": {  // （快速查询的映射关系表）
    "分数到热力值": [  // （分数区间与热力值的对应关系）
      {"分数区间": "[0.9, 1.0]", "热力值区间": "[0.85, 0.95]", "颜色": "深红", "含义": "极高风险"},
      {"分数区间": "[0.7, 0.9)", "热力值区间": "[0.70, 0.85)", "颜色": "橙红", "含义": "高风险"},
      {"分数区间": "[0.5, 0.7)", "热力值区间": "[0.50, 0.70)", "颜色": "黄色", "含义": "中高风险"},
      {"分数区间": "[0.3, 0.5)", "热力值区间": "[0.30, 0.50)", "颜色": "绿色", "含义": "中低风险"},
      {"分数区间": "[0.1, 0.3)", "热力值区间": "[0.15, 0.30)", "颜色": "青色", "含义": "低风险"},
      {"分数区间": "[0.0, 0.1)", "热力值区间": "[0.05, 0.15)", "颜色": "蓝色", "含义": "极低风险"}
    ],
    "L1列特殊处理": {  // （高风险列的特殊映射）
      "最小热力值": 0.4,  // （L1列的最低热力值，确保可见性）
      "增强系数": 1.2,  // （L1列的热力增强）
      "说明": "L1列即使分数较低也需要保持较高的视觉强度"
    },
    "L2列AI决策影响": {  // （AI决策对热力值的影响）
      "APPROVE": 0.6,  // （批准：降低热力值）
      "CONDITIONAL": 0.8,  // （有条件批准：轻微降低）
      "REVIEW": 1.2,  // （需要复审：增强热力值）
      "REJECT": 1.5  // （拒绝：显著增强热力值）
    }
  },
  
  "性能优化建议": {  // （提高映射效率的建议）
    "缓存策略": {  // （减少重复计算）
      "列级映射缓存": "相同的column_scores只计算一次",  // （缓存列映射结果）
      "高斯核缓存": "预计算并缓存3×3高斯核",  // （缓存卷积核）
      "插值结果缓存": "缓存常用的插值序列"  // （缓存插值结果）
    },
    "并行处理": {  // （利用多核处理）
      "列级映射": "19列可并行处理",  // （列独立计算）
      "行扩展": "3个文档可并行扩展",  // （文档独立处理）
      "平滑处理": "分块并行卷积"  // （矩阵分块处理）
    },
    "内存优化": {  // （减少内存占用）
      "使用Float32": "单精度浮点足够，节省50%内存",  // （精度与内存平衡）
      "原地操作": "尽量使用原地修改避免复制",  // （减少内存分配）
      "及时释放": "处理完成后立即释放中间变量"  // （内存管理）
    }
  },
  
  "测试验证方案": {  // （确保映射正确性的测试）
    "单元测试": [  // （功能级测试）
      "测试L1/L2/L3基础值映射",  // （风险等级映射测试）
      "测试修改权重计算",  // （权重公式测试）
      "测试行扩展算法",  // （扩展算法测试）
      "测试高斯平滑效果"  // （平滑算法测试）
    ],
    "集成测试": [  // （系统级测试）
      "使用W36真实数据测试完整流程",  // （端到端测试）
      "验证30×19矩阵生成",  // （矩阵规格验证）
      "检查API响应格式",  // （接口兼容性测试）
      "验证Canvas渲染效果"  // （前端渲染测试）
    ],
    "性能测试": [  // （性能指标测试）
      "映射延迟<100ms",  // （响应时间要求）
      "内存占用<10MB",  // （内存限制）
      "CPU使用率<50%"  // （处理器负载）
    ],
    "准确性验证": {  // （数据准确性检查）
      "高风险保持": "L1列的高风险特征必须在热力图中明显",  // （风险可视化）
      "AI决策体现": "AI拒绝的修改必须显示为热点",  // （AI影响可见）
      "趋势一致": "热力图趋势与综合打分趋势一致"  // （整体一致性）
    }
  },
  
  "扩展性设计": {  // （未来扩展的考虑）
    "动态矩阵支持": {  // （支持不同规格的矩阵）
      "说明": "当前固定30×19，未来可配置N×M",  // （灵活性预留）
      "实现方式": "参数化行列数，动态分配"  // （参数化设计）
    },
    "多数据源融合": {  // （支持更多数据源）
      "详细打分集成": "可同时使用详细打分和综合打分",  // （双数据源）
      "实时数据流": "支持WebSocket实时更新",  // （实时性支持）
      "历史数据对比": "支持多周数据对比显示"  // （时间维度）
    },
    "算法插件化": {  // （算法的模块化）
      "映射算法": "支持自定义映射公式",  // （可配置映射）
      "平滑算法": "可选择不同的平滑算法",  // （算法可选）
      "聚类算法": "支持多种聚类方法"  // （聚类可选）
    }
  },
  
  "注意事项": {  // （实施时的重要提醒）
    "数据完整性": "确保综合打分文件包含所有必需字段",  // （输入验证）
    "版本兼容": "该方案基于综合打分v1.0和热力图v1.0",  // （版本依赖）
    "性能监控": "生产环境需要监控映射延迟和资源使用",  // （运维要求）
    "错误处理": "映射失败时应回退到默认热力图数据",  // （容错机制）
    "日志记录": "记录关键映射步骤用于调试和审计"  // （可追溯性）
  }
}