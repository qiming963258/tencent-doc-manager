# 📊 详细打分系统完整说明文档

## 一、系统概述

详细打分系统是腾讯文档智能监控系统的核心组件，负责对文档变更进行风险评估和智能打分。系统采用**L1/L2/L3三级分类**策略，结合**规则引擎**和**AI语义分析**，实现对每个变更项的精确风险量化。

## 二、文件结构详解

### 2.1 顶层结构
```json
{
  "metadata": {...},    // 元数据：记录打分基础信息
  "scores": [...],      // 分数数组：每个修改项的详细打分
  "summary": {...}      // 汇总统计：整体分析结果
}
```

### 2.2 Metadata（元数据）字段说明

| 字段名 | 含义 | 示例值 | 用途 |
|--------|------|--------|------|
| table_name | 表格名称 | simplified_副本-测试版本... | 标识被处理的文档 |
| source_file | 输入文件路径 | /root/projects/... | 追溯数据来源 |
| scoring_time | 打分时间 | 2025-09-09 13:38:57 | 记录处理时间 |
| total_modifications | 总修改数 | 6 | 统计变更数量 |
| scoring_version | 算法版本 | v1.0 | 版本控制 |

### 2.3 Scores（分数）字段详解

每个修改项包含以下核心部分：

#### 2.3.1 基础信息
- **modification_id**: 修改编号（M001-M006）
- **cell**: Excel单元格位置（如C4、E6）
- **column_name**: 列名称（如"项目类型"、"负责人"）
- **column_level**: 风险等级（L1/L2/L3）
- **old_value**: 原始值
- **new_value**: 新值

#### 2.3.2 Scoring Details（打分细节）

打分公式：
```
最终得分 = min(基础分 × 变更系数 × 重要性权重 × AI调整系数 × 置信度权重, 1.0)
```

| 参数 | 取值范围 | 说明 |
|------|----------|------|
| base_score | L1:0.8, L2:0.5, L3:0.2 | 列级别基础分 |
| change_factor | 0.5-1.5 | 变更类型系数 |
| importance_weight | 1.0-1.4 | 列重要性权重 |
| ai_adjustment | 0.6-1.5 | AI决策调整系数 |
| confidence_weight | 0.7-1.0 | 置信度权重 |

#### 2.3.3 AI Analysis（AI分析）- 仅L2列

**两层架构**：
1. **Layer1（第一层）**: 快速筛选
   - judgment: SAFE/RISKY/UNSURE
   - confidence: 置信度百分比
   - reason: 判断原因

2. **Layer2（第二层）**: 深度分析
   - risk_level: LOW/MEDIUM/HIGH/CRITICAL
   - decision: APPROVE/CONDITIONAL/REVIEW/REJECT
   - key_risks: 风险点列表
   - recommendation: 具体建议

#### 2.3.4 Risk Assessment（风险评估）

| 风险等级 | 分数范围 | 颜色 | 图标 | 行动要求 |
|----------|----------|------|------|----------|
| EXTREME_HIGH | ≥0.8 | red | 🔴 | immediate_review |
| HIGH | 0.6-0.8 | orange | 🟠 | manual_review |
| MEDIUM | 0.4-0.6 | yellow | 🟡 | periodic_check |
| LOW | 0.2-0.4 | green | 🟢 | log_only |
| EXTREME_LOW | <0.2 | blue | 🔵 | none |

## 三、L1/L2/L3分类策略

### 3.1 L1列（高风险）
- **基础分**: 0.8
- **处理方式**: 纯规则打分
- **AI使用**: 否
- **典型列**: 
  - 任务发起时间
  - 关键KR对齐
  - 预计完成时间
- **特点**: 关键业务字段，变更影响大

### 3.2 L2列（中风险）
- **基础分**: 0.5
- **处理方式**: 强制AI语义分析
- **AI使用**: 是（不允许降级）
- **典型列**:
  - 项目类型
  - 邓总指导登记（日更新）
  - 负责人
- **特点**: 需要理解语义才能判断风险

### 3.3 L3列（低风险）
- **基础分**: 0.2
- **处理方式**: 纯规则打分
- **AI使用**: 否
- **典型列**: 其他非关键字段
- **特点**: 常规字段，影响较小

## 四、AI决策系数映射

| AI决策 | 系数 | 影响 | 含义 |
|--------|------|------|------|
| APPROVE | 0.6 | -40% | 批准，风险较低 |
| CONDITIONAL | 0.8 | -20% | 有条件批准 |
| UNSURE | 1.0 | 0% | 不确定，保持原分 |
| REVIEW | 1.2 | +20% | 需要审核 |
| REJECT | 1.5 | +50% | 拒绝，风险较高 |

## 五、实际案例解析

### 案例1：项目类型变更（M001）
- **变更**: "目标管理" → "体系建设"
- **风险等级**: L2（需AI分析）
- **AI判断**: REVIEW（需要审核）
- **最终得分**: 0.54（中等风险）
- **原因**: 项目性质根本改变，需重新评估

### 案例2：任务发起时间变更（M002）
- **变更**: "2025/3/12" → "2025/3/13"
- **风险等级**: L1（高风险）
- **规则判断**: 时间推迟
- **最终得分**: 1.0（极高风险）
- **原因**: 关键时间节点变更，影响项目进度

### 案例3：负责人变更（M005）
- **变更**: "赖铁荔" → "赖铁荔,各责任人"
- **风险等级**: L2（需AI分析）
- **AI判断**: CONDITIONAL（有条件批准）
- **最终得分**: 0.432（中等风险）
- **原因**: 责任主体模糊化，需明确分工

## 六、系统文件路径

```
输入路径：
/root/projects/tencent-doc-manager/comparison_results/simplified_*.json

输出路径：
/root/projects/scoring_results/detailed/detailed_score_*.json

L2语义分析：
/root/projects/tencent-doc-manager/semantic_results/2025_W[XX]/semantic_analysis_L2_*.json

审批工作流：
/root/projects/tencent-doc-manager/approval_workflows/pending/workflow_WF-L2-*.json
```

## 七、性能指标

本次打分示例：
- **总修改数**: 6个
- **平均得分**: 0.651
- **AI调用次数**: 3次（所有L2列）
- **第二层分析**: 3次（100%进入深度分析）
- **风险分布**:
  - 极高风险: 3个
  - 中等风险: 2个
  - 极低风险: 1个

## 八、关键洞察

1. **L1列变更风险最高**: 3个L1列变更都达到极高风险（≥0.8）
2. **AI分析有效降低误判**: L2列通过AI分析，能准确识别格式调整（M004）的低风险
3. **多层分析提高准确性**: 100%的L2列进入第二层深度分析，提供详细建议

## 九、系统优势

1. **精确的风险量化**: 每个变更都有0-1的精确风险分数
2. **智能的语义理解**: L2列强制AI分析，理解变更的实际含义
3. **可追溯的决策过程**: 保留完整的计算过程和AI分析结果
4. **可操作的建议**: 每个高风险项都有具体的处理建议

## 十、使用建议

1. **优先处理红色警报**（🔴）: 极高风险项需立即审核
2. **关注AI建议**: L2列的AI建议通常很有价值
3. **定期检查黄色警示**（🟡）: 中等风险项需要定期跟踪
4. **批量处理蓝色项**（🔵）: 极低风险可以批量确认

---

📝 **文档版本**: v1.0  
📅 **更新时间**: 2025-09-09  
👤 **系统设计**: 腾讯文档智能监控团队