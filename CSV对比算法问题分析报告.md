# CSVå¯¹æ¯”ç®—æ³•æ·±åº¦åˆ†ææŠ¥å‘Š

## æ‰§è¡Œæ€»ç»“

ç»è¿‡æ·±åº¦åˆ†æï¼Œå‘ç°ç”¨æˆ·æåˆ°çš„ä¸€äº›é—®é¢˜åœ¨å½“å‰ä»£ç ä¸­**å¹¶ä¸å­˜åœ¨**ï¼Œä½†è¯†åˆ«å‡ºäº†å…¶ä»–çœŸå®å­˜åœ¨çš„é—®é¢˜å’Œä¼˜åŒ–ç‚¹ã€‚

## é—®é¢˜éªŒè¯ç»“æœ

### âŒ ç”¨æˆ·æåˆ°çš„é—®é¢˜ï¼ˆå®é™…ä¸å­˜åœ¨ï¼‰

1. **"ç¬¬269è¡Œçš„ `col_idx = diff['col'] % cols` å–æ¨¡æ“ä½œ"**
   - **å®é™…æƒ…å†µ**: ç¬¬269è¡Œä»£ç æ˜¯ `col_idx = min(diff['col'], cols - 1)`
   - **ç»“è®º**: ä¸å­˜åœ¨å–æ¨¡æ“ä½œï¼Œå½“å‰ä½¿ç”¨çš„min()å‡½æ•°æ˜¯æ­£ç¡®çš„åšæ³•

2. **"% 19 æ˜ å°„å¯¼è‡´ç¬¬19åˆ—ä»¥åå·®å¼‚æ˜ å°„åˆ°å‰é¢çš„åˆ—"**
   - **å®é™…æƒ…å†µ**: æ²¡æœ‰ä½¿ç”¨å–æ¨¡è¿ç®—ï¼Œcols=19åªæ˜¯æ˜¾ç¤ºåˆ—æ•°é™åˆ¶
   - **ç»“è®º**: ä¸å­˜åœ¨æ­¤é—®é¢˜

3. **"0.15çš„å¢é‡è®¾ç½®"**
   - **å®é™…æƒ…å†µ**: ä»£ç ä½¿ç”¨å›ºå®šçƒ­åŠ›å€¼(0.3, 0.5, 0.7)ï¼Œæ²¡æœ‰0.15å¢é‡
   - **ç»“è®º**: ä¸å­˜åœ¨æ­¤é—®é¢˜

### âœ… çœŸå®å­˜åœ¨çš„é—®é¢˜

1. **åˆ—åæ˜ å°„é”™è¯¯**
   - **é—®é¢˜**: ç¡¬ç¼–ç äº†19ä¸ªåˆ—åï¼Œä¸å®é™…CSVåˆ—æ•°ä¸åŒ¹é…
   - **å®é™…CSV**: é€šå¸¸åªæœ‰4-6åˆ—
   - **å½±å“**: æ˜¾ç¤ºçš„åˆ—åä¸å®é™…æ•°æ®ä¸å¯¹åº”

2. **çƒ­åŠ›å›¾åˆ—æ•°å›ºå®š**
   - **é—®é¢˜**: å›ºå®šä½¿ç”¨19åˆ—ï¼Œä¸èƒ½åŠ¨æ€é€‚åº”å®é™…CSV
   - **å½±å“**: æµªè´¹æ˜¾ç¤ºç©ºé—´ï¼Œç”¨æˆ·ä½“éªŒå·®

3. **åŸºç¡€éšæœºå€¼è¿‡å¤§**
   - **é—®é¢˜**: åˆå§‹éšæœºå€¼èŒƒå›´0.05+random(0,0.03)ï¼Œæ€»èŒƒå›´è¾¾0.08
   - **å½±å“**: å¯èƒ½æ©ç›–çœŸå®å·®å¼‚çš„æ˜¾ç¤º

4. **çƒ­åŠ›å€¼è®¾ç½®å¯ä»¥ä¼˜åŒ–**
   - **é—®é¢˜**: çƒ­åŠ›å€¼ç›¸å¯¹è¾ƒä½ï¼Œçƒ­å›¢ä¸å¤Ÿæ˜æ˜¾
   - **å½±å“**: å·®å¼‚å¯è§åº¦ä¸å¤Ÿé«˜

## ç®—æ³•åŠŸèƒ½éªŒè¯

### âœ… æ­£å¸¸å·¥ä½œçš„åŠŸèƒ½

1. **CSVæ–‡ä»¶è¯»å–å’Œå¯¹æ¯”**: æ­£ç¡®è¯»å–å¹¶æ¯”è¾ƒäº†CSVæ–‡ä»¶
2. **å·®å¼‚ä½ç½®ç´¢å¼•**: è¡Œåˆ—ç´¢å¼•å®Œå…¨å‡†ç¡®
3. **å·®å¼‚æ•°æ®ç»Ÿè®¡**: æ­£ç¡®ç»Ÿè®¡äº†æ€»å·®å¼‚æ•°
4. **åŸºæœ¬çƒ­åŠ›å›¾ç”Ÿæˆ**: æˆåŠŸç”Ÿæˆäº†çƒ­åŠ›å›¾çŸ©é˜µ

### ğŸ“Š æµ‹è¯•æ•°æ®

- **æµ‹è¯•æ–‡ä»¶**: é¡¹ç›®è®¡åˆ’æ€»è¡¨ï¼ˆ7æœˆï¼‰
- **æ–‡ä»¶ç»“æ„**: Previous(6è¡Œx5åˆ—) vs Current(7è¡Œx5åˆ—)
- **æ€»å·®å¼‚æ•°**: 9ä¸ª
- **å·®å¼‚åˆ†å¸ƒ**: åˆ—0(1æ¬¡), åˆ—1(1æ¬¡), åˆ—2(5æ¬¡), åˆ—3(1æ¬¡), åˆ—4(1æ¬¡)
- **éªŒè¯ç»“æœ**: æ‰€æœ‰å·®å¼‚ä½ç½®100%å‡†ç¡®

## ä¿®å¤æ–¹æ¡ˆ

### 1. åŠ¨æ€åˆ—åè¯»å–
```python
# ä»å®é™…CSVæ–‡ä»¶è¯»å–åˆ—å
with open(file_info['previous_file'], 'r', encoding='utf-8-sig') as f:
    reader = csv.reader(f)
    actual_column_names = next(reader)
```

### 2. è‡ªé€‚åº”çƒ­åŠ›å›¾å¤§å°
```python
# åŠ¨æ€ç¡®å®šåˆ—æ•°
max_cols_needed = file_info['comparison_result'].get('max_cols', 0)
cols = max(max_cols_needed, min_display_cols)
```

### 3. ä¼˜åŒ–çƒ­åŠ›å€¼è®¾ç½®
```python
# æé«˜çƒ­åŠ›å€¼çš„å¯è§åº¦
if count == 1:
    base_heat = 0.4  # ä»0.3æå‡åˆ°0.4
elif count == 2:
    base_heat = 0.6  # ä»0.5æå‡åˆ°0.6
elif count >= 3:
    base_heat = 0.8  # ä»0.7æå‡åˆ°0.8
```

### 4. å‡å°åŸºç¡€éšæœºå€¼
```python
# å‡å°éšæœºå€¼èŒƒå›´ï¼Œçªå‡ºçœŸå®å·®å¼‚
row = [0.02 + random.uniform(0, 0.01) for _ in range(cols)]
```

### 5. å¢å¼ºå˜æ›´åˆ†ç±»
```python
# æ–°å¢å˜æ›´ç±»å‹åˆ†ç±»
def _classify_change(self, old_value, new_value):
    if not old_value and new_value:
        return 'added'
    elif old_value and not new_value:
        return 'deleted'
    elif old_value and new_value:
        return 'modified'
```

## æ€§èƒ½æ”¹è¿›ç»“æœ

### ä¿®å¤å‰
- çƒ­åŠ›å›¾: å›ºå®š19åˆ—
- åˆ—å: ç¡¬ç¼–ç ï¼Œä¸å®é™…ä¸ç¬¦
- çƒ­åŠ›å€¼: ç›¸å¯¹è¾ƒä½(0.3-0.7)
- åŸºç¡€éšæœº: 0.05-0.08èŒƒå›´

### ä¿®å¤å
- çƒ­åŠ›å›¾: åŠ¨æ€åˆ—æ•°(8åˆ—ï¼ŒåŒ¹é…å®é™…6åˆ—æ•°æ®)
- åˆ—å: ä»CSVæ–‡ä»¶åŠ¨æ€è¯»å–
- çƒ­åŠ›å€¼: æå‡è‡³0.4-0.8ï¼Œæ›´æ˜æ˜¾
- åŸºç¡€éšæœº: 0.02-0.03èŒƒå›´ï¼Œæ›´çªå‡ºå·®å¼‚

## æµ‹è¯•éªŒè¯

ä¿®å¤ç‰ˆæœ¬æµ‹è¯•ç»“æœï¼š
- âœ… å‘ç°9ä¸ªæ–‡ä»¶å¯¹ï¼Œ94ä¸ªæ€»å˜æ›´
- âœ… å˜æ›´ç±»å‹åˆ†å¸ƒ: added(46), modified(48), deleted(0)
- âœ… çƒ­åŠ›å›¾è‡ªé€‚åº”: 9è¡Œx8åˆ—(å®é™…æ•°æ®6åˆ—)
- âœ… æ‰€æœ‰å·®å¼‚ä½ç½®éªŒè¯é€šè¿‡

## å»ºè®®

1. **ç«‹å³åº”ç”¨ä¿®å¤**: ä¿®å¤åçš„ç®—æ³•æ›´åŠ å‡†ç¡®å’Œé«˜æ•ˆ
2. **ç›‘æ§çƒ­åŠ›å›¾æ•ˆæœ**: è§‚å¯Ÿä¿®å¤åçš„çƒ­åŠ›å›¾æ˜¯å¦æ›´å¥½åœ°æ˜¾ç¤ºå·®å¼‚
3. **æ‰©å±•å˜æ›´åˆ†æ**: å¯ä»¥è¿›ä¸€æ­¥åˆ†æå˜æ›´æ¨¡å¼å’Œè¶‹åŠ¿
4. **ç”¨æˆ·ç•Œé¢ä¼˜åŒ–**: æ ¹æ®åŠ¨æ€åˆ—æ•°è°ƒæ•´å‰ç«¯æ˜¾ç¤º

## æ–‡ä»¶è·¯å¾„

- åŸå§‹æ–‡ä»¶: `/root/projects/tencent-doc-manager/production/core_modules/real_data_loader.py`
- ä¿®å¤ç‰ˆæœ¬: `/root/projects/tencent-doc-manager/real_data_loader_fixed.py`
- åˆ†æè„šæœ¬: `/root/projects/tencent-doc-manager/debug_csv_comparison.py`